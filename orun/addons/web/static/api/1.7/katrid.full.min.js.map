{"version":3,"sources":["../../../../../../js/src/core/index.js","../../../../../../js/src/designer/index.js","../../../../../../js/src/core/katrid.js","../../../../../../js/src/core/app.js","../../../../../../js/src/utils/index.js","../../../../../../js/src/utils/i18n.js","../../../../../../js/src/io/services.js","../../../../../../js/src/data/index.js","../../../../../../js/src/data/record.js","../../../../../../js/src/data/datasource.js","../../../../../../js/src/data/fields.js","../../../../../../js/src/ui/index.js","../../../../../../js/src/ui/actions.js","../../../../../../js/src/ui/actions.client.js","../../../../../../js/src/ui/actions.window.js","../../../../../../js/src/ui/templates.js","../../../../../../js/src/ui/actions.report.js","../../../../../../js/src/ui/reports.js","../../../../../../js/src/ui/widgets.js","../../../../../../js/src/ui/views.js","../../../../../../js/src/ui/views.info.js","../../../../../../js/src/ui/grid.js","../../../../../../js/src/ui/filters.js","../../../../../../js/src/ui/search.js","../../../../../../js/src/ui/components.js","../../../../../../js/src/ui/fields.js","../../../../../../js/src/ui/tabs.js","../../../../../../js/src/ui/fields.date.js","../../../../../../js/src/ui/mail.js","../../../../../../js/src/ui/ui.templ.js","../../../../../../js/src/ui/numpad.js","../../../../../../js/src/ui/code-editor.js","../../../../../../js/src/ui/dialogs.js","../../../../../../js/src/ui/fields.foreignkey.js","../../../../../../js/src/ui/fields.status.js","../../../../../../js/src/ui/fields.sortable.js","../../../../../../js/src/ui/jquery.number.js","../../../../../../js/src/ui/grid.totals.js","../../../../../../js/src/ui/dashboard.js","../../../../../../js/src/ui/telegram.js","../../../../../../js/src/plugins/query.manager.js","../../../../../../js/src/plugins/file-manager.js"],"names":["Katrid","Core","_","emptyText","LocalSettings","[object Object]","localSettings","searchMenuVisible","parseInt","localStorage","value","_isMobile","check","a","navigator","userAgent","vendor","window","opera","test","substr","settings","additionalModules","server","servicesProtocol","io","connect","ui","isMobile","dateInputMask","defaultView","goToDefaultViewAfterCancelInsert","goToDefaultViewAfterCancelEdit","horizontalForms","services","choicesPageLimit","speech","enabled","plugins","callbacks","app","cb","this","callback","push","socketio","document","domain","location","port","Menu","$","on","event","preventDefault","target","actionClick","attr","parent","hide","children","removeAttr","hash","loadPage","WebApplication","opts","menu","actionManager","Actions","ActionManager","title","self","loadingTimeout","overlayTimeout","loadingMsg","overlay","setTimeout","show","clearTimeout","ajaxStart","ajaxStop","item","data","clear","each","idx","el","params","menu_id","action","param","trigger","addEventListener","fetch","templates","then","res","text","ngApp","angular","module","run","$templateCache","UI","Templates","config","$locationProvider","$interpolateProvider","hashPrefix","startSymbol","endSymbol","controller","$scope","$compile","$location","$element","init","element","bootstrap","reset","evt","Event","isPropagationStopped","currentMenu","startsWith","split","URLSearchParams","k","v","entries","$parent","id","name","onHashChange","tpl","context","get","endsWith","ctx","Object","assign","env","render","Application","Error","login","async","username","password","multidb","db","Services","post","redirect","error","messages","type","message","$apply","href","$hashId","mixin","obj","iterable","member","r","row","isNumber","Number","isNaN","avg","sum","length","call","globals","i18n","languageCode","formats","catalog","initialize","plural","pluralidx","n","boolean","count","gettext","ngettext","gettext_noop","pgettext","npgettext","interpolate","get_format","sprintf","initialized","merge","Array","from","map","key","s","singular","indexOf","fmt","named","replace","match","String","slice","shift","formatType","requestManager","requestId","requests","reqId","def","Deferred","console","log","isString","JSON","parse","resolve","Service","url","scope","URL","searchParams","append","response","$fetch","method","credentials","body","stringify","headers","content-type","json","Settings","emit","channel","service","args","methName","rpcName","constructor","jsonrpc","Math","floor","random","request","req-id","req-method","Promise","reject","Accept","Content-Type","result","warn","info","forEach","msg","Dialogs","Alerts","success","catch","Model","kwargs","isArray","ids","fields","Data","Fields","Field","fromArray","fieldList","values","views","keys","ViewInfo","_prepareFields","field","term","status","responseText","alert","grouping","meth","open","isObject","join","Query","super","details","with_desc","as_dict","rpc","sql","model","offset","View","Attachments","destroy","file","FormData","recordId","f","files","ajax","processData","contentType","done","attachments","Auth","$post","Upload","form","record","dataSource","refresh","Record","state","raw","pending","modified","submitted","$record","pk","RecordState","destroyed","setModified","splice","rec","created","$setDirty","_pendingChanges","fieldName","addChild","child","oldValue","newValue","propKey","fieldByName","toJSON","compare","onChange","$encode","_info","dispatchEvent","jQuery","extend","toObject","initClass","createRecord","Proxy","receiver","OneToManyField","set","Reflect","SubRecords","recs","DataSourceState","inserting","browsing","editing","loading","inactive","DEFAULT_REQUEST_INTERVAL","DataSource","readonly","$modifiedRecords","_recordIndex","recordCount","loadingRecord","_masterSource","_pageIndex","pageLimit","offsetLimit","requestInterval","pendingRequest","modifiedData","uploading","_state","fieldWatchers","$fieldLog","pageIndex","page","search","_params","_fields","view","loadingAction","_loadingAction","changing","switchView","$emit","save","closest","modal","copy","insert","setValues","records","findById","_page","invalidate","elForm","errorMsgs","elfield","errorType","$error","$name","_validateForm","find","addClass","caption","raiseError","$invalid","errors","formElement","uiKatrid","setFocus","timeout","masterSource","_clearTimeout","limit","req","groups","finally","group","groupings","_loadGroup","index","rows","$params","concat","groupBy","groupName","paramValue","__str__","$expanded","$group","$level","$hasChildren","recordIndex","newIndex","_canceled","master","getModifiedData","_id","ds","ret","deleted","$deleted","undefined","$modified","$modifiedData","_getModified","getNestedData","autoRefresh","$form","validate","beforeSubmit","$eval","write","viewType","$setPristine","$setUntouched","fld","msgs","subField","focus","vals","$created","_getNested","apply","_get","getById","defaultValues","loadDefaults","oldRecs","getDefaults","display_name","defaults","default","ngDefaultValues","default_values","isFunction","isUndefined","fromJSON","Date","_modifiedFields","includes","pendingMasterId","$broadcast","moveBy","p","$children","_chain","collapse","_applyResponse","control","setDirty","$destroy","cols","visible","cssClass","helpText","help_text","required","onchange","nolabel","displayChoices","object","choices","template","list","StringField","fromInfo","$el","attrs","attributes","camelCase","trim","toLowerCase","b","c","toUpperCase","ngReadonly","ngShow","ngIf","ngClass","html","getTemplate","invisible","validAttributes","ngFieldChange","hasChoices","maxLength","max_length","paramTemplate","toString","val","widget","Widgets","defaultCondition","condition","arguments","DateField","moment","format","getAttributes","DateTimeField","NumericField","parseFloat","ForeignKey","TextField","PasswordField","IntegerField","FloatField","DecimalField","decimalPlaces","decimal_places","TimeField","childByName","addRecord","ManyToManyField","XmlField","JsonField","PythonCodeField","BooleanField","ImageField","noImageUrl","ngSrc","ngEmptyImage","emptyImage","keyCode","BACKSPACE","COMMA","DELETE","DOWN","END","ENTER","ESCAPE","HOME","LEFT","PAGE_DOWN","PAGE_UP","PERIOD","RIGHT","SPACE","TAB","UP","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","documentElement","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","Action","actionType","_context","$container","addAction","removeAction","remove","empty","act","action_type","dispatchAction","stopPropagation","ctrlKey","breadcrumb","back","isDialog","execute","ViewAction","svc","content","UrlAction","currentAction","mainAction","$attach","refreshBreadcrumb","i","path","oldAction","actionId","actionInfo","createScope","load","$new","_breadcrumb","bc","isLeaf","ClientAction","registry","tag","prototype","Views","ActionView","renderTo","btn","templateUrl","ClientView","WindowAction","viewMode","view_mode","viewModes","$on","onDataStateChange","afterCancel","history","allowedParams","view_type","oldParams","getContext","sel","selection","active_id","active_ids","_currentPath","$$path","_currentParams","$state","go","getCurrentTitle","$$search","confirm","configId","getViewInfo","Window","compile","createNew","searchModes","filter","makeUrl","lastViewType","h","templ","detach","appendTo","loadViews","toolbar","lastUrl","_viewType","destroyChildren","q","parseJSON","arg","expandGroup","collapseGroup","viewAction","confirmation","prompt","_doViewAction","promptValue","doViewAction","action_name","download","createElement","click","currentTarget","ReportAction","dispatchBindingAction","groupHeaderClick","autoReport","ok","Utils","getSetDefaultValueDialog","core","_selection","selectionLength","att","Loader","templateCache","$cache","src","noCache","nunjucks","Environment","autoescape","oldGet","prepare","loadTemplates","PRE_LOADED_TEMPLATES","put","tagName","innerHTML","base","op","templateLst","readTemplates","preProcess","getAttribute","root","DOMParser","parseFromString","firstChild","registerTemplate","tmpl","katridReportViewer","userReport","report","user_report","Reports","renderDialog","_counter","currentReport","currentUserReport","repName","Report","Params","Labels","exact","in","contains","startswith","endswith","gt","lt","between","isnull","filters","groupables","sortables","totals","Telegram","export","container","operation","value1","value2","sorting","xml","dataTypeDict","date","datetime","customizableReport","advancedOptions","label","groupable","sortable","total","autoCreate","modelChoices","getUserParams","dataType","addParam","paramName","Param","flds","aggs","result1","select2","tags","result2","result3","elParams","loaded","userParams","static","containment","start","update","renderFields","renderSorting","renderGrouping","renderParams","Operations","DefaultOperations","CharField","ModelChoices","SelectionField","TypeOperations","secondField","serviceName","multiple","defaultValue","defaultOperation","operations","getOperations","exclude","createControls","operationTemplate","xmlReport","loadFromXml","loadParams","setOperation","Widget","Component","compileButtons","sendFileCounter","sendFile","idSendFile","directive","restrict","transclude","BaseView","getTemplateContext","setContent","btns","buttons","View2","viewInfo","fieldEl","FormView","dialog","headerEl","header","parents","replaceWith","renderField","outerHTML","first","List","$observe","newViews","inline","prepend","$loaded","totalDisplayed","_cachedViews","_changeCount","dataSet","isList","inlineEditor","hasOwnProperty","gridDialog","str","charAt","substring","_incChanges","addItem","$attr","showDialog","edit","cancelChanges","setState","openItem","editItem","select","removeItem","$delete","$set","$setViewValue","$render","pasteData","cache","_queryForeignKeyField","getFieldChoices","items","txt","clipboard","readText","newObj","col","masterChanged","unhook","cancel","fn","me","gridEl","_destroyChildren","rowClick","ngRowClick","options","listOptions","formView","tr","thead","tfoot","ngTrClass","td","th","hasTotal","inplaceEditor","next","deleteRow","delRow","maxDigits","Intl","NumberFormat","maximumSignificantDigits","conditionsLabels","=","!=",">","<","conditionSuffix","like","not like",">=","<=","not in","SearchQuery","searchView","facet","addValue","renderFacets","SearchGroup","change","getParamValues","FacetView","separator","searchString","getDisplayValue","templateValue","SearchObject","display","onRemoveItem","query","loadItem","getParamValue","OR","FacetGroup","oldValues","_ref","_selected","SearchItem","SearchFilter","selected","removeValue","_doChange","SearchFilters","_facet","fromItem","_refresh","facets","SearchGroups","facetGrouping","groupLength","newItem","SearchResult","indent","selectItem","SearchField","_expanded","expandable","expanded","_loadChildren","$items","_value","addFacet","close","$filter","tempFilter","customFilter","fieldChange","conditionChange","controlVisible","isControlVisible","valueChange","searchValue","addCondition","applyFilter","selectAll","customSearchExpanded","SearchView","_viewMoreButtons","getItem","filterGroups","_groupLength","input","prop","fromGroup","fromField","which","move","customGroups","viewMoreButtons","setItem","getByName","subitem","removeClass","distance","fw","abs","prev","applyGroups","getParams","setSearchParams","shouldApply","SearchViewComponent","retrict","default_search","formCount","priority","ctrl","fieldAttributes","sectionAttrs","fcontrol","$ngModelController","$addControl","RegExp","require","nm","ngSum","$watch","$modelValue","bind","ngEnter","$event","ngEsc","Constructor","_enforceFocus","ajaxChoices","_timeout","cfg","allowClear","name_fields","nameFields","searchName","more","results","escapeMarkup","m","e","$viewValue","inputmask","decimal","inputDecimal","alias","groupSeparator","unmaskAsNumber","radixPoint","autoGroup","digitsOptional","placeholder","digits","$parsers","$formatters","toFixed","fromNow","link","accept","reader","FileReader","onload","readAsDataURL","setNow","toISOString","_focus","keypress","keydown","isDate","utc","regex","insertMode","connectWith","cardDraggable","cardItem","_domain","cardGroup","modelName","reorder","disableSelection","tooltip","delay","_pendingOperation","attachment","object_id","ngClick","actions","WIDGET_COUNT","DEFAULT_COLS","SmallIntegerField","templAttrs","wAttrs","spanPrefix","depends","addFieldWatcher","classes","templTag","cls","ngModel","attrName","widgetAttrs","readOnlyClass","_getWidgetAttrs","inner","innerHtml","span","spanTemplate","labelTemplate","widgetTemplate","dep","fieldChangeWatchers","onFieldChange","lbl","_gridEditor","_td","InputWidget","prependIcon","icon","FileField","imgSrc","SortableField","allowOpen","inList","string","integer","float","image","tabs","selectedTab","tab","active","onDeselect","onSelect","addTab","removeTab","newActiveIndex","vertical","isDefined","justified","$parse","heading","elm","tabsetCtrl","disabled","$transcludeFn","tabCtrl","tabContentTransclude","contents","node","hasAttribute","isTabHeading","headingElement","mask","datePicker","calendar","datetimepicker","useCurrent","icons","time","isValid","comments","content_subtype","hideEditor","upload","_sendMesage","showEditor","attachFile","deleteFile","MailComments","BaseTemplate","cssListClass","parentDataSource","showSelector","ths","colHtml","fieldInfo","_widget","createWidget","Boolean","t","gridClass","tbl","renderList","utils","ngChange","buttonClick","num","editor","paths","vs","language","monaco","create","minimap","automaticLayout","getModel","onDidChangeContent","getValue","setValue","Dialog","toastr","WaitDialog","parentAction","dialogTitle","elScope","targetScope","creationName","creation_name","$controller","_shown","foreignkey","newEditItem","allowCreate","formatSelection","allowCreateEdit","noCreateEdit","added","createName","err","parentModal","itemClick","$timeout","helper","$originals","$helper","clone","width","eq","stop","setSelectionRange","rangeStart","rangeEnd","createTextRange","range","moveStart","moveEnd","getSelection","part","pos","stored_range","selectionStart","selectionEnd","createRange","duplicate","expand","setEndPoint","_keydown","codes","188","110","108","109","190","191","192","220","222","221","219","173","187","186","189","shifts","96","49","50","51","52","53","54","55","56","57","48","45","61","91","93","92","59","39","44","46","47","number","decimals","dec_point","thousands_sep","u_dec","charCodeAt","regex_dec_num","regex_dec","is","keydown.format","$this","code","chara","end","setPos","negative","shiftKey","fromCharCode","metaKey","max","isFinite","altKey","keyup.format","paste.format","original","originalEvent","clipboardData","getData","origHookGet","origHookSet","isPlainObject","valHooks","u_sep","pow","round","toFixedFix","expr","dataGroup","x","grps","g","z","register","dashboardId","chart","observe","executeSql","bindto","color","pattern","Dashboard","colorPatterns","hasData","columns","c3","generate","urlParams","headerClick","className","footer","controls","$counter","$loading","DashboardWidget","$sourceScope","sourceScope","_groupBy","grid","_lastData","to","_renderGroup","unit","duration","Chart","backButton","firstRow","alasql","y","axis","legend","onclick","labels","pie","$data","$columns","size","$chart","partners","contacts","Designer","BaseDesigner","handles","startMove","moveSelection","stopMove","refreshSelection","deleteSelection","destroyHandles","top","left","_moveSelection","right","bottom","height","addGrabHandles","updateSelection","onSelectionChange","GrabHandleObject","createHandles","designer","dragging","dragObject","DragObject","surface","rect","getBoundingClientRect","handle","bottomLeft","css","middleLeft","topLeft","topRight","middleRight","bottomRight","topCenter","bottomCenter","_y","_x","screenY","screenX","setPointerCapture","pointerId","position","outerHeight","w","outerWidth","setPosition","releasePointerCapture","off","pageY","pageX","createHandle","_setGrabHandle","_dragging","mousedown","dragStart","mouseup","dragEnd","mousemove","drag","button","removeEventListener","queryChange","is_default","is_shared","ordering","reverse","getSearchView","renderSearch","renderTable","read","getFilter","_toObject","queries","all","level","levels","fm","dirs","getPath","currentItem","currentPath","backTo","uploadFile","uploadTo"],"mappings":"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","file":"katrid.full.min.js","sourcesContent":["\n// initialize the katrid namespace\nvar Katrid = {};\n","var Katrid;\n(function (Katrid) {\n    var UI;\n    (function (UI) {\n        var Designer;\n        (function (Designer) {\n            class BaseDesigner {\n                constructor(container) {\n                    this._selection = [];\n                    this.handles = [];\n                    container.addEventListener('keydown', (evt) => {\n                        switch (evt.key) {\n                            case 'ArrowUp':\n                            case 'ArrowRight':\n                            case 'ArrowDown':\n                            case 'ArrowLeft':\n                                this.startMove(evt);\n                                this.moveSelection(evt);\n                                break;\n                        }\n                    });\n                    container.addEventListener('keyup', (evt) => {\n                        switch (evt.key) {\n                            case 'ArrowUp':\n                            case 'ArrowRight':\n                            case 'ArrowDown':\n                            case 'ArrowLeft':\n                                this.stopMove(evt);\n                                this.refreshSelection(evt);\n                                break;\n                        }\n                    });\n                    container.addEventListener('keypress', (evt) => {\n                        if (evt.key === 'Delete') {\n                            evt.stopPropagation();\n                            this.deleteSelection();\n                        }\n                    });\n                }\n                deleteSelection() {\n                    for (let child of this.selection)\n                        child.$delete();\n                    this.destroyHandles();\n                }\n                moveSelection(evt) {\n                    let top = 0, right = 0, bottom = 0, left = 0;\n                    switch (evt.key) {\n                        case 'ArrowUp':\n                            top = -1;\n                            break;\n                        case 'ArrowRight':\n                            left = 1;\n                            break;\n                        case 'ArrowDown':\n                            top = 1;\n                            break;\n                        case 'ArrowLeft':\n                            left = -1;\n                            break;\n                    }\n                    this._moveSelection(top, right, bottom, left);\n                }\n                _moveSelection(top, right, bottom, left) {\n                    for (let sel of this.selection) {\n                        if (top)\n                            sel.top += top;\n                        if (right)\n                            sel.width += right;\n                        if (bottom)\n                            sel.height += bottom;\n                        if (left)\n                            sel.left += left;\n                    }\n                }\n                clearSelection() {\n                    this.destroyHandles();\n                    this.selection = [];\n                }\n                refreshSelection(evt) {\n                    this.selection = this._selection;\n                }\n                updateSelection() {\n                    this.destroyHandles();\n                    for (let sel of this.selection)\n                        this.addGrabHandles(sel);\n                }\n                get selection() {\n                    return this._selection;\n                }\n                set selection(value) {\n                    this._selection = value;\n                    this.updateSelection();\n                    this.onSelectionChange(value);\n                }\n                destroyHandles() {\n                    for (let h of this.handles)\n                        h.destroy();\n                    this.handles = [];\n                }\n                startMove(evt) {\n                    // start keyboard move\n                    this.destroyHandles();\n                }\n                stopMove(evt) {\n                    // stop keyboard move\n                    this.updateSelection();\n                }\n                onSelectionChange(value) {\n                    // on selection change event\n                }\n                addGrabHandles(obj) {\n                    // show grab handles to an object\n                    let handle = new GrabHandleObject(obj.el, this);\n                    handle.createHandles();\n                }\n            }\n            Designer.BaseDesigner = BaseDesigner;\n            class GrabHandleObject {\n                constructor(el, designer) {\n                    this.handles = [];\n                    this.dragging = false;\n                    this.el = el;\n                    this.designer = designer;\n                    // init object drag\n                    this.dragObject = new DragObject(el, designer.surface[0]);\n                }\n                createHandle() {\n                    let h = $('<label class=\"target-handle\"></label>');\n                    this.handles.push(h);\n                    return h;\n                }\n                setPosition() {\n                    let rect = this.el.getBoundingClientRect();\n                    let handle = this.bottomLeft;\n                    handle.css('left', rect.left - 3);\n                    handle.css('top', rect.bottom - 5);\n                    handle = this.middleLeft;\n                    handle.css('left', rect.left - 3);\n                    handle.css('top', rect.bottom - rect.height / 2 - 4);\n                    handle = this.topLeft;\n                    handle.css('left', rect.left - 3);\n                    handle.css('top', rect.top - 3);\n                    handle = this.topRight;\n                    handle.css('left', rect.right - 4);\n                    handle.css('top', rect.top - 3);\n                    handle = this.middleRight;\n                    handle.css('left', rect.right - 4);\n                    handle.css('top', rect.bottom - rect.height / 2 - 4);\n                    handle = this.bottomRight;\n                    handle.css('left', rect.right - 4);\n                    handle.css('top', rect.bottom - 5);\n                    handle = this.topCenter;\n                    handle.css('left', rect.right - rect.width / 2 - 4);\n                    handle.css('top', rect.top - 3);\n                    handle = this.bottomCenter;\n                    handle.css('left', rect.right - rect.width / 2 - 4);\n                    handle.css('top', rect.bottom - 5);\n                }\n                _setGrabHandle() {\n                    let handle = this.topLeft;\n                    let _y, _x;\n                    handle.on('pointerdown', (evt) => {\n                        _y = evt.screenY;\n                        _x = evt.screenX;\n                        this.dragging = true;\n                        evt.stopPropagation();\n                        evt.preventDefault();\n                        handle[0].setPointerCapture(evt.pointerId);\n                        let _onmousemove = (evt) => {\n                            evt.preventDefault();\n                            if (this.dragging) {\n                                let y = evt.screenY;\n                                let x = evt.screenX;\n                                y = _y - y;\n                                x = _x - x;\n                                let el = $(this.el);\n                                let pos = el.position();\n                                el.css('left', (pos.left - x).toString() + 'px');\n                                el.css('top', pos.top - y);\n                                let h = el.outerHeight();\n                                let w = el.outerWidth();\n                                el.css('height', h + y);\n                                el.css('width', (w + x).toString() + 'px');\n                                _y = evt.screenY;\n                                _x = evt.screenX;\n                                this.setPosition();\n                                el[0].dispatchEvent(new Event('designerresizing'));\n                            }\n                        };\n                        let _onmouseup = (evt) => {\n                            handle[0].releasePointerCapture(evt.pointerId);\n                            if (this.dragging) {\n                                evt.preventDefault();\n                                this.dragging = false;\n                                this.el.dispatchEvent(new Event('designerresized'));\n                                handle.off('pointermove');\n                                handle.off('pointerup');\n                            }\n                        };\n                        handle.on('pointermove', _onmousemove);\n                        handle.on('pointerup', _onmouseup);\n                    });\n                    handle = this.topRight;\n                    handle.on('pointerdown', (evt) => {\n                        _y = evt.screenY;\n                        _x = evt.screenX;\n                        this.dragging = true;\n                        evt.stopPropagation();\n                        evt.preventDefault();\n                        handle[0].setPointerCapture(evt.pointerId);\n                        let _onmousemove = (evt) => {\n                            evt.preventDefault();\n                            if (this.dragging) {\n                                let y = evt.screenY;\n                                let x = evt.screenX;\n                                y = _y - y;\n                                x = _x - x;\n                                let el = $(this.el);\n                                let parent = el.parent();\n                                let pos = el.position();\n                                el.css('top', pos.top - y);\n                                let h = el.outerHeight();\n                                let w = el.outerWidth();\n                                el.css('height', h + y);\n                                el.css('width', w - x);\n                                _y = evt.screenY;\n                                _x = evt.screenX;\n                                this.setPosition();\n                                el[0].dispatchEvent(new Event('designerresizing'));\n                            }\n                        };\n                        let _onmouseup = (evt) => {\n                            handle[0].setPointerCapture(evt.pointerId);\n                            if (this.dragging) {\n                                evt.preventDefault();\n                                this.dragging = false;\n                                this.el.dispatchEvent(new Event('designerresized'));\n                                handle.off('pointermove');\n                                handle.off('pointerup');\n                            }\n                        };\n                        handle.on('pointermove', _onmousemove);\n                        handle.on('pointerup', _onmouseup);\n                    });\n                    handle = this.bottomRight;\n                    handle.on('pointerdown', (evt) => {\n                        _y = evt.pageY;\n                        _x = evt.pageX;\n                        this.dragging = true;\n                        evt.stopPropagation();\n                        evt.preventDefault();\n                        handle[0].setPointerCapture(evt.pointerId);\n                        let _onmousemove = (evt) => {\n                            evt.preventDefault();\n                            if (this.dragging) {\n                                let y = _y - evt.pageY;\n                                let x = _x - evt.pageX;\n                                let el = $(this.el);\n                                let parent = el.parent();\n                                let h = el.outerHeight();\n                                let w = el.outerWidth();\n                                el.css('height', h - y);\n                                el.css('width', w - x);\n                                _y = evt.pageY;\n                                _x = evt.pageX;\n                                this.setPosition();\n                                el[0].dispatchEvent(new Event('designerresizing'));\n                            }\n                        };\n                        let _onmouseup = (evt) => {\n                            handle[0].releasePointerCapture(evt.pointerId);\n                            if (this.dragging) {\n                                evt.preventDefault();\n                                this.dragging = false;\n                                this.el.dispatchEvent(new Event('designerresized'));\n                                handle.off('pointermove');\n                                handle.off('pointerup');\n                            }\n                        };\n                        handle.on('pointermove', _onmousemove);\n                        handle.on('pointerup', _onmouseup);\n                    });\n                    handle = this.middleLeft;\n                    handle.on('pointerdown', (evt) => {\n                        _y = evt.screenY;\n                        _x = evt.screenX;\n                        this.dragging = true;\n                        evt.stopPropagation();\n                        evt.preventDefault();\n                        handle[0].setPointerCapture(evt.pointerId);\n                        let _onmousemove = (evt) => {\n                            evt.preventDefault();\n                            if (this.dragging) {\n                                let y = evt.screenY;\n                                let x = evt.screenX;\n                                y = _y - y;\n                                x = _x - x;\n                                let el = $(this.el);\n                                let pos = el.position();\n                                el.css('left', pos.left - x);\n                                let h = el.outerHeight();\n                                let w = el.outerWidth();\n                                el.css('width', w + x);\n                                _y = evt.screenY;\n                                _x = evt.screenX;\n                                this.setPosition();\n                                el[0].dispatchEvent(new Event('designerresizing'));\n                            }\n                        };\n                        let _onmouseup = (evt) => {\n                            handle[0].releasePointerCapture(evt.pointerId);\n                            if (this.dragging) {\n                                evt.preventDefault();\n                                this.dragging = false;\n                                this.el.dispatchEvent(new Event('designerresized'));\n                                handle.off('pointermove');\n                                handle.off('pointerup');\n                            }\n                        };\n                        handle.on('pointermove', _onmousemove);\n                        handle.on('pointerup', _onmouseup);\n                    });\n                    handle = this.middleRight;\n                    handle.on('pointerdown', (evt) => {\n                        _y = evt.screenY;\n                        _x = evt.screenX;\n                        this.dragging = true;\n                        evt.stopPropagation();\n                        evt.preventDefault();\n                        handle[0].setPointerCapture(evt.pointerId);\n                        let _onmousemove = (evt) => {\n                            evt.preventDefault();\n                            if (this.dragging) {\n                                let y = evt.screenY;\n                                let x = evt.screenX;\n                                y = _y - y;\n                                x = _x - x;\n                                let el = $(this.el);\n                                let pos = el.position();\n                                let h = el.outerHeight();\n                                let w = el.outerWidth();\n                                el.css('width', w - x);\n                                _y = evt.screenY;\n                                _x = evt.screenX;\n                                this.setPosition();\n                                el[0].dispatchEvent(new Event('designerresizing'));\n                            }\n                        };\n                        let _onmouseup = (evt) => {\n                            handle[0].releasePointerCapture(evt.pointerId);\n                            if (this.dragging) {\n                                evt.preventDefault();\n                                this.dragging = false;\n                                this.el.dispatchEvent(new Event('designerresized'));\n                                handle.off('pointermove');\n                                handle.off('pointerup');\n                            }\n                        };\n                        handle.on('pointermove', _onmousemove);\n                        handle.on('pointerup', _onmouseup);\n                    });\n                    handle = this.bottomCenter;\n                    handle.on('pointerdown', (evt) => {\n                        _y = evt.screenY;\n                        _x = evt.screenX;\n                        this.dragging = true;\n                        evt.stopPropagation();\n                        evt.preventDefault();\n                        handle[0].setPointerCapture(evt.pointerId);\n                        let _onmousemove = (evt) => {\n                            evt.preventDefault();\n                            if (this.dragging) {\n                                let y = evt.screenY;\n                                let x = evt.screenX;\n                                y = _y - y;\n                                x = _x - x;\n                                let el = $(this.el);\n                                let parent = el.parent();\n                                let h = el.outerHeight();\n                                let w = el.outerWidth();\n                                el.css('height', h - y);\n                                _y = evt.screenY;\n                                _x = evt.screenX;\n                                this.setPosition();\n                                el[0].dispatchEvent(new Event('designerresizing'));\n                            }\n                        };\n                        let _onmouseup = (evt) => {\n                            handle[0].releasePointerCapture(evt.pointerId);\n                            if (this.dragging) {\n                                evt.preventDefault();\n                                this.dragging = false;\n                                this.el.dispatchEvent(new Event('designerresized'));\n                                handle.off('pointermove');\n                                handle.off('pointerup');\n                            }\n                        };\n                        handle.on('pointermove', _onmousemove);\n                        handle.on('pointerup', _onmouseup);\n                    });\n                    handle = this.topCenter;\n                    handle.on('pointerdown', (evt) => {\n                        _y = evt.screenY;\n                        _x = evt.screenX;\n                        this.dragging = true;\n                        evt.stopPropagation();\n                        evt.preventDefault();\n                        handle[0].setPointerCapture(evt.pointerId);\n                        let _onmousemove = (evt) => {\n                            evt.preventDefault();\n                            if (this.dragging) {\n                                let y = evt.screenY;\n                                let x = evt.screenX;\n                                y = _y - y;\n                                x = _x - x;\n                                let el = $(this.el);\n                                let parent = el.parent();\n                                let pos = el.position();\n                                el.css('top', pos.top - y);\n                                let h = el.outerHeight();\n                                let w = el.outerWidth();\n                                el.css('height', h + y);\n                                _y = evt.screenY;\n                                _x = evt.screenX;\n                                this.setPosition();\n                                el[0].dispatchEvent(new Event('designerresizing'));\n                            }\n                        };\n                        let _onmouseup = (evt) => {\n                            handle[0].releasePointerCapture(evt.pointerId);\n                            if (this.dragging) {\n                                evt.preventDefault();\n                                this.dragging = false;\n                                this.el.dispatchEvent(new Event('designerresized'));\n                                handle.off('pointermove');\n                                handle.off('pointerup');\n                            }\n                        };\n                        handle.on('pointermove', _onmousemove);\n                        handle.on('pointerup', _onmouseup);\n                    });\n                    handle = this.bottomLeft;\n                    handle.on('pointerdown', (evt) => {\n                        _y = evt.screenY;\n                        _x = evt.screenX;\n                        this.dragging = true;\n                        evt.stopPropagation();\n                        evt.preventDefault();\n                        handle[0].setPointerCapture(evt.pointerId);\n                        let _onmousemove = (evt) => {\n                            evt.preventDefault();\n                            if (this.dragging) {\n                                let y = evt.screenY;\n                                let x = evt.screenX;\n                                y = _y - y;\n                                x = _x - x;\n                                let el = $(this.el);\n                                let pos = el.position();\n                                let h = el.outerHeight();\n                                let w = el.outerWidth();\n                                el.css('height', h - y);\n                                el.css('left', pos.left - x);\n                                el.css('width', w + x);\n                                _y = evt.screenY;\n                                _x = evt.screenX;\n                                this.setPosition();\n                                el[0].dispatchEvent(new Event('designerresizing'));\n                            }\n                        };\n                        let _onmouseup = (evt) => {\n                            handle[0].releasePointerCapture(evt.pointerId);\n                            if (this.dragging) {\n                                evt.preventDefault();\n                                this.dragging = false;\n                                this.el.dispatchEvent(new Event('designerresized'));\n                                handle.off('pointermove');\n                                handle.off('pointerup');\n                            }\n                        };\n                        handle.on('pointermove', _onmousemove);\n                        handle.on('pointerup', _onmouseup);\n                    });\n                }\n                createHandles() {\n                    let handle;\n                    // bottom-left\n                    this.bottomLeft = handle = this.createHandle();\n                    handle.addClass('bottom-left');\n                    this.designer.surface.append(handle);\n                    // middle-left\n                    this.middleLeft = handle = this.createHandle();\n                    handle.addClass('middle-left');\n                    this.designer.surface.append(handle);\n                    // top-left\n                    this.topLeft = handle = this.createHandle();\n                    handle.addClass('top-left');\n                    this.designer.surface.append(handle);\n                    // top-right\n                    this.topRight = handle = this.createHandle();\n                    handle.addClass('top-right');\n                    this.designer.surface.append(handle);\n                    // middle-right\n                    this.middleRight = handle = this.createHandle();\n                    handle.addClass('middle-right');\n                    this.designer.surface.append(handle);\n                    // bottom-right\n                    this.bottomRight = handle = this.createHandle();\n                    handle.addClass('bottom-right');\n                    this.designer.surface.append(handle);\n                    // top-center\n                    this.topCenter = handle = this.createHandle();\n                    handle.addClass('top-center');\n                    this.designer.surface.append(handle);\n                    // bottom-center\n                    this.bottomCenter = handle = this.createHandle();\n                    handle.addClass('bottom-center');\n                    this.designer.surface.append(handle);\n                    this.designer.handles.push(this);\n                    this.setPosition();\n                    this._setGrabHandle();\n                }\n                destroy() {\n                    for (let h of this.handles)\n                        h.remove();\n                    this.handles = [];\n                    this.dragObject.destroy();\n                }\n            }\n            Designer.GrabHandleObject = GrabHandleObject;\n            class DragObject {\n                constructor(el, container) {\n                    this.el = el;\n                    this.container = container;\n                    this._dragging = false;\n                    this.el = el;\n                    this.mousedown = (evt) => this.dragStart(evt);\n                    this.mouseup = (evt) => this.dragEnd(evt);\n                    this.mousemove = (evt) => this.drag(evt);\n                    container.addEventListener('mousedown', this.mousedown);\n                    container.addEventListener('mouseup', this.mouseup);\n                    container.addEventListener('mousemove', this.mousemove);\n                }\n                dragStart(evt) {\n                    if ((evt.button === 0) && (evt.target === this.el)) {\n                        this._y = evt.screenY;\n                        this._x = evt.screenX;\n                        this.dragging = true;\n                    }\n                }\n                dragEnd(evt) {\n                    if (this.dragging) {\n                        this.dragging = false;\n                        this.el.dispatchEvent(new Event('designerdragend'));\n                    }\n                }\n                drag(evt) {\n                    if (this.dragging) {\n                        evt.preventDefault();\n                        evt.stopPropagation();\n                        let el = $(this.el);\n                        if (this.dragging) {\n                            let y = evt.screenY;\n                            let x = evt.screenX;\n                            y = this._y - y;\n                            x = this._x - x;\n                            let el = $(this.el);\n                            let pos = el.position();\n                            el.css('left', (pos.left - x).toString() + 'px');\n                            el.css('top', (pos.top - y).toString() + 'px');\n                            this._y = evt.screenY;\n                            this._x = evt.screenX;\n                        }\n                        this.el.dispatchEvent(new Event('designerdrag'));\n                    }\n                }\n                destroy() {\n                    this.container.removeEventListener('mousedown', this.mousedown);\n                    this.container.removeEventListener('mouseup', this.mouseup);\n                    this.container.removeEventListener('mousemove', this.mousemove);\n                }\n                get dragging() {\n                    return this._dragging;\n                }\n                set dragging(value) {\n                    if (value)\n                        this.el.dispatchEvent(new Event('designerdragstart'));\n                    this._dragging = value;\n                }\n            }\n            Designer.DragObject = DragObject;\n        })(Designer = UI.Designer || (UI.Designer = {}));\n    })(UI = Katrid.UI || (Katrid.UI = {}));\n})(Katrid || (Katrid = {}));\n","Katrid.Core = {};\n\n\n(function () {\n\n  _.emptyText = '--';\n\n  class LocalSettings {\n    static init() {\n      Katrid.localSettings = new LocalSettings();\n    }\n\n    constructor() {\n    }\n\n    get searchMenuVisible() {\n      return parseInt(localStorage.searchMenuVisible) === 1;\n    }\n\n    set searchMenuVisible(value) {\n      localStorage.searchMenuVisible = value ? 1 : 0;\n    }\n  }\n\n\n  const _isMobile = function isMobile() {\n    var check = false;\n    (function (a) {\n      if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true;\n    })(navigator.userAgent || navigator.vendor || window.opera);\n    return check;\n  }();\n\n  Katrid.settings = {\n    additionalModules: [],\n    server: '',\n    servicesProtocol: (typeof io !== 'undefined' && io !== null) && io.connect ? 'io' : 'http',\n\n    // Katrid Framework UI Settings\n    ui: {\n      isMobile: _isMobile,\n      dateInputMask: true,\n      defaultView: 'list',\n      goToDefaultViewAfterCancelInsert: true,\n      goToDefaultViewAfterCancelEdit: false,\n      horizontalForms: true\n    },\n\n    services: {\n      choicesPageLimit: 10\n    },\n\n    speech: {\n      enabled: false\n    }\n  };\n\n  Katrid.Core.LocalSettings = LocalSettings;\n\n  Katrid.Core.plugins = {\n    callbacks: [],\n    init(app) {\n      for (let cb of this.callbacks)\n        cb(app);\n    },\n    register(callback) {\n      this.callbacks.push(callback);\n    }\n  };\n\n  if (Katrid.settings.servicesProtocol === 'io') {\n    Katrid.socketio = io.connect(`//${document.domain}:${location.port}/rpc`);\n  }\n\n})();\n","(function() {\n\n  class Application {\n    constructor() {\n      throw Error('erro');\n    }\n  }\n\n  class Menu {\n    constructor(app) {\n      this.app = app;\n\n      $('.menu-item-action')\n      .on('click', event => {\n        event.preventDefault();\n        let target = $(event.target);\n        this.actionClick(target.attr('href'));\n        target.parent('.dropdown-menu').hide();\n      });\n      $('li.nav-item.dropdown').on('mouseenter', function() {\n        $(this).children('.dropdown-menu').removeAttr('style');\n      });\n    }\n\n    actionClick(hash) {\n      this.app.loadPage(hash, true);\n    }\n  }\n\n  class WebApplication {\n\n    constructor(opts) {\n      Katrid.app = this;\n      this.menu = new Menu(this);\n      this.actionManager = new Katrid.Actions.ActionManager();\n      this.title = opts.title;\n      this.plugins = [\n        'ui.katrid',\n        'ngSanitize',\n      ];\n\n      let self = this;\n      $(Katrid).on('app.ready', () => {\n\n        let loadingTimeout, overlayTimeout;\n        let loadingMsg = $('#loading-msg').hide();\n        let overlay = $('#overlay').hide();\n        $(Katrid).on('fetch.before', () => {\n          loadingTimeout = setTimeout(() => loadingMsg.show(), 400);\n          overlayTimeout = setTimeout(() => {\n            loadingMsg.hide();\n            overlay.show();\n          }, 2500);\n        })\n        .on('fetch.always', () => {\n          clearTimeout(loadingTimeout);\n          clearTimeout(overlayTimeout);\n          loadingMsg.hide();\n          overlay.hide();\n        });\n\n        // TODO replace jquery ajax by fetch api\n        $(document).ajaxStart(function() {\n          loadingTimeout = setTimeout(() => loadingMsg.show(), 400);\n          overlayTimeout = setTimeout(() => {\n            loadingMsg.hide();\n            overlay.show()\n          }, 2500);\n        })\n        .ajaxStop(function() {\n          clearTimeout(loadingTimeout);\n          clearTimeout(overlayTimeout);\n          loadingMsg.hide();\n          overlay.hide();\n        });\n\n        $('a.module-selector')\n        .on('click', function(event) {\n          event.preventDefault();\n          let item = $(this);\n          let params = {};\n          params.menu_id = item.data('menu-id');\n\n          // clear history\n          Katrid.app.actionManager.clear();\n          self.loadPage(item.attr('href'));\n        })\n        .each(function(idx, el) {\n          el = $(el);\n          let params = {};\n          params.menu_id = el.data('menu-id');\n          params.action = $(`.menu-item-action[data-parent-id=\"${params.menu_id}\"]:first`).data('action-id');\n          el.attr('href', '#/app/?' + $.param(params));\n        });\n\n        if (location.hash === '')\n          $('a.module-selector:first').trigger('click');\n        else\n          this.loadPage(location.hash);\n      });\n\n      window.addEventListener('hashchange', (event) => {\n        this.loadPage(location.hash);\n      });\n\n      // initialize sync resources\n      fetch(opts.templates || '/web/client/templates/')\n      .then(res => res.text())\n      .then((templates) => {\n        if (templates)\n          templates = '<templates>' + templates + '</templates>';\n\n        // initialize angular app (katrid module)\n        this.ngApp = angular.module('katridApp', this.plugins)\n        .run(['$templateCache', ($templateCache) => {\n          this.$templateCache = $templateCache;\n          Katrid.UI.templates = new Katrid.UI.Templates(this, templates);\n        }])\n        // config hash\n        .config(['$locationProvider', '$interpolateProvider', function ($locationProvider, $interpolateProvider) {\n          $locationProvider.hashPrefix('');\n          $interpolateProvider.startSymbol('${');\n          $interpolateProvider.endSymbol('}');\n        }]);\n\n        this.ngApp.controller('AppController', ['$scope', '$compile', '$location', function($scope, $compile, $location) {\n          Katrid.Core.$compile = $compile;\n          Katrid.app.$scope = $scope;\n          Katrid.app.$location = $location;\n          $scope._ = _;\n          Katrid.app.$element = $('#katrid-action-view');\n          $(Katrid).trigger('app.ready', [Katrid.app]);\n        }]);\n\n        this.ngApp.controller('ActionController', ['$scope', function($scope) {\n        }]);\n\n        Katrid.Core.plugins.init(this);\n        $(Katrid).trigger('loaded', [Katrid.app]);\n\n      });\n    }\n\n    static bootstrap(opts) {\n      let app = new WebApplication(opts);\n      $(Katrid).on('loaded', function() {\n        angular.element(function () {\n          angular.bootstrap(document, ['katridApp']);\n        });\n      });\n      return app;\n    }\n\n    async loadPage(hash, reset) {\n      let evt = $.Event('hashchange');\n      $(this).trigger(evt, [hash, reset]);\n      // check if any plugin has stopped the event flow\n      if (!evt.isPropagationStopped()) {\n        this.$scope.currentMenu = '';\n        // load the page content\n        if (hash.startsWith('#/app/?'))\n          hash = hash.split('#/app/?')[1];\n        hash = new URLSearchParams(hash);\n        let params = {};\n        for (let [k, v] of hash.entries())\n          params[k] = v;\n\n        if (params.menu_id)\n          $('a.module-selector');\n\n        if (!this.$scope.$parent.currentMenu || (params.menu_id && (this.$scope.$parent.currentMenu.id != params.menu_id))) {\n          this.$scope.$parent.currentMenu = { id: params.menu_id, name: $(`.module-selector[data-menu-id=\"${params.menu_id}\"]`).text() };\n        }\n\n        if (('action' in params) || ('model' in params))\n          await this.actionManager.onHashChange(params, reset);\n      }\n    }\n\n    getTemplate(tpl, context) {\n      let text = this.$templateCache.get(tpl);\n      if (tpl.endsWith('jinja2')) {\n        let ctx = {\n          _: _,\n        };\n        if (context)\n          Object.assign(ctx, context);\n        return Katrid.UI.Templates.env.render(tpl, ctx);\n      }\n      else if (tpl.endsWith('pug')) {\n        text = text(context);\n      }\n      return text;\n    }\n\n    static get context() {\n      return this.actionManager.context;\n    }\n\n  }\n\n  Katrid.Core.Application = Application;\n  Katrid.Core.WebApplication = WebApplication;\n\n})();\n\nangular.module('basicApp', [])\n.controller('LoginController', ['$scope', function($scope) {\n  $scope.login = async (username, password, multidb, db) => {\n    let res;\n    if (multidb)\n      res = await Katrid.Services.post('/web/db/', { db });\n    if ((multidb && res.redirect) || !multidb) {\n      res = await Katrid.Services.post('/web/login/', { username, password });\n      if (res.error) {\n        $scope.messages = [{ type: 'danger', message: res.message }];\n        $scope.$apply();\n      } else {\n        $scope.messages = [{ type: 'success', message: res.message }];\n        $scope.$apply();\n        setTimeout(() => window.location.href = res.redirect);\n      }\n    }\n  }\n}]);\n","(function () {\n\n  Katrid.$hashId = 0;\n\n  _.mixin({\n    hash(obj) {\n      if (!obj.$hashId) {\n        obj.$hashId = ++Katrid.$hashId;\n      }\n      return obj.$hashId;\n    }\n  });\n\n  _.mixin({\n    sum(iterable, member) {\n      let r = 0;\n      if (iterable)\n        for (let row of iterable) {\n          let v = row[member];\n          if (!_.isNumber(v))\n            v = Number(v);\n          if (_.isNaN(v))\n            v = 0;\n          r += v;\n        }\n      return r;\n    },\n    avg(iterable, member) {\n      let r = 0;\n      return _.sum(iterable, member) / iterable.length;\n    }\n  })\n\n}).call(this);\n","(function() {\n\n  const globals = this;\n\n  // Internationalization\n  Katrid.i18n = {\n    languageCode: 'pt-BR',\n    formats: {},\n    catalog: {},\n\n    initialize(plural, catalog, formats) {\n      Katrid.i18n.plural = plural;\n      Katrid.i18n.catalog = catalog;\n      Katrid.i18n.formats = formats;\n      if (plural) {\n        Katrid.i18n.pluralidx = function (n) {\n          if (plural instanceof boolean) {\n            if (plural) {\n              return 1;\n            } else {\n              return 0;\n            }\n          } else {\n            return plural;\n          }\n        };\n      } else {\n        Katrid.i18n.pluralidx = function (n) {\n          if (count === 1) {\n            return 0;\n          } else {\n            return 1;\n          }\n        };\n      }\n\n      globals.pluralidx = Katrid.i18n.pluralidx;\n      globals.gettext = Katrid.i18n.gettext;\n      globals.ngettext = Katrid.i18n.ngettext;\n      globals.gettext_noop = Katrid.i18n.gettext_noop;\n      globals.pgettext = Katrid.i18n.pgettext;\n      globals.npgettext = Katrid.i18n.npgettext;\n      globals.interpolate = Katrid.i18n.interpolate;\n      globals.get_format = Katrid.i18n.get_format;\n\n      _.mixin({\n        gettext: Katrid.i18n.gettext,\n        sprintf: sprintf,\n      });\n\n      return Katrid.i18n.initialized = true;\n    },\n\n    merge(catalog) {\n      return Array.from(catalog).map((key) =>\n        (Katrid.i18n.catalog[key] = catalog[key]));\n    },\n\n    gettext(s) {\n      const value = Katrid.i18n.catalog[s];\n      if (value != null) {\n        return value;\n      } else {\n        return s;\n      }\n    },\n\n    gettext_noop(s) {\n      return s;\n    },\n\n    ngettext(singular, plural, count) {\n      const value = Katrid.i18n.catalog[singular];\n      if (value != null) {\n        return value[Katrid.i18n.pluralidx(count)];\n      } else if (count === 1) {\n        return singular;\n      } else {\n        return plural;\n      }\n    },\n\n    pgettext(s) {\n      let value = Katrid.i18n.gettext(s);\n      if (value.indexOf('\\x04') !== -1) {\n        value = s;\n      }\n      return value;\n    },\n\n    npgettext(ctx, singular, plural, count) {\n      let value = Katrid.i18n.ngettext(ctx + '\\x04' + singular, ctx + '\\x04' + plural, count);\n      if (value.indexOf('\\x04') !== -1) {\n        value = Katrid.i18n.ngettext(singular, plural, count);\n      }\n      return value;\n    },\n\n    interpolate(fmt, obj, named) {\n      if (named) {\n        fmt.replace(/%\\(\\w+\\)s/g, match => String(obj[match.slice(2, -2)]));\n      } else {\n        fmt.replace(/%s/g, match => String(obj.shift()));\n      }\n\n      return {\n        get_format(formatType) {\n          const value = Katrid.i18n.formats[formatType];\n          if (value != null) {\n            return value;\n          } else {\n            return formatType;\n          }\n        }\n      };\n    }\n  };\n\n})();\n","(function () {\n\n  let requestManager;\n  class RequestManager {\n    constructor() {\n      this.requestId = 0;\n      this.requests = {};\n    }\n\n    request() {\n      const reqId = ++requestManager.requestId;\n      const def = new $.Deferred();\n      this.requests[reqId] = def;\n      def.requestId = reqId;\n      return def;\n    }\n  }\n\n\n  if (Katrid.socketio) {\n    requestManager = new RequestManager();\n\n    Katrid.socketio.on('connect', () => console.log(\"I'm connected!\"));\n\n    Katrid.socketio.on('api', function (data) {\n      if (_.isString(data)) {\n        data = JSON.parse(data);\n      }\n      const def = requestManager.requests[data['req-id']];\n      return def.resolve(data);\n    });\n  }\n\n\n  class Service {\n    static get url() { return '/api/rpc/' };\n\n    constructor(name, scope) {\n      this.name = name;\n    }\n\n    static $fetch(url, config, params) {\n      if (params) {\n        url = new URL(url);\n        Object.entries(params).map((k, v) => url.searchParams.append(k, v));\n      }\n      // send events\n      $(Katrid).trigger('fetch.before');\n      return fetch(url, config)\n      .then(response => {\n        $(Katrid).trigger('fetch.done');\n        return response;\n      });\n    }\n\n    static $post(url, data, params) {\n      return this.$fetch(url, {\n        method: 'POST',\n        credentials: \"same-origin\",\n        body: JSON.stringify(data),\n        headers: {\n          'content-type': 'application/json',\n        }\n      }, params)\n      .then(res => res.json());\n    }\n\n    delete(name, params, data) {\n    }\n\n    get(name, params) {\n      if (Katrid.Settings.servicesProtocol === 'ws') {\n        // Using websocket protocol\n        return Katrid.socketio.emit('api', {channel: 'rpc', service: this.name, method: name, data, args: params});\n      } else {\n        // Using http protocol\n        const methName = this.name ? this.name + '/': '';\n        const rpcName = Katrid.Settings.server + this.constructor.url + methName + name + '/';\n        return $.get(rpcName, params);\n      }\n    }\n\n    post(name, data, params) {\n      let context;\n      if (Katrid.app)\n        context = Katrid.app.context;\n      if (!data)\n        data = {};\n      if (context)\n        data.context = context;\n\n      data = {\n        jsonrpc: '2.0',\n        method: name,\n        params: data,\n        id: Math.floor(Math.random() * 1000 * 1000 * 1000)\n      };\n\n      // Check if protocol is socket.io\n      if (Katrid.settings.servicesProtocol === 'io') {\n        const def = requestManager.request();\n        Katrid.socketio.emit('api',\n          {\n            \"req-id\": def.requestId,\n            \"req-method\": 'POST',\n            service: this.name,\n            method: name,\n            data,\n            args: params\n          }\n        );\n        return def;\n\n        // Else, using ajax\n      } else {\n        const methName = this.name ? this.name + '/': '';\n        let rpcName = Katrid.settings.server + this.constructor.url + methName + name + '/';\n        if (params) {\n          rpcName += `?${$.param(params)}`;\n        }\n        return new Promise(\n          (resolve, reject) => {\n\n            fetch(rpcName, {\n              method: 'POST',\n              body: JSON.stringify(data),\n              headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json',\n              },\n            })\n            .then(res => res.json())\n            .then(res => {\n              if (res.error)\n                reject(res.error);\n              else {\n                if (res.result) {\n                  let messages;\n                  if (res.result.messages)\n                    messages = res.result.messages;\n                  else\n                    messages = [];\n                  if (res.result.message)\n                    messages.push(res.result.message);\n                  else if (res.result.warn)\n                    messages.push({ type: 'warn', message: res.result.warn });\n                  else if (res.result.info)\n                    messages.push({ type: 'info', message: res.result.info });\n                  else if (res.result.error)\n                    messages.push({ type: 'error', message: res.result.error });\n                  messages.forEach(function (msg) {\n                    if (_.isString(msg))\n                      Katrid.UI.Dialogs.Alerts.success(msg);\n                    else if (msg.type === 'warn')\n                      Katrid.UI.Dialogs.Alerts.warn(msg.message);\n                    else if (msg.type === 'info')\n                      Katrid.UI.Dialogs.Alerts.info(msg.message);\n                    else if ((msg.type === 'error') || (msg.type === 'danger'))\n                      Katrid.UI.Dialogs.Alerts.error(msg.message);\n                  });\n                }\n                resolve(res.result);\n              }\n            })\n            .catch(res => reject(res));\n          }\n        );\n      }\n    }\n  }\n\n\n  class Model extends Service {\n    searchName(name) {\n      if (_.isString(name))\n        name = { args: name };\n      return this.post('search_name', name);\n    }\n\n    createName(name) {\n      let kwargs = {name};\n      return this.post('create_name', { kwargs: kwargs });\n    }\n\n    search(data, params) {\n      return this.post('search', { kwargs: data }, params);\n    }\n\n    destroy(id) {\n      if (!_.isArray(id))\n        id = [id];\n      return this.post('destroy', { kwargs: {ids: id} });\n    }\n\n    getById(id) {\n      return this.post('get', { args: [id] });\n    }\n\n    getDefaults(kwargs) {\n      return this.post('get_defaults', { kwargs });\n    }\n\n    copy(id) {\n      return this.post('copy', { args: [id] });\n    }\n\n    static _prepareFields(res) {\n      if (res) {\n        res.fields = Katrid.Data.Fields.Field.fromArray(res.fields);\n        res.fieldList = Object.values(res.fields);\n        if (res.views) {\n          Object.values(res.views).map(v => v.fields = Katrid.Data.Fields.Field.fromArray(v.fields));\n          Object.keys(res.views).map(k => res.views[k] = new Katrid.UI.ViewInfo(res.views[k]));\n        }\n      }\n      return res;\n    }\n\n    getViewInfo(data) {\n      return this.post('get_view_info', { kwargs: data })\n      .then(this.constructor._prepareFields);\n    }\n\n    async loadViews(data) {\n      return this.post('load_views', { kwargs: data })\n      .then(this.constructor._prepareFields);\n    }\n\n    getFieldsInfo(data) {\n      return this.post('get_fields_info', { kwargs: data })\n      .then(this.constructor._prepareFields);\n    }\n\n    getFieldChoices(field, term, kwargs) {\n      return this.post('get_field_choices', { args: [ field, term ], kwargs: kwargs } );\n    }\n\n    doViewAction(data) {\n      return this.post('do_view_action', { kwargs: data });\n    }\n\n    write(data, params) {\n      return new Promise((resolve, reject) => {\n        this.post('write', {kwargs: {data}}, params)\n        .then((res) => {\n          Katrid.UI.Dialogs.Alerts.success(Katrid.i18n.gettext('Record saved successfully.'));\n          resolve(res);\n        })\n        .catch(res => {\n          if ((res.status === 500) && res.responseText)\n            alert(res.responseText);\n          else\n            Katrid.UI.Dialogs.Alerts.error(Katrid.i18n.gettext('Error saving record changes'));\n          reject(res);\n        });\n      });\n    }\n\n    groupBy(grouping, params) {\n      return this.post('group_by', { kwargs: { grouping, params } });\n    }\n\n    autoReport() {\n      return this.post('auto_report', { kwargs: {} });\n    }\n\n    rpc(meth, args, kwargs) {\n      // execute rpc\n      return new Promise((resolve, reject) => {\n        this.post(meth, { args: args, kwargs: kwargs })\n        .then(res => {\n          // open a document\n          if (res && res.open)\n            window.open(res.open);\n          resolve(res);\n        })\n        .catch(res => {\n          if (res.messages && _.isObject(res.messages))\n            for (let msg of Object.values(res.messages))\n              Katrid.UI.Dialogs.Alerts.error(msg.join('\\n'));\n          else\n            Katrid.UI.Dialogs.Alerts.error(res.message);\n          reject(res);\n        });\n      });\n    }\n  }\n\n\n  // Represents a server query\n  class Query extends Model {\n    constructor() {\n      super('ir.query');\n    }\n\n    static read(config) {\n      // read data from server\n      let details, id, params;\n      if (_.isObject(config)) {\n        details = config.details;\n        params = config.params;\n        id = config.id;\n      } else\n        id = config;\n      return (new Query()).post('read', { args: [id], kwargs: { with_desc: details, params, as_dict: config.as_dict } });\n    }\n\n    static all() {\n      return (new Query()).rpc('all');\n    }\n\n    static executeSql(sql) {\n      return (new Query()).post('execute_sql', { args: [sql] });\n    }\n  }\n\n\n  class Data extends Service {\n    static get url() { return '/web/data/' };\n\n    reorder(model, ids, field='sequence', offset=0) {\n      return this.post('reorder', { args: [ model, ids, field, offset ] });\n    }\n  }\n\n  class Attachments {\n    static destroy(id) {\n      let svc = new Model('ir.attachment');\n      svc.destroy(id);\n    }\n\n    static upload(file, scope=null) {\n      let data = new FormData();\n      if (scope === null) scope = angular.element(file).scope();\n      data.append('model', scope.model.name);\n      data.append('id', scope.recordId);\n      for (let f of file.files) data.append('attachment', f, f.name);\n      return $.ajax({\n        url: '/web/content/upload/',\n        type: 'POST',\n        data: data,\n        processData: false,\n        contentType: false\n      })\n      .done((res) => {\n        console.log('attachments', scope.attachments, scope);\n        if (!scope.attachments)\n          scope.attachments = [];\n        if (res)\n          for (let obj of res) scope.attachments.push(obj);\n        scope.$apply();\n      });\n    }\n  }\n\n  class View extends Model {\n    constructor() {\n      super('ui.view');\n    }\n\n    fromModel(model) {\n      return this.post('from_model', null, {model});\n    }\n  }\n\n\n  class Actions extends Model {\n    static load(action) {\n      let svc = new Model('ir.action');\n      return svc.post('load', { args: [action] });\n    }\n  }\n\n\n  class Auth extends Service {\n    static login(username, password) {\n      return this.$post('/web/login/', { username: username, password: password });\n    }\n  }\n\n  class Upload {\n    static sendFile(service, file) {\n      let form = new FormData();\n      form.append('files', file.files[0]);\n      let scope = angular.element(file).scope();\n      let url = `/web/file/upload/${scope.model.name}/${service}/`;\n      if (scope.record && scope.record.id)\n        form.append('id', scope.record.id);\n      // try to detect the current datasource to be refreshed if needed\n      let dataSource = scope.action.dataSource;\n      if (!dataSource) {\n        dataSource = scope.$parent.dataSource;\n        let s = scope.$parent;\n        while (s) {\n          dataSource = s.dataSource;\n          if (dataSource)\n            break;\n          s = scope.$parent;\n        }\n      }\n      $.ajax({\n        url: url,\n        data: form,\n        processData: false,\n        contentType: false,\n        type: 'POST',\n        success: (data) => {\n          dataSource.refresh();\n          Katrid.UI.Dialogs.Alerts.success('Operao realizada com sucesso.')\n        }\n      });\n    }\n\n    static uploadTo(url, file) {\n      let form = new FormData();\n      form.append('files', file.files[0]);\n      return $.ajax({\n        url: url,\n        data: form,\n        processData: false,\n        contentType: false,\n        type: 'POST',\n        success: (data) => {\n          Katrid.UI.Dialogs.Alerts.success('Arquivo enviado com sucesso!');\n        }\n      });\n    }\n  }\n\n  this.Katrid.Services = {\n    Data,\n    View,\n    data: new Data('', ),\n    Attachments,\n    Service,\n    Model,\n    Query,\n    Auth,\n    Upload,\n    Actions,\n    post(url, data) {\n      // post json data to server\n      return fetch(url, {\n        method: 'POST',\n        body: JSON.stringify(data),\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json',\n        },\n      }).then(res => res.json());\n    }\n  };\n\n})();\n\n","Katrid.Data = {};\n","(function() {\n\n  class Record {\n    constructor(data, dataSource, state) {\n      // current record data\n      this.raw = data;\n      // modified data only\n      this.data = {};\n      // original record\n      // this.old = jQuery.extend({}, data);\n      this.dataSource = dataSource;\n      this.pending = null;\n      this.modified = false;\n      this.children = [];\n      this.state = state;\n      this.submitted = false;\n      data.$record = this;\n    }\n\n    get scope() {\n      return this.dataSource.scope;\n    }\n\n    get pk() {\n      return this.raw.id;\n    }\n\n    $delete() {\n      this.state = RecordState.destroyed;\n      if (this.pk)\n        this.setModified();\n      else if (this.parent.children.indexOf(this) > -1)\n        this.parent.children.splice(this.parent.children.indexOf(this), 1);\n    }\n\n    _prepareRecord(rec, parent) {\n      console.log(rec.constructor.name);\n      return;\n      let getValue = (v) => {\n        if (_.isObject(v))\n          return this._prepareRecord(v, rec);\n        else if (_.isArray(v))\n          return v.map(obj => getValue(obj));\n        return v;\n      };\n\n      let res = {};\n      for (let [k, v] of Object.entries(rec)) {\n        // prevent circular json object\n        if (parent && _.isObject(v))\n          continue;\n        res[k] = getValue(v);\n        if (v)\n        console.log(v.constructor.name);\n      }\n      if (this.dataSource.parent && !parent) {\n        let field = this.dataSource.parent.scope.view.fields[this.dataSource.fieldName]._info.field;\n        res[field] = this.dataSource.parent.record.$record._prepareRecord(this.dataSource.parent.record);\n      }\n      return res;\n    }\n\n    setModified(field) {\n      if (!this.modified && (this.state !== RecordState.destroyed)) {\n        if (this.pk)\n          this.state = RecordState.modified;\n        else\n          this.state = RecordState.created;\n      }\n      if (field)\n        this.dataSource.$setDirty(field);\n      this.dataSource._pendingChanges = true;\n      this.modified = true;\n\n      if (this.parent && this.scope.fieldName) {\n        this.parent.setModified(this.scope.fieldName);\n        this.parent.addChild(this);\n      }\n    }\n\n    get parent() {\n      return this.dataSource.parent && this.dataSource.parent.record.$record;\n    }\n\n    addChild(child) {\n      this.setModified(child.scope.fieldName);\n      if (this.children.indexOf(child) === -1) {\n        this.children.push(child);\n      }\n    }\n\n    compare(oldValue, newValue) {\n      if (_.isArray(oldValue) && _.isArray(newValue))\n        return oldValue.join(',') !== newValue.join(',');\n      return oldValue != newValue;\n    }\n\n    set(propKey, value) {\n      let field = this.dataSource.fieldByName(propKey);\n      if (field) {\n        let oldValue = this.raw[propKey];\n        value = field.toJSON(value);\n        // check if field value has been changed\n        if (this.compare(oldValue, value)) {\n          this.setModified(propKey);\n          this.data[propKey] = value;\n          this.modified = true;\n          // send field change event\n          if (field.onChange) {\n            let rec = this.$encode(this.raw);\n            rec[propKey] = value;\n\n            // let's send parent data\n            if (this.dataSource.parent && this.dataSource.fieldName) {\n              let field = this.dataSource.parent.fields[this.dataSource.fieldName]._info.field;\n              rec[field] = this.$encode(this.dataSource.parent.record);\n            }\n\n            // send prepared data\n            this.dataSource.dispatchEvent('field_change_event', [propKey, rec]);\n          }\n        }\n      }\n      return true;\n    }\n\n    $encode(obj) {\n      if (_.isArray(obj))\n        return obj.map(v => this.$encode(v));\n      else if (_.isObject(obj)) {\n        let r = {};\n        for (let [k, v] of Object.entries(obj))\n          if (!k.startsWith('$'))\n            r[k] = this.$encode(v);\n        return r;\n      } else\n        return obj;\n    }\n\n    $new() {\n      return Record(this.raw);\n    }\n\n    toObject() {\n      let data = jQuery.extend({}, this.data);\n      if (this.pk)\n        data.id = this.pk;\n      for (let child of this.children) {\n        if (!(child.scope.fieldName in data))\n          data[child.scope.fieldName] = [];\n        if (child.state === RecordState.created)\n          data[child.scope.fieldName].push({ action: 'CREATE', values: child.toObject() });\n        else if (child.state === RecordState.modified)\n          data[child.scope.fieldName].push({ action: 'UPDATE', values: child.toObject() });\n        else if (child.state === RecordState.destroyed)\n          data[child.scope.fieldName].push({ action: 'DESTROY', id: child.pk });\n      }\n      return data;\n    }\n  }\n\n  class SubRecords {\n    constructor(recs) {\n      this.recs = recs;\n    }\n\n    append(rec) {\n      if (this.recs.indexOf(rec) === -1)\n        this.recs.push(rec);\n    }\n  }\n\n\n  function createRecord(rec, dataSource) {\n    new Record(rec, dataSource);\n    return new Proxy(rec, {\n      set(target, propKey, value, receiver) {\n        if (!propKey.startsWith('$$')) {\n          let scope = dataSource.scope;\n          let field = dataSource.fieldByName(propKey);\n          if (!propKey.startsWith('$') && scope && field && !(field instanceof Katrid.Data.Fields.OneToManyField)) {\n            rec.$record.set(propKey, value);\n          }\n        }\n        return Reflect.set(target, propKey, value, receiver);\n      }\n    })\n  }\n\n  class RecordState {\n    static initClass() {\n      this.destroyed = 'destroyed';\n      this.created = 'created';\n      this.modified = 'modified';\n    }\n  }\n  RecordState.initClass();\n\n  Katrid.Data.RecordState = RecordState;\n  Katrid.Data.createRecord = createRecord;\n  Katrid.Data.SubRecords = SubRecords;\n\n})();\n","(function () {\n\n  class DataSourceState {\n    static initClass() {\n      this.inserting = 'inserting';\n      this.browsing = 'browsing';\n      this.editing = 'editing';\n      this.loading = 'loading';\n      this.inactive = 'inactive';\n    }\n  }\n  DataSourceState.initClass();\n\n  DEFAULT_REQUEST_INTERVAL = 300;\n\n  class DataSource {\n    constructor(scope, action) {\n      this.readonly = false;\n      this.$modifiedRecords = [];\n      // this.onFieldChange = this.onFieldChange.bind(this);\n      this.scope = scope;\n      this.action = action;\n      this._recordIndex = 0;\n      this.recordCount = null;\n      this.loading = false;\n      this.loadingRecord = false;\n      this._masterSource = null;\n      this._pageIndex = 0;\n      this.pageLimit = 100;\n      this.offset = 0;\n      this.offsetLimit = 0;\n      this.requestInterval = DEFAULT_REQUEST_INTERVAL;\n      this.pendingRequest = null;\n      this.fieldName = null;\n      this.children = [];\n      this.modifiedData = null;\n      this.uploading = 0;\n      this._state = null;\n      this.fieldWatchers = [];\n      this._pendingChanges = false;\n      this.recordId = null;\n      scope.$fieldLog = {};\n    }\n\n    get pageIndex() {\n      return this._pageIndex;\n    }\n\n    set pageIndex(page) {\n      this._pageIndex = page;\n      console.log('goto page', page);\n      this.search(this._params, page, this._fields, DEFAULT_REQUEST_INTERVAL);\n    }\n\n    get fields() {\n      return this.scope.view.fields;\n    }\n\n    get loadingAction() {\n      return this._loadingAction;\n    }\n\n    set loadingAction(v) {\n      if (v) this.requestInterval = 0;\n      else this.requestInterval = DEFAULT_REQUEST_INTERVAL;\n      this._loadingAction = v;\n    }\n\n    async cancel() {\n      if (!this.changing)\n        return;\n\n      this._recordIndex = null;\n      this._pendingChanges = false;\n      if (this.state === DataSourceState.editing)\n        await this.refresh();\n      else if (this.action)\n        this.action.switchView('list');\n      this.state = DataSourceState.browsing;\n\n      this.scope.$emit('afterCancel', this);\n    }\n\n    async saveAndClose() {\n      // Save changes and close dialog\n      let r = await this.save(false);\n      this.scope.$emit('saveAndClose', this.scope, r);\n      return this.action.$element.closest('.modal').modal('hide');\n    }\n\n\n    async copy(id) {\n      let res = await this.model.copy(id);\n      this.record = {};\n      await this.insert();\n      this.setValues(res);\n      return res;\n    }\n\n    findById(id) {\n      for (let rec of this.scope.records)\n        if (rec.id === id)\n          return rec;\n      return null;\n    }\n\n    hasKey(id) {\n      return this.findById(id) !== null;\n    }\n\n    refresh(data) {\n      let r;\n      if (data) {\n        // Refresh current record\n        r = this.get(data[0]);\n      } else if (this.scope.record && this.scope.record.id) {\n        r = this.get(this.scope.record.id);\n      } else {\n        r = this.search(this._params, this._page);\n      }\n      r.then(() => {\n        for (let child in this.children)\n          if (child.invalidate) {\n            child.invalidate(this.recordId);\n            child.scope.$apply();\n          }\n      });\n      return r;\n    }\n\n    _validateForm(elForm, form, errorMsgs) {\n      let elfield;\n      for (let errorType in form.$error)\n        if (errorType === 'required')\n        for (let child of Array.from(form.$error[errorType])) {\n          if (child.$name.startsWith('grid-row-form'))\n            elfield = this._validateForm(elForm.find('#' + child.$name), child, errorMsgs);\n          else {\n            elfield = elForm.find(`.form-field[name=\"${child.$name}\"]`);\n            elfield.addClass('ng-touched');\n            let scope = angular.element(elForm).scope();\n            const field = scope.view.fields[child.$name];\n            errorMsgs.push(`<span>${field.caption}</span><ul><li>${Katrid.i18n.gettext('This field cannot be empty.')}</li></ul>`);\n          }\n        }\n        else\n          console.log(form.$error[errorType]);\n\n      return elfield;\n    }\n\n    validate(raiseError=true) {\n      if (this.scope.form.$invalid) {\n        let elfield;\n        let errors = [];\n        let s = `<span>${Katrid.i18n.gettext('The following fields are invalid:')}</span><hr>`;\n        const el = this.scope.formElement;\n        elfield = this._validateForm(el, this.scope.form, errors);\n        Katrid.ui.uiKatrid.setFocus(elfield);\n        s += errors.join('');\n        Katrid.ui.Dialogs.Alerts.error(s);\n        if (raiseError)\n          throw Error('Error validating form: ' + s);\n        return false;\n      }\n      return true;\n    }\n\n    indexOf(obj) {\n      if (this.scope.records)\n        return this.scope.records.indexOf(this.findById(obj.id));\n    }\n\n    search(params, page, fields, timeout) {\n      let master = this.masterSource;\n      // if (this.groups && !this.groups.length && this.scope.defaultGrouping) {\n      //   let g = {\n      //     context: {\n      //       grouping: [this.scope.defaultGrouping]\n      //     }\n      //   };\n      //   this.groupBy(g);\n      //   return;\n      // }\n      this._params = params;\n      this._page = page;\n      this._fields = fields;\n      this._clearTimeout();\n      this.pendingRequest = true;\n      this.loading = true;\n      page = page || 1;\n      this._pageIndex = page;\n      let domain;\n      if (this.action)\n        domain = this.action.info.domain;\n      if (domain) {\n        domain = JSON.parse(domain);\n      }\n      if (_.isObject(fields))\n        fields = Object.keys(fields);\n      params = {\n        count: true,\n        page,\n        params,\n        fields,\n        domain,\n        limit: this.pageLimit,\n      };\n\n      return new Promise(\n        (resolve, reject) => {\n\n          let req = () => {\n            this.model.search(params)\n            .catch(res => {\n              return reject(res);\n            })\n            .then(res => {\n              if (this.pageIndex > 1) {\n                this.offset = ((this.pageIndex - 1) * this.pageLimit) + 1;\n              } else {\n                this.offset = 1;\n              }\n              this.scope.$apply(() => {\n                if (res.count != null)\n                  this.recordCount = res.count;\n\n                let data = res.data;\n                if (this.readonly)\n                  this.scope.records = data;\n                else\n                  this.scope.records = data.map((obj) => Katrid.Data.createRecord(obj, this));\n                // list view uses only groups\n                this.scope.groups = this.scope.records;\n                if (this.pageIndex === 1) {\n                  return this.offsetLimit = this.scope.records.length;\n                } else {\n                  return this.offsetLimit = (this.offset + this.scope.records.length) - 1;\n                }\n              });\n              return resolve(res);\n            })\n            .finally(() => {\n              this.pendingRequest = false;\n              this.scope.$apply(() => {\n                this.loading = false;\n              });\n            });\n          };\n\n          timeout = 0;\n\n          if (((this.requestInterval > 0) || timeout) && (timeout !== false))\n            this.pendingRequest = setTimeout(req, this.requestInterval);\n          else req();\n        }\n      );\n    }\n\n    async groupBy(group, params) {\n      this._params = [];\n      console.log('group by', group, params);\n      if (!group || !group.length) {\n        this.groups = [];\n        this.action.groups = null;\n        this.scope.groups = null;\n        this.search(params);\n        return;\n      }\n      this.scope.action.groups = group;\n      this.scope.groupings = [];\n      this.groups = group;\n      this.scope.groups = await this._loadGroup(group, 0, params);\n      return this.scope.$apply();\n    }\n\n    async _loadGroup(group, index, params, parent) {\n      let rows = [];\n      if (!params)\n        params = [];\n      if (parent && parent.$params)\n        params = params.concat(parent.$params);\n      let res = await this.model.groupBy([group[index]], params);\n      const groupName = group[index];\n      for (let r of res) {\n        let s = r[groupName];\n        let paramValue;\n        if ($.isArray(s)) {\n          paramValue = s[0];\n          s = s[1];\n        } else {\n          paramValue = s;\n        }\n        r.__str__ = s;\n        r.$expanded = false;\n        r.$group = groupName;\n        r.$params = [];\n        if (parent)\n          r.$params = r.$params.concat(parent.$params);\n        let params = {};\n        params[groupName] = paramValue;\n        r.$params.push(params);\n        r.$level = index;\n        r.$hasChildren = true;\n\n        // add group object to list\n        rows.push(r);\n      }\n      return rows;\n    }\n\n    goto(index) {\n      return this.recordIndex = index;\n    }\n\n    moveBy(index) {\n      const newIndex = (this._recordIndex + index);\n      if ((newIndex > -1) && (newIndex < this.scope.records.length))\n        this.recordIndex = newIndex;\n    }\n\n    _clearTimeout() {\n      this.loading = false;\n      this.loadingRecord = false;\n      this._canceled = true;\n      clearTimeout(this.pendingRequest);\n    }\n\n    set masterSource(master) {\n      this._masterSource = master;\n      master.children.push(this);\n    }\n\n    get masterSource() {\n      return this._masterSource;\n    }\n\n    applyModifiedData(form, element, record) {\n      const data = this.getModifiedData(form, element, record);\n      const _id = _.hash(record);\n      if (data) {\n        let ds = this.modifiedData;\n        if ((ds == null)) {\n          ds = {};\n        }\n        let obj = ds[_id];\n        if (!obj) {\n          obj = {};\n          ds[_id] = obj;\n        }\n        for (let attr in data) {\n          const v = data[attr];\n          obj[attr] = v;\n          //record[attr] = v;\n        }\n\n        this.modifiedData = ds;\n        this.masterSource.scope.form.$setDirty();\n      }\n      return data;\n    }\n\n    getNestedData() {\n      let ret = {};\n      for (let child of this.children)\n        if (child.$modifiedRecords.length) {\n          let res = [];\n          let deleted = [];\n          for (let rec of child.$modifiedRecords) {\n            if (rec.$deleted) {\n              deleted.push(rec);\n              if ((rec.id !== null) && (rec.id !== undefined))\n                res.push({id: rec.id, action: 'DESTROY'})\n            }\n          }\n\n          for (let rec of child.$modifiedRecords) {\n            console.log(rec.$modified, rec.$modifiedData);\n            if (rec.$modifiedData && !rec.$deleted && rec.$modified && (deleted.indexOf(rec) === -1)) {\n              let data = this._getModified(rec.$modifiedData);\n              if (rec.id)\n                data['id'] = rec.id;\n              jQuery.extend(data, child.getNestedData());\n              if ((rec.id === null) || (rec.id === undefined))\n                res.push({\n                  action: 'CREATE',\n                  values: data,\n                });\n              else if ((rec.id !== null) && (rec.id !== undefined))\n                res.push({\n                  action: 'UPDATE',\n                  values: data,\n                });\n            }\n          }\n          if (Object.keys(res).length > 0)\n            ret[child.fieldName] = res;\n        }\n      return ret;\n    }\n\n    save(autoRefresh=true) {\n      // Save pending children\n      for (let child of this.children)\n        if (child.changing)\n          child.scope.save();\n\n      const el = this.action.$form;\n      if (this.validate()) {\n        const data = this.record.$record.toObject();\n        // const data = this.getModifiedData(this.scope.form, el, this.scope.record);\n        this.scope.form.data = data;\n\n        let beforeSubmit = el.attr('before-submit');\n        if (beforeSubmit)\n          beforeSubmit = this.scope.$eval(beforeSubmit);\n\n        //@scope.form.data = null\n\n        if (data) {\n          this.uploading++;\n          return this.model.write([data])\n          .then(res => {\n            // this._clearCache();\n            if (this.action && this.action.viewType && (this.action.viewType === 'form'))\n              Katrid.app.$location.search('id', res[0]);\n            this.scope.form.$setPristine();\n            this.scope.form.$setUntouched();\n            this._pendingChanges = false;\n            this.state = DataSourceState.browsing;\n            if (autoRefresh)\n              return this.refresh(res);\n            else\n              return res;\n\n          })\n          .catch(error => {\n            let s = `<span>${Katrid.i18n.gettext('The following fields are invalid:')}<hr></span>`;\n            if (error.message)\n              s = error.message;\n            else if (error.messages) {\n              let elfield;\n              for (let fld of Object.keys(error.messages)) {\n                const msgs = error.messages[fld];\n                let field;\n                // check qualified field name\n                if (fld.indexOf('.') > -1) {\n                  fld = fld.split('.');\n                  let subField = fld[1];\n                  for (let child of this.children)\n                    if (child.scope.fieldName === fld[0]) {\n                      field = child.scope.view.fields[subField];\n                    }\n                } else\n                  field = this.scope.view.fields[fld];\n                console.log('field invalid', field);\n                if (!field || !field.name)\n                  continue;\n                elfield = el.find(`.form-field[name=\"${field.name}\"]`);\n                elfield.addClass('ng-invalid ng-touched');\n                s += `<strong>${field.caption}</strong><ul>`;\n                for (let msg of msgs) {\n                  s += `<li>${msg}</li>`;\n                }\n                s += '</ul>';\n              }\n              if (elfield)\n                elfield.focus();\n            }\n\n            Katrid.UI.Dialogs.Alerts.error(s);\n            throw new Error(s);\n\n          })\n          .finally(() => this.scope.$apply(() => this.uploading-- ) );\n        } else\n          Katrid.UI.Dialogs.Alerts.warn(Katrid.i18n.gettext('No pending changes'));\n      }\n    }\n\n    _getNested(recs) {\n      let res = [];\n      if (recs.$deleted && recs.$deleted.recs.length)\n        for (let rec of recs.$deleted.recs)\n          res.push({id: rec.id, action: 'DESTROY'});\n\n      let vals;\n      if (recs.recs.length)\n        for (let rec of recs.recs) if (rec) {\n          vals = {};\n          if (rec.$created)\n            vals = {\n              action: 'CREATE',\n              values: this._getModified(rec.$modifiedData)\n            };\n          else if (rec.$modified) {\n            vals = {\n              action: 'UPDATE',\n              values: this._getModified(rec.$modifiedData)\n            };\n            vals.values.id = rec.id;\n          }\n          else\n            continue;\n          res.push(vals);\n        }\n\n      return res;\n    }\n\n\n    _getModified(data) {\n      let res = {};\n      if (data)\n        for (let [k, v] of Object.entries(data))\n          if (v instanceof Katrid.Data.SubRecords) {\n            res[k] = this._getNested(v);\n          } else\n            res[k] = v;\n      return res;\n    }\n\n    getModifiedData(form, element, record) {\n      let data = {};\n      if (record.$modified)\n        jQuery.extend(data, this._getModified(record.$modifiedData));\n\n      if (this.record.id)\n        data['id'] = record.id;\n      return data;\n    }\n\n    get(id, timeout, apply=true, index=false) {\n      this._clearTimeout();\n      this.state = DataSourceState.loading;\n      this.loadingRecord = true;\n      this._canceled = false;\n\n      return new Promise(\n        (resolve, reject) => {\n          const _get = () => {\n            return this.model.getById(id)\n            .catch(res => {\n              return reject(res);\n            })\n            .then(res => {\n              if (this._canceled || !res)\n                return;\n              if (this.state === DataSourceState.loading)\n                this.state = DataSourceState.browsing;\n              else if (this.state === DataSourceState.inserting)\n                return;\n              this.record = res.data[0];\n              if (index !== false)\n                this.scope.records[index] = this.record;\n              // if (apply)\n              //   this.scope.$apply();\n              return resolve(this.record);\n            })\n            .finally(() => {\n                this.loadingRecord = false;\n              if (apply)\n                return this.scope.$apply();\n            });\n          };\n          if (!timeout && !this.requestInterval)\n            return _get();\n          else\n            this.pendingRequest = setTimeout(_get, timeout || this.requestInterval);\n\n        }\n      );\n    }\n\n    get defaultValues() {\n\n    }\n\n    set defaultValues(values) {\n      for (let [k, v] of Object.entries(values)) {\n        if (_.isObject(v) && (k in this.fields)) {\n          this.fields[k].defaultValues = v;\n        }\n      }\n    }\n\n    async insert(loadDefaults=true, defaultValues, kwargs) {\n      this._clearTimeout();\n      for (let child of this.children)\n        child._clearTimeout();\n      let rec = {};\n      rec.$created = true;\n      let oldRecs = this.scope.records;\n      this.record = rec;\n      this.scope.records = oldRecs;\n      let res;\n      // check if load defaults is needed\n      if (loadDefaults)\n        // load default fields values with optional kwargs\n        res = await this.model.getDefaults(kwargs);\n\n      for (let child of this.children)\n        child.scope.records = [];\n\n      this.state = DataSourceState.inserting;\n      this.scope.record.display_name = Katrid.i18n.gettext('(New)');\n\n      let defaults = {};\n      if (this.masterSource && this.field && this.field.defaultValues)\n        Object.assign(defaults, this.field.defaultValues);\n      for (let v of Object.values(this.fields))\n        if (v.default)\n          defaults[v.name] = v.default;\n      if (this.scope.ngDefaultValues)\n        Object.assign(defaults, this.scope.$eval(this.scope.ngDefaultValues));\n      if (this.action.context.default_values)\n        Object.assign(defaults, this.action.context.default_values);\n      if (defaultValues)\n        Object.assign(defaults, defaultValues);\n      if (res)\n        Object.assign(defaults, res);\n\n      // eval functions values\n      for (let [k, v] of Object.entries(defaults))\n        if (_.isFunction(v)) {\n          v = v(defaults, this);\n          if (!_.isUndefined(v))\n            defaults[k] = v;\n        }\n      this.setValues(defaults);\n    }\n\n    _new() {\n      return Katrid.Data.createRecord({}, this);\n    }\n\n    setValues(values) {\n      Object.entries(values).forEach(([k, v]) => {\n        let fld = this.fields[k];\n        if (fld)\n          fld.fromJSON(v, this);\n        else\n          this.scope.record[k] = v;\n      });\n\n      this.scope.$apply();\n    }\n\n    edit() {\n      this.state = DataSourceState.editing;\n    }\n\n    toClientValue(attr, value) {\n      const field = this.scope.view.fields[attr];\n      if (field) {\n        if (field.type === 'DateTimeField') {\n          value = new Date(value);\n        }\n      }\n      return value;\n    }\n\n    fieldByName(fieldName) {\n      if (this.scope.views)\n        return this.scope.views.form.fields[fieldName];\n      else\n        return this.scope.view.fields[fieldName];\n    }\n\n    set state(state) {\n      // Clear modified fields information\n      this._modifiedFields = [];\n      this._state = state;\n      this.inserting = state === DataSourceState.inserting;\n      this.editing = state === DataSourceState.editing;\n      this.loading = state === DataSourceState.loading;\n      this.changing =  [DataSourceState.editing, DataSourceState.inserting].includes(this.state);\n      if (this.scope)\n        this.scope.$emit('dataStateChange', this);\n    }\n\n    get browsing() {\n      return this._state === DataSourceState.browsing;\n    }\n\n    childByName(fieldName) {\n      for (let child of this.children) {\n        if (child.fieldName === fieldName)\n          return child;\n      }\n    }\n\n    get state() {\n      return this._state;\n    }\n\n    get record() {\n      return this.scope.record;\n    }\n\n    set recordId(value) {\n      // refresh record id\n      this.scope.recordId = value;\n      // refresh children\n      // avoid grid field delayed\n      for (let child of this.children)\n        child.pendingMasterId = value;\n      this.scope.$broadcast('masterChanged', this, value);\n    }\n\n    get recordId() {\n      return this.scope.recordId;\n    }\n\n    set record(rec) {\n      // Track field changes\n      this.scope.record = Katrid.Data.createRecord(rec, this);\n      this.recordId = rec.id;\n      this._pendingChanges = false;\n      if (this.scope.form)\n        this.scope.form.$setPristine();\n      // this.state = DataSourceState.browsing;\n    }\n\n    next() {\n      return this.moveBy(1);\n    }\n\n    prior() {\n      return this.moveBy(-1);\n    }\n\n    nextPage() {\n      let p = this.recordCount / this.pageLimit;\n      if (Math.floor(p)) {\n        p++;\n      }\n      if (p > (this.pageIndex + 1)) {\n        this.pageIndex++;\n      }\n    }\n\n    prevPage() {\n      if (this.pageIndex > 1) {\n        this.pageIndex--;\n      }\n    }\n\n    set recordIndex(index) {\n      this._recordIndex = index;\n      this.scope.record = this.scope.records[index];\n      if (!this.parent)\n        return Katrid.app.$location.search('id', this.scope.record.id);\n      // load record\n      this.scope.recordId = null;\n      // set new id on browser address\n    }\n\n    get recordIndex() {\n      return this._recordIndex;\n    }\n\n    async expandGroup(index, row) {\n      let params = [];\n      if (this._params)\n        params = params.concat(this._params);\n      if (row.$params)\n        params = params.concat(row.$params);\n      if (row.$level === (this.groups.length - 1)) {\n        let res = await this.model.search({params});\n        if (res.data) {\n          row.$children = res.data;\n          this.scope.$apply(() => {\n            this.scope.groups.splice.apply(this.scope.groups, [index + 1, 0].concat(res.data));\n          })\n        }\n        this.scope.records = this._chain();\n      } else {\n        // expand next group level\n        let rows = await this._loadGroup(this.groups, row.$level + 1, this._params, row);\n        row.$children = rows;\n        this.scope.groups.splice.apply(this.scope.groups, [index + 1, 0].concat(rows));\n        this.scope.$apply();\n      }\n\n      // .then(res => {\n      //   console.log('')\n      //   if (res.ok && res.result.data) {\n      //     return this.action.scope.$apply(() => {\n      //       rg._children = res.result.data;\n      //       return this.action.scope.records.splice.apply(this.scope.records, [index + 1, 0].concat(res.result.data));\n      //     });\n      //   }\n    }\n\n    collapseGroup(index, row) {\n      let collapse = (index, row) => {\n        console.log('collapse', index, row);\n        if (row.$children && row.$children.length && row.$level !== (this.groups.length - 1))\n          row.$children.map(obj => collapse(this.scope.groups.indexOf(obj), obj));\n        if (row.$children && row.$children.length)\n          this.scope.groups.splice(index+1, row.$children.length);\n        row.$children = [];\n      };\n      collapse(index, row);\n      this.scope.records = this._chain();\n    }\n\n    _chain() {\n      let records = [];\n      for (let obj of this.scope.groups)\n        if (obj.$hasChildren && obj.$expanded && obj.$children.length)\n          records = records.concat(obj.$children);\n      return records;\n    }\n\n    _applyResponse(res) {\n      if (res) {\n        if (res.value)\n          this.setValues(res.value);\n        this.scope.$apply();\n      }\n    }\n\n    async dispatchEvent(name, ...args) {\n      let res = await this.model.rpc(name, ...args);\n      this._applyResponse(res);\n    }\n\n    get model() {\n      return this.scope.model;\n    }\n\n    open() {\n      this.search({}, 1, this.action.view.fields);\n    }\n\n    get parent() {\n      return this.masterSource;\n    }\n\n    set parent(value) {\n      this._masterSource = value;\n    }\n\n    $setDirty(field) {\n      let form = this.scope.form;\n      if (form) {\n        let control = form[field];\n        if (control)\n          control.$setDirty();\n      } else if (this.action)\n        this.action.setDirty(field);\n    }\n\n    destroyChildren() {\n      for (let child of this.children)\n        child.scope.$destroy();\n      this.children = [];\n    }\n  }\n\n\n  Katrid.Data.DataSource = DataSource;\n  Katrid.Data.DataSourceState = DataSourceState;\n\n})();\n","(function() {\n\n  function toCamelCase(s) {\n    // remove all characters that should not be in a variable name\n    // as well underscores an numbers from the beginning of the string\n    s = s.replace(/([^a-zA-Z0-9_\\- ])|^[_0-9]+/g, \"\").trim().toLowerCase();\n\n    // uppercase letters preceeded by a hyphen or a space\n    s = s.replace(/([ -]+)([a-zA-Z0-9])/g, function(a,b,c) {\n      return c.toUpperCase();\n    });\n\n    // uppercase letters following numbers\n    s = s.replace(/([0-9]+)([a-zA-Z])/g, function(a,b,c) {\n      return b + c.toUpperCase();\n    });\n\n    return s;\n  }\n\n  class Field {\n    constructor(info) {\n      this.cols = info.cols || 6;\n      this.visible = true;\n      this._info = info;\n      this.cssClass = info.type;\n      this.caption = info.caption || info.name;\n      this.helpText = this._info.help_text;\n      this.required = this._info.required;\n      this.onChange = this._info.onchange;\n      this.nolabel = false;\n\n      if (this._info.visible === false)\n        this.visible = false;\n      this.readonly = this._info.readonly;\n      if (!this.readonly)\n        this.readonly = false;\n\n      this.displayChoices = _.object(info.choices);\n      this.choices = info.choices;\n\n      if (info.choices)\n        this.template = {\n          list: 'view.list.selection-field.jinja2',\n          form: 'view.form.selection-field.jinja2',\n        };\n      else\n        this.template = {\n          list: 'view.list.field.jinja2',\n          form: 'view.form.field.jinja2',\n        };\n\n      if (info.template)\n        this.template = Object.assign(this.template, info.template);\n\n      this.emptyText = '--';\n    }\n\n    static fromInfo(info) {\n      let cls = Katrid.Data.Fields[info.type] || StringField;\n      return new cls(info);\n    }\n\n    static fromArray(fields) {\n      let r = {};\n      Object.keys(fields).map(k => r[k] = this.fromInfo(fields[k]));\n      return r;\n    }\n\n    render(viewType, el, context) {\n      this.$el = el;\n      let attrs = {};\n      for (let attr of el[0].attributes) {\n        attrs[attr.name] = attr.value;\n        let camelCase = toCamelCase(attr.name);\n        if (camelCase !== attr.name)\n          attrs[camelCase] = attr.value;\n      }\n\n      if (attrs.cols)\n        this.cols = attrs.cols;\n      if (attrs.ngReadonly)\n        this.ngReadonly = attrs.ngReadonly;\n      if (attrs.domain)\n        this.domain = attrs.domain;\n      if (attrs.visible === 'false')\n        this.visible = false;\n      else if (attrs.visible === 'true')\n        this.visible = true;\n      if (attrs.ngShow)\n        this.ngShow = attrs.ngShow;\n      if (attrs.ngIf)\n        this.ngIf = attrs.ngIf;\n      if (attrs.ngClass)\n        this.ngClass = attrs.ngClass;\n      this.attrs = attrs;\n\n      context['field'] = this;\n      context['attrs'] = attrs;\n\n      // replace the field content by its html content\n      context['html'] = el.html();\n\n      return Katrid.app.getTemplate(this.template[viewType], context);\n    }\n\n    assign(el) {\n      this.$el = el;\n      let caption = el.attr('label');\n      if (!_.isUndefined(caption))\n          this.caption = caption;\n      let readonly = el.attr('ng-readonly');\n      let invisible = el.attr('invisible');\n      if (!_.isUndefined(invisible))\n        this.visible = false;\n      if (!_.isUndefined(readonly))\n        this.ngReadonly = readonly;\n      let cols = el.attr('cols');\n      if (!_.isUndefined(cols))\n        this.cols = cols;\n\n    }\n\n    fromJSON(value, dataSource) {\n      dataSource.record[this.name] = value;\n    }\n\n    get validAttributes() {\n       return ['name', 'nolabel', 'readonly', 'required'];\n    }\n\n    getAttributes() {\n      let res = {};\n      let validAttrs = this.validAttributes;\n      if (this.ngReadonly)\n        res['ng-readonly'] = this.ngReadonly;\n      else if (this.readonly)\n        res['readonly'] = this.readonly;\n      res['ng-model'] = 'record.' + this.name;\n      if (attrs.ngFieldChange) {\n        res['ng-change'] = attrs.ngFieldChange;\n        console.log('change', attrs.ngFieldChange);\n      }\n      if (this.required)\n        res['required'] = this.required;\n      return res;\n    }\n\n    get hasChoices() {\n      return this._info.choices && this._info.choices.length > 0;\n    }\n\n   get name() {\n      return this._info.name;\n    }\n\n    get model() {\n      return this._info.model;\n    }\n\n    get maxLength() {\n      return this._info.max_length;\n    }\n\n    get type() {\n      return this._info.type;\n    }\n\n    get paramTemplate() {\n      return 'view.param.String';\n    }\n\n    format(value) {\n      return value.toString();\n    }\n\n    toJSON(val) {\n      return val;\n    }\n\n    createWidget(widget, scope, attrs, element) {\n      if (!widget) {\n        // special fields case\n        if (this.hasChoices)\n          widget = 'SelectionField';\n      }\n      let cls = Katrid.ui.Widgets[widget || this.type] || Katrid.ui.Widgets.StringField;\n      return new cls(scope, attrs, this, element);\n    }\n\n    validate() {\n\n    }\n\n    get defaultCondition() {\n      return '=';\n    }\n\n    isControlVisible(condition) {\n      switch (condition) {\n        case 'is null':\n          return false;\n        case 'is not null':\n          return false;\n      }\n      return true;\n    }\n\n  }\n\n  class StringField extends Field {\n    constructor(info) {\n      if (!info.cols)\n        info.cols = 3;\n      super(...arguments);\n    }\n  }\n\n  class PasswordField extends StringField {\n    constructor(info) {\n      if (!info.template)\n        info.template = {};\n      if (!info.template.form)\n        info.template.form = 'view.form.password.jinja2';\n      if (!info.template.list)\n        info.template.list = 'view.list.password.jinja2';\n      super(info);\n    }\n  }\n\n\n  class BooleanField extends Field {\n    constructor(info) {\n      if (!info.cols)\n        info.cols = 3;\n      super(...arguments);\n      this.template.form = 'view.form.boolean-field.jinja2';\n      this.template.list = 'view.list.boolean-field.jinja2';\n      this.nolabel = true;\n    }\n\n    get paramTemplate() {\n      return 'view.param.Boolean';\n    }\n\n  }\n\n  class DateField extends Field {\n    constructor(info) {\n      if (!info.cols)\n        info.cols = 3;\n      super(...arguments);\n      this.template.form = 'view.form.date-field.jinja2';\n      this.template.list = 'view.list.date-field.jinja2';\n    }\n\n    toJSON(val) {\n      return val;\n    }\n\n    get paramTemplate() {\n      return 'view.param.Date';\n    }\n\n    format(value) {\n      if (_.isString(value))\n        return moment(value).format(Katrid.i18n.gettext('yyyy-mm-dd').toUpperCase());\n      return '';\n    }\n\n    getAttributes(attrs) {\n      let res = super.getAttributes(attrs);\n      res['type'] = 'date';\n      return res;\n    }\n  }\n\n  class DateTimeField extends DateField {\n    constructor(info) {\n      if (!info.cols)\n        info.cols = 3;\n      super(...arguments);\n      this.template.form = 'view.form.datetime-field.jinja2';\n      this.template.list = 'view.list.datetime-field.jinja2';\n    }\n\n    get paramTemplate() {\n      return 'view.param.DateTime';\n    }\n\n    getAttributes(attrs) {\n      let res = super.getAttributes(attrs);\n      res['type'] = 'datetime-local';\n      return res;\n    }\n  }\n\n\n  class TimeField extends DateTimeField {\n    constructor(info) {\n      if (!info.cols)\n        info.cols = 3;\n      super(...arguments);\n      this.template.form = 'view.form.time-field.jinja2';\n      this.template.list = 'view.list.time-field.jinja2';\n    }\n  }\n\n\n  class NumericField extends Field {\n    constructor(info) {\n      if (!info.cols)\n        info.cols = 3;\n      super(...arguments);\n      if (Katrid.UI.isMobile)\n        this.template.form = 'view.form.numpad-field.pug';\n      else\n        this.template.form = 'view.form.numeric-field.jinja2';\n      this.template.list = 'view.list.numeric-field.jinja2';\n    }\n\n    fromJSON(value, dataSource) {\n      dataSource.record[this.name] = parseFloat(value);\n    }\n\n    toJSON(val) {\n      if (val && _.isString(val))\n        return parseFloat(val);\n      return val;\n    }\n\n  }\n\n\n  class IntegerField extends Field {\n    constructor(info) {\n      if (!info.cols)\n        info.cols = 3;\n      super(...arguments);\n    }\n\n    toJSON(val) {\n      if (val && _.isString(val))\n        return parseInt(val);\n      return val;\n    }\n\n    get paramTemplate() {\n      return 'view.param.Integer';\n    }\n  }\n\n  class FloatField extends NumericField {\n  }\n\n  class DecimalField extends NumericField {\n    constructor() {\n      super(...arguments);\n      this.decimalPlaces = 2;\n      if (this._info.attrs) {\n        this.decimalPlaces = this._info.attrs.decimal_places || 2;\n      }\n    }\n  }\n\n  class ForeignKey extends Field {\n    constructor(info) {\n      super(...arguments);\n      this.domain = info.domain;\n      Object.assign(this.template, {\n        list: 'view.list.foreignkey.jinja2',\n        form: 'view.form.foreignkey.jinja2',\n      });\n    }\n\n    assign(el) {\n      super.assign(el);\n      let domain = $(el).attr('domain');\n      if (domain)\n        this.domain = domain;\n    }\n\n    toJSON(val) {\n      if (_.isArray(val))\n        return val[0];\n      return val;\n    }\n\n    get validAttributes() {\n      return super.validAttributes.concat(['domain']);\n    }\n  }\n\n  class OneToManyField extends Field {\n    constructor(info) {\n      if (!info.cols)\n        info.cols = 12;\n      super(...arguments);\n      this.template.form = 'view.form.grid.jinja2';\n    }\n    get field() {\n      return this._info.field;\n    }\n\n    get validAttributes() {\n      return super.validAttributes.concat(['inline-editor', 'ng-default-values']);\n    }\n\n    fromJSON(val, dataSource) {\n      if (val && val instanceof Array) {\n        let child = dataSource.childByName(this.name);\n        val.map((obj) => {\n          if (obj.action === 'CLEAR') {\n            child.scope.records = [];\n            dataSource.record[this.name] = [];\n          }\n          else if (obj.action === 'CREATE') {\n            child.scope.addRecord(obj.values);\n          }\n        });\n          child.scope.$apply();\n\n      }\n    }\n  }\n\n  class ManyToManyField extends ForeignKey {\n    toJSON(val) {\n      if (_.isArray(val))\n        return val.map(obj => _.isArray(obj) ? obj[0] : obj);\n      else if (_.isString(val))\n        val = val.split(',');\n      return val;\n    }\n  }\n\n  class TextField extends StringField {\n    constructor(info) {\n      super(...arguments);\n      if (!info.template || (info.template && !info.template.form))\n        this.template.form = 'view.form.text-field.jinja2';\n    }\n  }\n\n  class XmlField extends TextField {\n    constructor(info) {\n      super(...arguments);\n      // TODO change to code editor\n      if (!info.template || (info.template && !info.template.form))\n        this.template.form = 'view.form.code-editor.jinja2';\n    }\n  }\n\n  class JsonField extends TextField {\n    constructor(info) {\n      super(...arguments);\n      // TODO change to code editor\n      if (!info.template || (info.template && !info.template.form))\n        this.template.form = 'view.form.json-field.jinja2';\n    }\n  }\n\n  class PythonCodeField extends TextField {\n    constructor(info) {\n      super(...arguments);\n      console.log('python code field');\n      if (!info.template || (info.template && !info.template.form))\n        this.template.form = 'view.form.python-code.jinja2';\n    }\n  }\n\n  class ImageField extends Field {\n    constructor(info) {\n      if (!info.template)\n        info.template = {};\n      if (!info.template.form)\n        info.template.form = 'view.form.image-field.jinja2';\n      super(...arguments);\n      this.noImageUrl = '/static/web/assets/img/no-image.png';\n    }\n\n    getAttributes(attrs) {\n      let res = super.getAttributes(attrs);\n      res.ngSrc = attrs.ngEmptyImage || (attrs.emptyImage && (`'${attrs.emptyImage}`)) || `'${this.noImageUrl}'`;\n      res.ngSrc = `{{ ${res['ng-model']} || ${res.ngSrc} }}`;\n      return res;\n    }\n\n    get ngSrc() {\n      let ngSrc = this.attrs.ngEmptyImage || (this.attrs.emptyImage && (`'${this.attrs.emptyImage}`)) || `'${this.noImageUrl}'`;\n      ngSrc = `\\${ record.${this.name} || ${ngSrc} }`;\n      return ngSrc\n    }\n  }\n\n  Katrid.Data.Fields = {\n    Field,\n    StringField,\n    PasswordField,\n    IntegerField,\n    FloatField,\n    DecimalField,\n    DateTimeField,\n    TimeField,\n    ForeignKey,\n    OneToManyField,\n    ManyToManyField,\n    TextField,\n    XmlField,\n    JsonField,\n    PythonCodeField,\n    DateField,\n    BooleanField,\n    ImageField,\n  }\n\n\n})();\n","var Katrid;\n(function (Katrid) {\n    var UI;\n    (function (UI) {\n        Katrid.UI = {\n            keyCode: {\n                BACKSPACE: 8,\n                COMMA: 188,\n                DELETE: 46,\n                DOWN: 40,\n                END: 35,\n                ENTER: 13,\n                ESCAPE: 27,\n                HOME: 36,\n                LEFT: 37,\n                PAGE_DOWN: 34,\n                PAGE_UP: 33,\n                PERIOD: 190,\n                RIGHT: 39,\n                SPACE: 32,\n                TAB: 9,\n                UP: 38\n            },\n            toggleFullScreen() {\n                if (!document.fullscreenElement &&\n                    !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {\n                    if (document.documentElement.requestFullscreen) {\n                        document.documentElement.requestFullscreen();\n                    }\n                    else if (document.documentElement.msRequestFullscreen) {\n                        document.documentElement.msRequestFullscreen();\n                    }\n                    else if (document.documentElement.mozRequestFullScreen) {\n                        document.documentElement.mozRequestFullScreen();\n                    }\n                    else if (document.documentElement.webkitRequestFullscreen) {\n                        document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n                    }\n                }\n                else {\n                    if (document.exitFullscreen) {\n                        document.exitFullscreen();\n                    }\n                    else if (document.msExitFullscreen) {\n                        document.msExitFullscreen();\n                    }\n                    else if (document.mozCancelFullScreen) {\n                        document.mozCancelFullScreen();\n                    }\n                    else if (document.webkitExitFullscreen) {\n                        document.webkitExitFullscreen();\n                    }\n                }\n            }\n        };\n        Katrid.UI.uiKatrid = angular.module('ui.katrid', []);\n    })(UI = Katrid.UI || (Katrid.UI = {}));\n})(Katrid || (Katrid = {}));\n","(function () {\n\n  class ActionManager extends Array {\n    constructor() {\n      super();\n      this.currentAction = null;\n      this.mainAction = null;\n    }\n\n    addAction(action) {\n      if (!this.mainAction)\n        this.mainAction = action;\n      this.push(action);\n      this.currentAction = action;\n    }\n\n    back(action, url) {\n      if (action)\n        this.action = action;\n      else if (this.length > 1)\n        this.action = this[this.length-2];\n      this.action.$attach();\n      this.action.refreshBreadcrumb();\n      if (angular.isString(url))\n        Katrid.app.loadPage(url);\n      else if (url)\n        Katrid.app.$location.search(url);\n    }\n\n    removeAction(action) {\n      this.splice(this.indexOf(action), this.length);\n      if (this.length === 0)\n        this.mainAction = null;\n    }\n\n    get action() {\n      return this.currentAction;\n    }\n\n    set action(action) {\n      let i = this.indexOf(action);\n      if (i > -1) {\n        i++;\n        while (this.length > i)\n          this[i].$destroy();\n        this.currentAction = action;\n      }\n    }\n\n    clear() {\n      for (let action of this)\n        action.$destroy();\n      this.length = 0;\n      this.mainAction = null;\n      this.currentAction = null;\n    }\n\n    get path() {\n      return this.action.path;\n    }\n\n    doAction(action) {\n\n    }\n\n    async onHashChange(params, reset) {\n      let actionId = params.action;\n\n      // clear action manager history\n      if (reset)\n        this.clear();\n\n      // check if action has changed\n      let oldAction, action;\n      action = oldAction = this.currentAction;\n\n\n      // action auto detection\n      if (!actionId && params.model && (!action || (action.params && (action.params.model !== params.model)))) {\n        // get a virtual window action\n        let svc = new Katrid.Services.Model(params.model);\n        let actionInfo = await svc.rpc('get_formview_action', [params.id]);\n        let scope = this.createScope();\n        action = scope.action = new Katrid.Actions[actionInfo.action_type](actionInfo, scope, params);\n      } else if (!(this.currentAction && (this.currentAction.info.id == actionId))) {\n        if (this.currentAction && reset)\n          this.currentAction.$destroy();\n        let actionInfo = await Katrid.Services.Actions.load(actionId);\n        let scope = this.createScope();\n        action = scope.action = new Katrid.Actions[actionInfo.action_type](actionInfo, scope, params);\n      }\n\n      await action.onHashChange(params);\n    }\n\n    createScope() {\n      let scope = Katrid.app.$scope.$new(true);\n      scope._ = _;\n      return scope;\n    }\n\n    get breadcrumb() {\n      if (this._breadcrumb)\n        return this._breadcrumb;\n      let breadcrumb = [];\n      for (let action of this) {\n        let bc = action.breadcrumb;\n        if (bc && bc.length) {\n          for (let b of bc)\n            b.isLeaf = false;\n          breadcrumb.push(...bc);\n        }\n      }\n      breadcrumb[breadcrumb.length-1].isLeaf = true;\n      this._breadcrumb = breadcrumb;\n      return breadcrumb;\n    }\n  }\n\n  class Action {\n    static initClass() {\n      this.actionType = null;\n      this._context = null;\n    }\n\n    constructor(info, scope, params, $container) {\n      this.info = info;\n      this.scope = scope;\n      Katrid.app.actionManager.addAction(this);\n\n      if (!$container)\n        $container = Katrid.app.$element;\n      this.$parent = $container;\n    }\n\n    $destroy() {\n      Katrid.app.actionManager.removeAction(this);\n      this.scope.$destroy();\n      if (this.$element)\n        // check if there's an element\n        this.$element.remove();\n      else\n        // or clear the container\n        this.$parent.empty();\n    }\n\n    get id() {\n      return this.info.id;\n    }\n\n    get context() {\n      if (!this._context) {\n        if (_.isString(this.info.context))\n          this._context = JSON.parse(this.info.context);\n        else\n          this._context = {};\n      }\n      return this._context;\n    }\n\n    doAction(act) {\n      let type = act.type || act.action_type;\n      return Katrid.Actions[type].dispatchAction(this, act);\n    }\n\n    openObject(evt) {\n      evt.preventDefault();\n      evt.stopPropagation();\n      if (evt.ctrlKey) {\n        window.open(evt.target.href);\n        return false;\n      } else {\n        console.log(evt.target.href);\n        location.hash = evt.target.href;\n      }\n      return false;\n    }\n\n    restore() {}\n\n    apply() {}\n    backTo(index) {\n      let b = Katrid.app.actionManager.breadcrumb[index];\n      if (b)\n        Katrid.app.actionManager.back(b.action, b.url);\n      return;\n      if (this._currentPath !==  this._unregisterHook && (Katrid.app.actionManager.length > 1))\n        this._unregisterHook();\n\n      // restore to query view\n      let action = Katrid.app.actionManager[index];\n      if ((index === 0) && (viewType === 0))\n        return action.restore(action.searchViewType || action.viewModes[0]);\n      else if ((index === 0) && (viewType === 'form'))\n        return action.restore('form');\n\n      Katrid.app.actionManager.action = action;\n\n      if (!viewType)\n        viewType = 'form';\n\n      let location;\n      location = action.currentUrl;\n      action.info.__cached = true;\n      let p = this.location.path(location, true, action.info);\n      let search = action._currentParams[viewType];\n      console.log('search', search);\n      if (search)\n        p.search(search);\n    }\n\n    execute() {}\n\n    getCurrentTitle() {\n      return this.info.display_name;\n    }\n\n    search() {\n      if (!this.isDialog) {\n        return this.location.search.apply(null, arguments);\n      }\n    }\n\n\n    async onHashChange(params) {\n      location.hash = '#/app/?' + $.param(params);\n      await this.execute();\n    }\n  }\n  Action.initClass();\n\n\n  class ViewAction extends Action {\n    static initClass() {\n      this.actionType = 'ir.action.view';\n    }\n\n    async onHashChange(params) {\n      location.hash = '#/app/?' + $.param(params);\n      let svc = new Katrid.Services.Model('ir.action.view');\n      let res = await svc.post('get_view', { args: [ this.info.view[0] ] });\n      let content = res.content;\n      Katrid.app.$element.html(Katrid.Core.$compile(content)(this.scope));\n    }\n  }\n  ViewAction.initClass();\n\n\n  class UrlAction extends Action {\n    static initClass() {\n      this.actionType = 'ir.action.url';\n    }\n\n    constructor(info, scope, location) {\n      super(info, scope, location);\n      window.location.href = info.url;\n    }\n  }\n  UrlAction.initClass();\n\n\n  Katrid.Actions = {\n    Action,\n    ViewAction,\n    UrlAction,\n    ActionManager,\n  };\n\n\n  Katrid.Actions[ViewAction.actionType] = ViewAction;\n  Katrid.Actions[UrlAction.actionType] = UrlAction;\n\n\n})();\n","(function() {\n\n  class ClientAction extends Katrid.Actions.Action {\n    static initClass() {\n      this.actionType = 'ir.action.client';\n      this.registry = {};\n    }\n\n    static register(tag, obj) {\n      this.registry[tag] = obj;\n    }\n\n    static executeTag(parent, act) {\n      // get action\n      let action = this.registry[act.tag];\n      if (action.prototype instanceof Katrid.UI.Views.ActionView) {\n        action = new action(parent.scope);\n        action.renderTo(parent);\n      }\n      else console.log('is a function');\n    }\n\n    static tagButtonClick(btn) {\n      let action = {\n        type: 'ir.action.client',\n        tag: btn.attr('name'),\n        target: btn.attr('target') || 'new',\n      };\n\n      action = new ClientAction(action, Katrid.Actions.actionManager.action.scope, Katrid.Actions.actionManager.action.location);\n      action.execute();\n    }\n\n    tag_refresh() {\n      this.dataSource.refresh();\n    }\n\n    get templateUrl() {\n      console.log(this.tag);\n      return this.tag.templateUrl;\n    }\n\n    async execute() {\n      let tag = ClientAction.registry[this.info.tag];\n      this.tag = tag;\n      if (tag.prototype instanceof Katrid.UI.Views.ClientView) {\n        this.tag = new tag(this);\n        let el = await this.tag.render();\n        if (this.info.target === 'new') {\n          el = el.modal();\n        } else {\n          $('#katrid-action-view').empty().append(el);\n        }\n      } else if (_.isString(tag))\n        this[tag].apply(this);\n    }\n\n    async routeUpdate(location) {\n      // this.execute();\n    }\n\n    get template() {\n      return this.tag.template;\n    }\n  }\n\n  ClientAction.initClass();\n\n  Katrid.Actions.ClientAction = ClientAction;\n  Katrid.Actions[ClientAction.actionType] = ClientAction;\n\n})();\n","(function() {\n\n  class WindowAction extends Katrid.Actions.Action {\n    static initClass() {\n      this.actionType = 'ir.action.window';\n    }\n\n    constructor(info, scope, params, $container) {\n      super(info, scope, params, $container);\n      this.viewMode = info.view_mode;\n      this.viewModes = this.viewMode.split(',');\n      if (info.model)\n        scope.model = this.model = new Katrid.Services.Model(info.model);\n      this.dataSource = new Katrid.Data.DataSource(scope, this);\n      scope.$on('dataStateChange', this.onDataStateChange);\n      scope.$on('afterCancel', (evt, dataSource) => {\n        if (dataSource === this.dataSource)\n          this.afterCancel(evt, dataSource);\n      });\n    }\n\n    afterCancel(evt, dataSource) {\n      if (dataSource.state === Katrid.Data.DataSourceState.inserting) {\n        this.dataSource.record = {};\n        this.back();\n      }\n    }\n\n    back() {\n      Katrid.app.actionManager.history.back();\n    }\n\n    setDirty(field) {\n      const control = this.form[field];\n      if (control) {\n        control.$setDirty();\n      }\n    }\n\n    async onHashChange(params) {\n      // normalize hash\n      let invalidate = false;\n      let allowedParams = ['action', 'view_type', 'menu_id', 'model'];\n      let loadRecord = (this.params && (this.params.id !== params.id));\n      this.params = {};\n      if (!params.view_type) {\n        this.params.view_type = this.viewModes[0];\n        invalidate = true;\n      }\n      if (!params.model) {\n        this.params.model = this.info.model;\n        invalidate = true;\n      }\n\n      Object.assign(this.params, params);\n      // view type form accepts id param\n      if (this.params.view_type === 'form')\n        allowedParams.splice(0, 0, 'id');\n      if (Object.keys(this.params).length === allowedParams.length) {\n        for (let k of Object.keys(this.params))\n          if (!allowedParams.includes(k)) {\n            invalidate = true;\n          }\n      } else\n        invalidate = true;\n\n      // invalidate location hash\n      if (invalidate) {\n        let oldParams = this.params;\n        this.params = {};\n        for (let k of allowedParams)\n          this.params[k] = oldParams[k];\n\n        // the action param is not required if empty\n        if (!this.params.action)\n          delete this.params.action;\n\n        // redirect to new params\n        location.hash = '#/app/?' + $.param(this.params);\n      }\n\n      // apply params\n      let viewType = this.params.view_type;\n      if (viewType !== this.viewType) {\n        this.viewType = viewType;\n        await this.execute();\n      }\n      if (this.params.id && (this.dataSource.recordId != this.params.id))\n        await this.dataSource.get(this.params.id);\n    }\n\n    rpc(method, data, event) {\n      if (event)\n        event.stopPropagation();\n      if (!data)\n        data = {};\n      else if (_.isArray(data))\n        data = { args: data };\n      else if (!_.isObject(data))\n        data = { args: [data] };\n      this.model.rpc(method, data.args, data.kwargs);\n    }\n\n    getContext() {\n      let ctx = super.getContext();\n      let sel = this.selection;\n      if (sel && sel.length) {\n        ctx.active_id = sel[0];\n        ctx.active_ids = sel;\n      }\n      return ctx;\n    }\n\n    restore(viewType) {\n      // restore the last search mode view type\n      let url = this._currentPath || this.location.$$path;\n      let params = this._currentParams[viewType] || {};\n      params['view_type'] = viewType;\n      if (Katrid.app.actionManager.length > 1) {\n        params['actionId'] = this.info.id;\n        this.$state.go('actionView', params);\n        // this.location.path(url);\n        // this.location.search(params);\n      } else {\n        this.viewType = viewType;\n      }\n      // window.location.href = '/web/#' + url + '?view_type=list';\n      // this.setViewType(viewType, this._currentParams[viewType]);\n    }\n\n    getCurrentTitle() {\n      if (this.viewType === 'form') {\n        return this.scope.record.display_name;\n      }\n      return super.getCurrentTitle();\n    }\n\n    switchView(viewType, params) {\n      if (viewType !== this.viewType) {\n        this.viewType = viewType;\n        this.execute();\n        let search = Katrid.app.$location.$$search;\n        Object.assign(search, params);\n        search.view_type = viewType;\n        Katrid.app.$location.search(search);\n      }\n    }\n\n    createNew() {\n      this.switchView('form', { id: null });\n    }\n\n    async deleteSelection() {\n      let sel = this.selection;\n      if (!sel)\n        return false;\n      if (\n        ((sel.length === 1) && confirm(Katrid.i18n.gettext('Confirm delete record?'))) ||\n        ((sel.length > 1) && confirm(Katrid.i18n.gettext('Confirm delete records?')))\n      ) {\n        await this.model.destroy(sel);\n        const i = this.scope.records.indexOf(this.scope.record);\n        this.viewType = 'list';\n        this.dataSource.refresh();\n      }\n    }\n\n    async copy() {\n      this.viewType = 'form';\n      await this.dataSource.copy(this.scope.record.id);\n      return false;\n    }\n\n    async copyTo(configId) {\n      if (this.scope.recordId) {\n        let svc = new Katrid.Services.Model('ir.copy.to');\n        let res = await svc.rpc('copy_to', [configId, this.scope.recordId]);\n        let model = new Katrid.Services.Model(res.model);\n        let views = await model.getViewInfo({ view_type: 'form' });\n        let wnd = new Katrid.ui.Dialogs.Window(this.scope, { view: views }, Katrid.Core.compile, null, model);\n        wnd.createNew({ defaultValues: res.value });\n      }\n    }\n\n    makeUrl(viewType) {\n      // get the default view mode\n      if (!viewType)\n        viewType = this.viewModes[0];\n\n      const search = {\n        action: this.info.id,\n        view_type: viewType,\n        menu_id: Katrid.app.$location.$$search.menu_id,\n      };\n      if ((viewType === 'form') && this.record)\n        search.id = this.record.id;\n      return search;\n    }\n\n    get record() {\n      // returns the active record\n      return this.scope.record;\n    }\n\n    get searchModes() {\n      // returns search view modes\n      return this.viewModes.filter(v => v !== 'form');\n    }\n\n    get breadcrumb() {\n      let breadcrumb = [];\n      if (this.searchModes.length) {\n        breadcrumb.push({ action: this, url: this.makeUrl(this.lastViewType), text: this.info.display_name });\n      }\n      if (this.viewType === 'form') {\n        let h = { action: this, url: this.makeUrl('form') };\n        if (this === Katrid.app.actionManager.currentAction)\n          h.text = '${ record.display_name }';\n        else\n          h.text = this.record && this.record.display_name;\n        breadcrumb.push(h);\n      }\n      return breadcrumb;\n    }\n\n    refreshBreadcrumb() {\n      Katrid.app.actionManager._breadcrumb = null;\n\n      let templ = Katrid.app.getTemplate('view.breadcrumb.jinja2', {\n        breadcrumb: Katrid.app.actionManager.breadcrumb,\n        action: this\n      });\n      templ = Katrid.Core.$compile(templ)(this.scope);\n      this.$element.find('.breadcrumb-nav').html(templ);\n    }\n\n    $detach() {\n      this.$element.detach();\n    }\n\n    $attach() {\n      this.$element.appendTo(this.$parent);\n    }\n\n    async execute() {\n      if (!this.views) {\n        let res = await this.model.loadViews({\n          views: this.info.views,\n          action: this.info.id,\n          toolbar: true\n        });\n        this.fields = res.fields;\n        this.fieldList = res.fieldList;\n        this.views = res.views;\n\n        // pre-render the action container\n        let templ = Katrid.app.getTemplate('ir.action.window.jinja2', { action: this });\n        templ = Katrid.Core.$compile(templ)(this.scope);\n        this.$parent.html(templ);\n        this.$element = templ;\n        this.$container = this.$element.find('.action-view-content:first');\n      }\n      this.refreshBreadcrumb();\n      this.scope.view = this.views[this.viewType];\n      let view = new Katrid.UI.Views[this.viewType](this, this.scope.view);\n\n      if (this.viewType !== 'form') {\n        this.lastViewType = this.viewType;\n        this.lastUrl = location.hash;\n      }\n\n      // render view to main container\n      view.renderTo(this.$container);\n      setTimeout(() => {\n        if ((this.viewType === 'form') && !Katrid.app.$location.$$search.id)\n          this.dataSource.insert();\n      })\n    }\n\n    get viewType() {\n      return this._viewType;\n    }\n\n    set viewType(value) {\n      if (value !== this._viewType) {\n        // invalidate the current record id\n        if (value !== 'form')\n          this.dataSource.recordId = null;\n        // destroy children fields\n        this.dataSource.destroyChildren();\n        this._viewType = value;\n      }\n\n      return;\n      if (!value)\n        value = this.viewModes[0];\n\n      if (value === this._viewType)\n        return;\n\n      if (!this._viewType)\n        this.searchViewType = this.viewModes[0];\n\n      this.view = this.views[value];\n      this._viewType = value;\n      this.switchView(value);\n\n      if (!this.scope.$$phase)\n        this.scope.$apply();\n\n      if (this.location.$$search.view_type !== value) {\n        this.location.search({ view_type: value });\n      }\n\n      $(Katrid).trigger('formReady', [this.scope]);\n    }\n\n    searchText(q) {\n      return this.location.search('q', q);\n    }\n\n    _prepareParams(params) {\n      const r = {};\n      for (let p of Array.from(params)) {\n        if (p.field && (p.field.type === 'ForeignKey')) {\n          r[p.field.name] = p.id;\n        } else {\n          r[p.id.name + '__icontains'] = p.text;\n        }\n      }\n      return r;\n    }\n\n    setSearchParams(params) {\n      let p = {};\n      if (this.info.domain)\n        p = $.parseJSON(this.info.domain);\n      for (let [k, v] of Object.entries(p)) {\n        let arg = {};\n        arg[k] = v;\n        params.push(arg);\n      }\n      return this.dataSource.search(params);\n    }\n\n    applyGroups(groups, params) {\n      return this.dataSource.groupBy(groups, params);\n    }\n\n    groupHeaderClick(record, index) {\n      console.log('group header click', record);\n      record.$expanded = !record.$expanded;\n      if (record.$expanded) {\n        this.dataSource.expandGroup(index, record);\n      } else {\n        this.dataSource.collapseGroup(index, record);\n      }\n    }\n\n    doViewAction(viewAction, target, confirmation, prompt) {\n      return this._doViewAction(this.scope, viewAction, target, confirmation, prompt);\n    }\n\n    _doViewAction(scope, viewAction, target, confirmation, prompt) {\n      let promptValue = null;\n      if (prompt) {\n        promptValue = window.prompt(prompt);\n      }\n      if (!confirmation || (confirmation && confirm(confirmation))) {\n        return this.model.doViewAction({ action_name: viewAction, target, prompt: promptValue })\n        .then(function(res) {\n          let msg, result;\n          if (res.status === 'open') {\n            return window.open(res.open);\n          }\n        });\n      }\n    }\n\n    async formButtonClick(id, meth, self) {\n      const res = await this.scope.model.rpc(meth, [id]);\n      if (res.open)\n        return window.open(res.open);\n      if (res.download) {\n        let a = document.createElement('a');\n        a.href = res.download;\n        a.click();\n        return;\n      }\n      if (res.tag === 'refresh')\n        this.dataSource.refresh();\n      if (res.type) {\n        const act = new (Katrid.Actions[res.type])(res, this.scope, this.scope.location);\n        act.execute();\n      }\n    };\n\n    doBindingAction(evt) {\n      this.selection;\n      Katrid.Services.Actions.load($(evt.currentTarget).data('id'))\n      .then(action => {\n\n        if (action.action_type === 'ir.action.report')\n          Katrid.Actions.ReportAction.dispatchBindingAction(this, action);\n\n      });\n    }\n\n    listRowClick(index, row, evt) {\n      if (row.$hasChildren) {\n        console.log('list row click');\n        this.groupHeaderClick(row, index);\n      } else {\n        const search = {\n          id: row.id,\n          action: this.info.id,\n          view_type: 'form',\n          menu_id: Katrid.app.$location.$$search.menu_id,\n        };\n        if (evt.ctrlKey) {\n          const url = `#${hash}`;\n          window.open(url);\n          return;\n        } else\n          Katrid.app.$location.search(search);\n        this.dataSource.recordIndex = index;\n      }\n    }\n\n    onDataStateChange(event, dataSource) {\n      let self = dataSource.scope.action;\n      if (dataSource.changing)\n        setTimeout(() => {\n          if (self.$element)\n            for (let el of Array.from(self.$element.find(\"input[type!=hidden].form-field:visible\"))) {\n              el = $(el);\n              if (!el.attr('readonly')) {\n                $(el).focus();\n                return;\n              }\n            }\n        });\n    }\n\n    autoReport() {\n      return this.model.autoReport()\n      .then(function(res) {\n        if (res.ok && res.result.open) {\n          return window.open(res.result.open);\n        }\n      });\n    }\n\n    showDefaultValueDialog() {\n      const html = Katrid.UI.Utils.Templates.getSetDefaultValueDialog();\n      const modal = $(Katrid.core.compile(html)(this.scope)).modal();\n      modal.on('hidden.bs.modal', function() {\n        $(this).data('bs.modal', null);\n        return $(this).remove();\n      });\n    }\n\n    selectToggle(el) {\n      this._selection = $(el).closest('table').find('td.list-record-selector :checkbox').filter(':checked');\n      this.selectionLength = this._selection.length;\n    }\n\n    get selection() {\n      if (this.viewType === 'form') {\n        if (this.scope.recordId)\n          return this.scope.recordId;\n        else\n          return;\n      }\n      if (this._selection)\n        return Array.from(this._selection).map((el) => ($(el).data('id')));\n    }\n\n    deleteAttachment(attachments, index) {\n      let att = attachments[index];\n      if (confirm(Katrid.i18n.gettext('Confirm delete attachment?'))) {\n        attachments.splice(index, 1);\n        Katrid.Services.Attachments.destroy(att.id);\n      }\n    }\n  }\n  WindowAction.initClass();\n\n  Katrid.Actions.WindowAction = WindowAction;\n  Katrid.Actions[WindowAction.actionType] = WindowAction;\n\n})();\n","(() => {\n\n  class Loader {\n    constructor(templateCache) {\n      this.$cache = templateCache;\n    }\n\n    getSource(name) {\n      return {\n        src: this.$cache.get(name),\n        path: name,\n        noCache: false,\n      }\n    }\n  }\n\n  class Templates {\n    constructor(app, templates) {\n      this.app = app;\n      Templates.env = new nunjucks.Environment(new Loader(app.$templateCache), { autoescape: false });\n      let oldGet = app.$templateCache.get;\n      app.$templateCache.get = name => {\n        return this.prepare(name, oldGet.call(this, name));\n      };\n      this.loadTemplates(app.$templateCache, templates);\n      for (let [k, v] of Object.entries(PRE_LOADED_TEMPLATES))\n        app.$templateCache.put(k, v);\n    }\n\n    prepare(name, templ) {\n      if (_.isUndefined(templ)) throw Error('Template not found: ' + name);\n      if (templ.tagName === 'SCRIPT')\n        return templ.innerHTML;\n      return templ;\n    }\n\n    compileTemplate(base, templ) {\n      let el = $(base);\n      templ = $(templ.innerHTML);\n      for (let child of Array.from(templ))\n        if (child.tagName === 'JQUERY') {\n          child = $(child);\n          let sel = child.attr('selector');\n          let op = child.attr('operation');\n          if (sel) sel = $(el).find(sel);\n          else sel = el;\n          sel[op](child[0].innerHTML);\n        }\n      return el[0].innerHTML;\n    }\n\n    loadTemplates(templateCache, res) {\n      let templateLst = {};\n      let readTemplates = el => {\n        if (el.tagName === 'TEMPLATES') Array.from(el.children).map(readTemplates);\n        else if (el.tagName === 'SCRIPT') {\n          templateLst[el.id] = el.innerHTML;\n        }\n      };\n      let preProcess = el => {\n        if (el.tagName === 'TEMPLATES') Array.from(el.children).map(preProcess);\n        else if (el.tagName === 'SCRIPT') {\n          let base = el.getAttribute('extends');\n          let id = el.getAttribute('id') || base;\n          if (base) {\n            el = templateLst[base] + el;\n          } else\n            id = el.id;\n          templateCache.put(id, el);\n        }\n      };\n      let parser = new DOMParser();\n      let doc = parser.parseFromString(res, 'text/html');\n      let root = doc.firstChild.children[1].firstChild;\n      readTemplates(root);\n      preProcess(root);\n    }\n\n  }\n\n  let PRE_LOADED_TEMPLATES = {};\n\n  Katrid.UI.registerTemplate = function(name, tmpl) {\n    PRE_LOADED_TEMPLATES[name] = tmpl;\n  };\n\n  Katrid.UI.Templates = Templates;\n  Katrid.UI.Templates.PRE_LOADED_TEMPLATES = PRE_LOADED_TEMPLATES;\n\n})();\n","(function() {\n\n  class ReportAction extends Katrid.Actions.Action {\n    static initClass() {\n      this.actionType = 'ir.action.report';\n    }\n\n    static async dispatchBindingAction(parent, action) {\n      let format = localStorage.katridReportViewer || 'pdf';\n      let sel = parent.selection;\n      console.log('selection ', sel);\n      if (sel)\n        sel = sel.join(',');\n      let params = { data: [{ name: 'id', value: sel }] };\n      const svc = new Katrid.Services.Model('ir.action.report');\n      let res = await svc.post('export_report', { args: [action.id], kwargs: { format, params } });\n      if (res.open)\n        return window.open(res.open);\n    }\n\n    get name() {\n      return this.info.name;\n    }\n\n    constructor(info, scope, location) {\n      super(info, scope, location);\n      this.templateUrl = 'view.report.jinja2';\n      this.userReport = {};\n    }\n\n    userReportChanged(report) {\n      return this.location.search({\n        user_report: report});\n    }\n\n    async onHashChange(params) {\n      console.log('report hash change', params);\n      this.userReport.id = params.user_report;\n      if (this.userReport.id) {\n        const svc = new Katrid.Services.Model('ir.action.report');\n        let res = await svc.post('load_user_report', { kwargs: { user_report: this.userReport.id } });\n        this.userReport.params = res.result;\n      } else {\n        // Katrid.core.setContent(, this.scope);\n      }\n      location.hash = '#/app/?' + $.param(params);\n      let templ = Katrid.Reports.Reports.renderDialog(this);\n      templ = Katrid.Core.$compile(templ)(this.scope);\n      $('#katrid-action-view').empty().append(templ);\n    }\n\n  }\n  ReportAction.initClass();\n\n  Katrid.Actions.ReportAction = ReportAction;\n  Katrid.Actions[ReportAction.actionType] = ReportAction;\n\n})();\n","(function () {\n  let _counter = 0;\n\n\n  class Reports {\n    static initClass() {\n      this.currentReport = {};\n      this.currentUserReport = {};\n    }\n\n    static get(repName) {}\n\n    static renderDialog(action) {\n      console.log(action);\n      return Katrid.app.getTemplate('view.report.jinja2', { action: action });\n    }\n  }\n  Reports.initClass();\n\n\n  class Report {\n    constructor(action, scope) {\n      this.action = action;\n      this.scope = scope;\n      this.info = this.action.info;\n      Katrid.Reports.Reports.currentReport = this;\n      if ((Params.Labels == null)) {\n        Params.Labels = {\n          exact: Katrid.i18n.gettext('Is equal'),\n          in: Katrid.i18n.gettext('Selection'),\n          contains: Katrid.i18n.gettext('Contains'),\n          startswith: Katrid.i18n.gettext('Starting with'),\n          endswith: Katrid.i18n.gettext('Ending with'),\n          gt: Katrid.i18n.gettext('Greater-than'),\n          lt: Katrid.i18n.gettext('Less-than'),\n          between: Katrid.i18n.gettext('Between'),\n          isnull: Katrid.i18n.gettext('Is Null')\n        };\n      }\n\n      this.name = this.info.name;\n      this.id = ++_counter;\n      this.values = {};\n      this.params = [];\n      this.filters = [];\n      this.groupables = [];\n      this.sortables = [];\n      this.totals = [];\n    }\n\n    telegram() {\n      Katrid.Reports.Telegram.export(this);\n    }\n\n    getUserParams() {\n      const report = this;\n      const params = {\n        data: [],\n        file: report.container.find('#id-report-file').val()\n      };\n      for (let p of Array.from(this.params)) {\n        params.data.push({\n          name: p.name,\n          op: p.operation,\n          value1: p.value1,\n          value2: p.value2,\n          type: p.type\n        });\n      }\n\n      const fields = report.container.find('#report-id-fields').val();\n      params['fields'] = fields;\n\n      const totals = report.container.find('#report-id-totals').val();\n      params['totals'] = totals;\n\n      const sorting = report.container.find('#report-id-sorting').val();\n      params['sorting'] = sorting;\n\n      const grouping = report.container.find('#report-id-grouping').val();\n      params['grouping'] = grouping;\n\n      return params;\n    }\n\n    loadFromXml(xml) {\n      let dataTypeDict = {\n        date: 'DateField',\n        datetime: 'DateTimeField',\n      };\n\n      if (_.isString(xml)) {\n        xml = $(xml);\n      }\n      this.scope.customizableReport = xml.attr('customizableReport');\n      this.scope.advancedOptions = xml.attr('advancedOptions');\n      this.model = xml.attr('model');\n      const fields = [];\n\n      for (let f of Array.from(xml.find('param,field'))) {\n        let tag = f.tagName;\n        f = $(f);\n        const name = f.attr('name');\n        console.log(this.info);\n        let fld;\n        if (this.info.fields)\n          fld = this.info.fields[name];\n        const label = f.attr('label') || f.attr('caption') || (fld && fld.caption) || name;\n        const groupable = f.attr('groupable');\n        const sortable = f.attr('sortable');\n        const total = f.attr('total');\n        let param = f.attr('param');\n        if ((tag === 'FIELD') && (!param))\n          param = 'static';\n        const required = f.attr('required');\n        const autoCreate = f.attr('autoCreate') || required || (param === 'static');\n        const operation = f.attr('operation');\n        let type = f.attr('type') || f.data('type') || (fld && fld.type);\n        if (type in dataTypeDict)\n          type = dataTypeDict[type];\n\n        const modelChoices = f.attr('model-choices');\n        if (!type && modelChoices) type = 'ModelChoices';\n        fields.push({\n          name,\n          label,\n          groupable,\n          sortable,\n          total,\n          param,\n          required,\n          operation,\n          modelChoices,\n          type,\n          autoCreate,\n          field: f,\n        });\n      }\n\n      const params = (Array.from(xml.find('param')).map((p) => $(p).attr('name')));\n\n      return this.load(fields, params);\n    }\n\n    saveDialog() {\n      const params = this.getUserParams();\n      const name = window.prompt(Katrid.i18n.gettext('Report name'), Katrid.Reports.Reports.currentUserReport.name);\n      if (name) {\n        Katrid.Reports.Reports.currentUserReport.name = name;\n        $.ajax({\n          type: 'POST',\n          url: this.container.find('#report-form').attr('action') + '?save=' + name,\n          contentType: \"application/json; charset=utf-8\",\n          dataType: 'json',\n          data: JSON.stringify(params)\n        });\n      }\n      return false;\n    }\n\n    load(fields, params) {\n      if (!fields) {\n        ({ fields } = this.info);\n      }\n      if (!params) {\n        params = [];\n      }\n      this.fields = fields;\n      this.scope.fields = {};\n\n      // Create params\n      for (let p of fields) {\n        this.scope.fields[p.name] = p;\n        if (p.groupable)\n          this.groupables.push(p);\n        if (p.sortable)\n          this.sortables.push(p);\n        if (p.total)\n          this.totals.push(p);\n        if (!p.autoCreate) p.autoCreate = params.includes(p.name);\n      }\n    }\n\n    loadParams() {\n      for (let p of Array.from(this.fields)) {\n        if (p.autoCreate)\n          this.addParam(p.name);\n      }\n    }\n\n    addParam(paramName) {\n      for (let p of Array.from(this.fields))\n        if (p.name === paramName) {\n          p = new Param(p, this);\n          this.params.push(p);\n          //$(p.render(@elParams))\n          break;\n        }\n    }\n\n    getValues() {}\n\n\n    export(format) {\n      if (format == null)\n        format = localStorage.katridReportViewer || 'pdf';\n      const params = this.getUserParams();\n      console.log('send params', params);\n      const svc = new Katrid.Services.Model('ir.action.report');\n      svc.post('export_report', { args: [this.info.id], kwargs: { format, params } })\n      .then(function(res) {\n        if (res.open) {\n          return window.open(res.open);\n        }\n      });\n      return false;\n    }\n\n    preview() {\n      return this.export(localStorage.katridReportViewer);\n    }\n\n    renderFields() {\n      let p;\n      let el = $('<div></div>');\n      const flds = this.fields.map(p => `<option value=\"${p.name}\">${p.label}</option>`).join('');\n      const aggs = ((() => {\n        const result1 = [];\n        for (p of Array.from(this.fields)) {\n          if (p.total) {\n            result1.push(`<option value=\"${p.name}\">${p.label}</option>`);\n          }\n        }\n        return result1;\n      })()).join('');\n      el = this.container.find('#report-params');\n      let sel = el.find('#report-id-fields');\n      sel.append($(flds))\n      .select2({ tags: ((() => {\n        const result2 = [];\n        for (p of Array.from(this.fields)) result2.push({id: p.name, text: p.label});\n        return result2;\n      })()) });\n      if (Katrid.Reports.Reports.currentUserReport.params && Katrid.Reports.Reports.currentUserReport.params.fields) {\n        console.log(Katrid.Reports.Reports.currentUserReport.params.fields);\n        sel.select2('val', Katrid.Reports.Reports.currentUserReport.params.fields);\n      }\n      //sel.data().select2.updateSelection([{ id: 'vehicle', text: 'Vehicle'}])\n      sel = el.find('#report-id-totals');\n      sel.append(aggs)\n      .select2({ tags: ((() => {\n        const result3 = [];\n        for (p of Array.from(this.fields)) {         if (p.total) {\n            result3.push({ id: p.name, text: p.label });\n          }\n        }\n        return result3;\n      })()) });\n      return el;\n    }\n\n    renderParams(container) {\n      let p;\n      const el = $('<div></div>');\n      this.elParams = el;\n      const loaded = {};\n\n      const userParams = Katrid.Reports.Reports.currentUserReport.params;\n      if (userParams && userParams.data) {\n        for (p of Array.from(userParams.data)) {\n          loaded[p.name] = true;\n          this.addParam(p.name, p.value);\n        }\n      }\n\n      for (p of Array.from(this.params)) {\n        if (p.static && !loaded[p.name]) {\n          $(p.render(el));\n        }\n      }\n      return container.find('#params-params').append(el);\n    }\n\n    renderGrouping(container) {\n      const opts = (Array.from(this.groupables).map((p) => `<option value=\"${p.name}\">${p.label}</option>`)).join('');\n      const el = container.find(\"#params-grouping\");\n      const sel = el.find('select').select2();\n      return sel.append(opts)\n      .select2(\"container\").find(\"ul.select2-choices\").sortable({\n          containment: 'parent',\n          start() { return sel.select2(\"onSortStart\"); },\n          update() { return sel.select2(\"onSortEnd\"); }\n      });\n    }\n\n    renderSorting(container) {\n      const opts = (Array.from(this.sortables).filter((p) => p.sortable).map((p) => `<option value=\"${p.name}\">${p.label}</option>`)).join('');\n      const el = container.find(\"#params-sorting\");\n      const sel = el.find('select').select2();\n      return sel.append(opts)\n      .select2(\"container\").find(\"ul.select2-choices\").sortable({\n          containment: 'parent',\n          start() { return sel.select2(\"onSortStart\"); },\n          update() { return sel.select2(\"onSortEnd\"); }\n      });\n    }\n\n    render(container) {\n      this.container = container;\n      let el = this.renderFields();\n      if (this.sortables.length) {\n        el = this.renderSorting(container);\n      } else {\n        container.find(\"#params-sorting\").hide();\n      }\n\n      if (this.groupables.length) {\n        el = this.renderGrouping(container);\n      } else {\n        container.find(\"#params-grouping\").hide();\n      }\n\n      return el = this.renderParams(container);\n    }\n  }\n\n\n  class Params {\n    static initClass() {\n      this.Operations = {\n        exact: 'exact',\n        in: 'in',\n        contains: 'contains',\n        startswith: 'startswith',\n        endswith: 'endswith',\n        gt: 'gt',\n        lt: 'lt',\n        between: 'between',\n        isnull: 'isnull'\n      };\n\n      this.DefaultOperations = {\n        CharField: this.Operations.exact,\n        IntegerField: this.Operations.exact,\n        DateTimeField: this.Operations.between,\n        DateField: this.Operations.between,\n        FloatField: this.Operations.between,\n        DecimalField: this.Operations.between,\n        ForeignKey: this.Operations.exact,\n        ModelChoices: this.Operations.exact,\n        SelectionField: this.Operations.exact,\n      };\n\n      this.TypeOperations = {\n        CharField: [this.Operations.exact, this.Operations.in, this.Operations.contains, this.Operations.startswith, this.Operations.endswith, this.Operations.isnull],\n        IntegerField: [this.Operations.exact, this.Operations.in, this.Operations.gt, this.Operations.lt, this.Operations.between, this.Operations.isnull],\n        FloatField: [this.Operations.exact, this.Operations.in, this.Operations.gt, this.Operations.lt, this.Operations.between, this.Operations.isnull],\n        DecimalField: [this.Operations.exact, this.Operations.in, this.Operations.gt, this.Operations.lt, this.Operations.between, this.Operations.isnull],\n        DateTimeField: [this.Operations.exact, this.Operations.in, this.Operations.gt, this.Operations.lt, this.Operations.between, this.Operations.isnull],\n        DateField: [this.Operations.exact, this.Operations.in, this.Operations.gt, this.Operations.lt, this.Operations.between, this.Operations.isnull],\n        ForeignKey: [this.Operations.exact, this.Operations.in, this.Operations.isnull],\n        ModelChoices: [this.Operations.exact, this.Operations.in, this.Operations.isnull],\n        SelectionField: [this.Operations.exact, this.Operations.isnull],\n      };\n\n      this.Widgets = {\n        CharField(param) {\n          return `<div><input id=\"rep-param-id-${param.id}\" ng-model=\"param.value1\" type=\"text\" class=\"form-control\"></div>`;\n        },\n\n        IntegerField(param) {\n          let secondField = '';\n          if (param.operation === 'between') {\n            secondField = `<div class=\"col-xs-6\"><input id=\"rep-param-id-${param.id}-2\" ng-model=\"param.value2\" type=\"text\" class=\"form-control\"></div>`;\n          }\n          return `<div class=\"row\"><div class=\"col-sm-6\"><input id=\"rep-param-id-${param.id}\" type=\"number\" ng-model=\"param.value1\" class=\"form-control\"></div>${secondField}</div>`;\n        },\n\n        DecimalField(param) {\n          let secondField = '';\n          if (param.operation === 'between') {\n            secondField = `<div class=\"col-xs-6\"><input id=\"rep-param-id-${param.id}-2\" ng-model=\"param.value2\" type=\"text\" class=\"form-control\"></div>`;\n          }\n          return `<div class=\"col-sm-6\"><input id=\"rep-param-id-${param.id}\" type=\"number\" ng-model=\"param.value1\" class=\"form-control\"></div>${secondField}`;\n        },\n\n        DateTimeField(param) {\n          let secondField = '';\n          if (param.operation === 'between') {\n            secondField = `<div class=\"col-xs-6\"><input id=\"rep-param-id-${param.id}-2\" type=\"text\" date-picker=\"L\" ng-model=\"param.value2\" class=\"form-control\"></div>`;\n          }\n          return `<div class=\"row\"><div class=\"col-xs-6\"><input id=\"rep-param-id-${param.id}\" type=\"text\" date-picker=\"L\" ng-model=\"param.value1\" class=\"form-control\"></div>${secondField}</div>`;\n        },\n\n        DateField(param) {\n          let secondField = '';\n          if (param.operation === 'between') {\n            secondField = `<div class=\"col-xs-6\"><input id=\"rep-param-id-${param.id}-2\" type=\"text\" date-picker=\"L\" ng-model=\"param.value2\" class=\"form-control\"></div>`;\n          }\n          return `<div class=\"col-sm-12 row\"><div class=\"col-xs-6\"><input id=\"rep-param-id-${param.id}\" type=\"text\" date-picker=\"L\" ng-model=\"param.value1\" class=\"form-control\"></div>${secondField}</div>`;\n        },\n\n        ForeignKey(param) {\n          const serviceName = param.info.field.attr('model') || param.params.model;\n          let multiple = '';\n          if (param.operation === 'in') {\n            multiple = 'multiple';\n          }\n          return `<div><input id=\"rep-param-id-${param.id}\" ajax-choices=\"${serviceName}\" field=\"${param.name}\" ng-model=\"param.value1\" ${multiple}></div>`;\n        },\n\n        ModelChoices(param) {\n          return `<div><input id=\"rep-param-id-${param.id}\" ajax-choices=\"ir.action.report\" model-choices=\"${param.info.modelChoices}\" ng-model=\"param.value1\"></div>`;\n        },\n\n        SelectionField(param) {\n          param.info.choices = param.info.field.data('choices');\n          let defaultValue = param.info.field.attr('default');\n          if (defaultValue)\n            defaultValue = ` ng-init=\"param.value1='${defaultValue}'\"`;\n          return `<div${defaultValue}><select class=\"form-control\" ng-model=\"param.value1\"><option value=\"{{ key }}\" ng-repeat=\"(key, value) in fields.${param.name}.choices\">{{ value }}</option></select></div>`\n        }\n      };\n    }\n  }\n  Params.initClass();\n\n\n  class Param {\n    constructor(info, params) {\n      this.info = info;\n      this.params = params;\n      this.name = this.info.name;\n      this.field = this.params.info.fields && this.params.info.fields[this.name];\n      this.label = this.info.label || this.params.info.caption;\n      this.static = this.info.param === 'static';\n      this.type = this.info.type || (this.field && this.field.type) || 'CharField';\n      this.defaultOperation = this.info.operation || Params.DefaultOperations[this.type];\n      this.operation = this.defaultOperation;\n      // @operations = @info.operations or Params.TypeOperations[@type]\n      this.operations = this.getOperations();\n      this.exclude = this.info.exclude;\n      this.id = ++_counter;\n    }\n\n    defaultValue() {\n      return null;\n    }\n\n    setOperation(op, focus) {\n      if (focus == null) { focus = true; }\n      this.createControls(this.scope);\n      const el = this.el.find(`#rep-param-id-${this.id}`);\n      if (focus) {\n        el.focus();\n      }\n    }\n\n    createControls(scope) {\n      const el = this.el.find(\".param-widget\");\n      el.empty();\n      let widget = Params.Widgets[this.type](this);\n      widget = Katrid.Core.$compile(widget)(scope);\n      return el.append(widget);\n    }\n\n    getOperations() { return (Array.from(Params.TypeOperations[this.type]).map((op) => ({ id: op, text: Params.Labels[op] }))); }\n\n    operationTemplate() {\n      const opts = this.getOperations();\n      return `<div class=\"col-sm-4\"><select id=\"param-op-${this.id}\" ng-model=\"param.operation\" ng-init=\"param.operation='${this.defaultOperation}'\" class=\"form-control\" onchange=\"$('#param-${this.id}').data('param').change();$('#rep-param-id-${this.id}')[0].focus()\">\n  ${opts}\n  </select></div>`;\n    }\n\n    template() {\n      let operation = '';\n      if (!this.operation) operation = this.operationTemplate();\n      return `<div id=\"param-${this.id}\" class=\"row form-group\" data-param=\"${this.name}\" ng-controller=\"ParamController\"><label class=\"control-label\">${this.label}</label>${operation}<div id=\"param-widget-${this.id}\"></div></div>`;\n    }\n\n    render(container) {\n      this.el = this.params.scope.compile(this.template())(this.params.scope);\n      this.el.data('param', this);\n      console.log('render param');\n      this.createControls(this.el.scope());\n      return container.append(this.el);\n    }\n  }\n\n\n  Katrid.UI.uiKatrid.controller('ReportController', ['$scope', '$element', '$compile', function($scope, $element, $compile) {\n    const xmlReport = $scope.$parent.action.info.content;\n    const report = new Report($scope.$parent.action, $scope);\n    $scope.report = report;\n    report.loadFromXml(xmlReport);\n    report.render($element);\n    return report.loadParams();\n  }]);\n\n\n  Katrid.UI.uiKatrid.controller('ReportParamController', ['$scope', '$element', function($scope, $element) {\n    $scope.$parent.param.el = $element;\n    $scope.$parent.param.scope = $scope;\n    return $scope.$parent.param.setOperation($scope.$parent.param.operation, false);\n  }]);\n\n\n\n  class ReportEngine {\n    static load(el) {\n      $('row').each((idx, el) => {\n        el.addClass('row');\n      });\n      $('column').each((idx, el) => {\n        el.addClass('col');\n      })\n    }\n  }\n\n\n  Katrid.Reports = {\n    Reports,\n    Report,\n    Param\n  };\n})();\n","(() => {\n\n  class Widget {\n  }\n\n  class Component {\n  }\n\n  Katrid.UI.Widgets = {\n    Widget,\n    Component\n  };\n})();\n","(() => {\n\n  let compileButtons = (container) => {\n    let sendFileCounter = 0;\n    console.log(container);\n    return container.find('button').each((idx, btn) => {\n      btn = $(btn);\n      let type = btn.attr('type');\n\n      if (!btn.attr('type') || (btn.attr('type') === 'object'))\n        btn.attr('type', 'button');\n      if (type === 'object') {\n        let sendFile = btn.attr('send-file');\n        btn.attr('button-object', btn.attr('name'));\n        if (_.isUndefined(sendFile)) {\n          btn.attr('ng-click', `action.formButtonClick(action.selection, '${ btn.attr('name') }', $event.target);$event.stopPropagation();`);\n        } else {\n          let idSendFile = `__send_file_${++sendFileCounter}`;\n          container.append(`<input id=\"${idSendFile}\" type=\"file\" style=\"display: none\" onchange=\"Katrid.Services.Upload.sendFile('${btn.attr('name')}', this)\"/>`);\n          btn.attr('send-file', btn.attr('name'));\n          btn.attr('onclick', `$('#${idSendFile}').trigger('click')`);\n        }\n      } else if (type === 'tag') {\n        btn.attr('button-tag', btn.attr('name'));\n        btn.attr('onclick', `Katrid.Actions.ClientAction.tagButtonClick($(this))`);\n      }\n      if (!btn.attr('class'))\n        btn.addClass('btn btn-outline-secondary');\n    });\n  };\n\n  class ToolbarComponent extends Katrid.UI.Widgets.Component {\n    constructor() {\n      super();\n      this.scope = false;\n      this.restrict = 'E';\n      this.replace = true;\n      this.transclude = true;\n      this.templateUrl = 'view.header.jinja2';\n    }\n  }\n  Katrid.UI.uiKatrid.directive('toolbar', ToolbarComponent);\n\n\n  class ClientView {\n    constructor(action) {\n      this.action = action;\n    }\n\n    get template() {\n      return Katrid.app.getTemplate(this.templateUrl);\n    }\n\n    render() {\n      return $(this.template);\n    }\n  }\n\n\n  class BaseView {\n    constructor(scope) {\n      this.scope = scope;\n    }\n\n    render() {\n      return Katrid.app.getTemplate(this.templateUrl);\n    }\n  }\n\n  class ActionView extends BaseView{\n    constructor(action, scope, view, content) {\n      super(scope);\n      this.action = action;\n      this.view = view;\n      this.templateUrl = 'view.basic';\n      this.toolbar = true;\n      this.content = content;\n    }\n\n    getTemplateContext() {\n      return { content: this.content };\n    }\n\n    render() {\n      return sprintf(Katrid.app.getTemplate(this.templateUrl), this.getTemplateContext());\n    }\n\n    renderTo(el) {\n      Katrid.core.setContent(this.render(), this.scope);\n    }\n  }\n\n  class View extends ActionView {\n    getBreadcrumb() {\n      let html = `<ol class=\"breadcrumb\">`;\n      let i = 0;\n      for (let h of Katrid.app.actionManager) {\n        if (i === 0 && h.viewModes.length > 1)\n          html += `<li class=\"breadcrumb-item\"><a href=\"#\" ng-click=\"action.backTo(0, 0)\">${ h.info.display_name }</a></li>`;\n        i++;\n        if (Katrid.Actions.actionManager.length > i && h.viewType === 'form')\n          html += `<li class=\"breadcrumb-item\"><a href=\"#\" ng-click=\"action.backTo(${i-1}, 'form')\">${ h.scope.record.display_name }</a></li>`;\n      }\n      if (this.constructor.type === 'form')\n        html += `<li class=\"breadcrumb-item\">{{ self.display_name }}</li>`;\n      return html + '</ol>';\n    }\n\n    render() {\n      return sprintf(Katrid.app.$templateCache.get(this.templateUrl), { content: this.content });\n    }\n\n    getViewButtons() {\n      let btns = Object.entries(View.buttons).map((btn) => this.view.viewModes.includes(btn[0]) ? btn[1] : '').join('');\n      if (btns) btns = `<div class=\"btn-group\">${btns}</div>`;\n      return btns;\n    }\n\n  }\n\n\n  class View2 {\n    constructor(action, viewInfo) {\n      this.viewType = null;\n      this.action = action;\n      this.viewInfo = viewInfo;\n      this.templateUrl = null;\n    }\n\n    renderTo(container) {\n      container.html(this.render(container));\n    }\n\n    get fields() {\n      return this.viewInfo.fields;\n    }\n\n    renderField(fieldEl) {\n      let name = fieldEl.attr('name');\n      if (name) {\n        let fld = this.fields[name];\n        if (fld) {\n          let html = fld.render(this.viewType, fieldEl, { view: this }).toString();\n          if (fld.visible)\n            return html;\n          return '';\n        } else\n          console.error(`Field \"${name}\" not found`);\n      }\n    }\n\n  }\n\n  class FormView extends View2 {\n    constructor(action, viewInfo, opts) {\n      super(action, viewInfo);\n      this.dialog = false;\n      this.viewType = 'form';\n      this.templateUrl = 'view.form.jinja2';\n      this.context = {};\n      if (opts) {\n        this.dialog = opts.dialog;\n        if (opts.templateUrl)\n          this.templateUrl = opts.templateUrl;\n        if (opts.context)\n          Object.assign(this.context, opts.context);\n      }\n    }\n\n    render(container) {\n      let form = $(this.viewInfo.content);\n      form.attr('smart-form', 'smart-form');\n\n      form.addClass('row');\n\n      compileButtons(form);\n      let headerEl = form.find('header:first');\n      let header = '';\n      if (headerEl.length) {\n        headerEl.find('field[name=status]:first').attr('status-field', 'status-field');\n        header = headerEl.html();\n        headerEl.remove();\n      }\n\n      for (let child of form.find('field')) {\n        child = $(child);\n        if (child.attr('invisible') !== undefined)\n          continue;\n        if (!child.parents('field').length) {\n          child.attr('form-field', 'form-field');\n          child.replaceWith(this.renderField(child));\n        }\n      }\n\n      let context = {};\n      Object.assign(context, this.context);\n      Object.assign(context, {\n        header, content: form[0].outerHTML,\n      });\n      if (!this.dialog)\n        context['breadcrumb'] = this.breadcrumb;\n      let templ = Katrid.app.getTemplate(this.templateUrl, context);\n      templ = $(templ);\n\n      templ = Katrid.Core.$compile(templ)(this.action.scope);\n      templ.addClass('ng-form');\n      if (this.action) {\n        // get the form element\n        this.action.$form = templ.find('form').first();\n        // get the form controller\n        this.action.form = angular.element(this.action.$form).controller('form');\n      }\n      return templ;\n    }\n  }\n\n  class List extends View2 {\n    constructor(...args) {\n      super(...args);\n      this.viewType = 'list';\n      this.templateUrl = 'view.list.jinja2';\n      this.action.view = this;\n    }\n\n    render(container) {\n      let list = $(this.viewInfo.content);\n      let context = {};\n      Object.assign(context, this.context);\n      compileButtons(list);\n      let headerEl = list.find('header:first');\n      let header = '';\n      if (headerEl.length) {\n        header = headerEl.html();\n        headerEl.remove();\n      }\n\n      let templ = Katrid.app.getTemplate(this.templateUrl, { header, content: list[0].outerHTML });\n      // compile the template with the action scope\n      templ = $(templ);\n      templ.find('list')\n      .attr('ng-row-click', 'action.listRowClick($index, record, $event)')\n      .attr('list-options', '{\"rowSelector\": true}').attr('ng-row-click', 'action.listRowClick($index, record, $event)');\n\n      templ = Katrid.Core.$compile(templ)(this.action.scope);\n      setTimeout(() => this.action.dataSource.open());\n      return templ;\n    }\n  }\n\n\n  class Card extends View2 {\n    constructor(...args) {\n      super(...args);\n      this.viewType = 'card';\n      this.templateUrl = 'view.card.jinja2';\n      this.action.view = this;\n    }\n\n    render(container) {\n      let content = $(this.viewInfo.content);\n      content.children('field').remove();\n      content.find('field').each((idx, el) => $(el).replaceWith(`\\$\\{ ::record.${ $(el).attr('name') } }`));\n\n      let templ = Katrid.app.getTemplate(this.templateUrl, { content: content[0].outerHTML });\n      // compile the template with the action scope\n      templ = $(templ);\n      templ = Katrid.Core.$compile(templ)(this.action.scope);\n      setTimeout(() => this.action.dataSource.open());\n      return templ;\n    }\n  }\n\n\n\n\n  Katrid.UI.uiKatrid\n\n  .directive('listView2', () => ({\n    scope: false,\n    link($scope, $el) {\n      if (!$el.find('header').find('button').length)\n        $el.find('header').remove();\n    },\n    template($el) {\n      console.log('compile template');\n      compileButtons($el);\n      let headerEl = $el.find('header').first();\n      let header = '';\n      if (headerEl.find('button').length)\n        if (headerEl.length) {\n          header = headerEl.html();\n          headerEl.remove();\n        }\n      $el.find('list').attr('list-options', '{\"rowSelector\": true}').attr('ng-row-click', 'action.listRowClick($index, record, $event)');\n      return sprintf(\n        Katrid.app.getTemplate('view.list')\n        .replace('<!-- replace-header -->', header),\n        { content: $el.html() }\n      );\n    },\n  }))\n\n  .directive('card2', () => ({\n    replace: true,\n    template($el) {\n      $el.children('field').remove();\n      $el.find('field').each((idx, el) => $(el).replaceWith(`{{ ::record.${ $(el).attr('name') } }}`));\n      return sprintf(Katrid.app.getTemplate('view.card'), { content: $el.html() });\n    }\n  }))\n  .directive('smartForm', () => ({\n    restrict: 'A',\n    link(scope, el, attrs) {\n      if ('edit' in attrs) {\n        attrs.$observe('edit', (v) => {\n          if (v === 'false')\n            $('.action-view:first').find('.toolbutton-action-edit').hide();\n          else\n            $('.action-view:first').find('.toolbutton-action-edit').show();\n        })\n      }\n    }\n  }));\n\n\n  Katrid.UI.Views = {\n    View,\n    BaseView,\n    ActionView,\n    FormView,\n    ClientView,\n    List,\n    searchModes: ['list', 'card']\n  };\n\n  Katrid.UI.Views['list'] = List;\n  Katrid.UI.Views['form'] = FormView;\n  Katrid.UI.Views['card'] = Card;\n\n})();\n\n","(function () {\n\n  class ViewInfo {\n    constructor(info) {\n      this._info = info;\n      this.fields = info.fields;\n      this.content = info.content;\n      this.toolbar = info.toolbar;\n    }\n  }\n\n  Katrid.UI.ViewInfo = ViewInfo;\n})();\n","(function () {\n\n  class Grid {\n    constructor($compile) {\n      this.restrict = 'E';\n      this.scope = {};\n      this.$compile = $compile;\n    }\n\n    async loadViews(scope, element, views, attrs) {\n\n      let res = await scope.model.loadViews();\n      // detects the relational field\n      let fld = res.views.list.fields[scope.field.field];\n      scope.dataSource.field = scope.field;\n      // hides the relational field\n      if (fld)\n        fld.visible = false;\n\n      let newViews = res.views;\n\n      for (let [k, v] of Object.entries(views))\n        newViews[k].content = v;\n\n      scope.views = newViews;\n      scope.view = newViews.list;\n      let content = $(scope.view.content);\n      if (scope.inline)\n        content.attr('ng-row-click', 'editItem($event, $index)').attr('inline-editor', scope.inline);\n      else\n        content.attr('ng-row-click', 'openItem($event, $index)');\n      content.attr('records', 'records');\n\n      content.attr('list-options', '{\"deleteRow\": true}');\n\n      // render the list component\n      let el = (this.$compile(content)(scope));\n      element.html(el);\n      element.prepend(this.$compile(Katrid.app.getTemplate('view.form.grid.toolbar.jinja2', {attrs}))(scope));\n      element.find('table').addClass('table-bordered grid');\n    }\n\n    async showDialog(scope, attrs, index) {\n\n      if (scope.views.form)\n        await this.renderDialog(scope, attrs);\n\n      if (index != null) {\n        // Show item dialog\n        scope.recordIndex = index;\n        let record = scope.records[index];\n\n        // load the target record from server\n        if (record && record.$loaded)\n          scope.record = record;\n        else if (record) {\n          let res = await scope.dataSource.get(scope.records[index].id, 0, false, index);\n          res.$loaded = true;\n\n          // load nested data\n          // let currentRecord = scope.record;\n          // if (res.id)\n          //   for (let child of dataSource.children) {\n          //     child.scope.masterChanged(res.id)\n          //     .then(res => {\n          //       _cacheChildren(child.fieldName, currentRecord, res.data);\n          //     })\n          //\n          //   }\n\n        }\n\n      }\n\n    };\n\n    async link(scope, element, attrs) {\n      if (attrs.ngDefaultValues)\n        scope.ngDefaultValues = attrs.ngDefaultValues;\n      let me = this;\n      // Load remote field model info\n\n      const field = scope.$parent.view.fields[attrs.name];\n\n      scope.totalDisplayed = 1000;\n      scope.fieldName = attrs.name;\n      scope.field = field;\n      scope.records = [];\n      scope.recordIndex = -1;\n      scope._cachedViews = {};\n      scope._ = scope.$parent._;\n      scope._changeCount = 0;\n      scope.dataSet = [];\n      scope.model = new Katrid.Services.Model(field.model);\n      scope.isList = true;\n\n      if (attrs.inlineEditor === 'tabular')\n        scope.inline = 'tabular';\n      else if (attrs.hasOwnProperty('inlineEditor'))\n        scope.inline = 'inline';\n\n      scope.getContext = function () {\n        return {}\n      };\n\n      scope.$setDirty = function () {\n        return {}\n      };\n\n      // Set parent/master data source\n      let dataSource = scope.dataSource = new Katrid.Data.DataSource(scope);\n      dataSource.readonly = !_.isUndefined(attrs.readonly);\n      let p = scope.$parent;\n      while (p) {\n        if (p.action && p.action.dataSource) {\n          scope.dataSource.masterSource = p.action.dataSource;\n          break;\n        } else if (p.dataSource) {\n          scope.dataSource.masterSource = p.dataSource;\n          break;\n        }\n        p = p.$parent;\n      }\n\n      scope.parent = dataSource.masterSource.scope;\n      scope.action = dataSource.masterSource.action;\n      dataSource.action = scope.action;\n\n      scope.dataSource.fieldName = scope.fieldName;\n      scope.gridDialog = null;\n      let gridEl = null;\n\n      // check if the grid has custom views grid:view\n      let views = {};\n      for (let child of element.children()) {\n        if (child.tagName.startsWith('GRID:')) {\n          let viewType = child.tagName.split(':')[1].toLowerCase();\n          child = $(child);\n          views[viewType] = `<${viewType}>${child.html()}</${viewType}>`;\n        }\n      }\n\n      await me.loadViews(scope, element, views, attrs);\n\n      scope.doViewAction = (viewAction, target, confirmation) => scope.action._doViewAction(scope, viewAction, target, confirmation);\n\n      let _cacheChildren = (fieldName, record, records) => {\n        record[fieldName] = records;\n      };\n\n      scope._incChanges = () => {\n        if (!scope.$parent.$fieldLog[scope.field.name])\n          scope.$parent.$fieldLog[scope.field.name] = {};\n        scope.$parent.$fieldLog[scope.field.name].count++;\n      };\n\n      scope.addItem = async () => {\n        await scope.dataSource.insert();\n        if (attrs.$attr.inlineEditor) {\n          scope.records.splice(0, 0, scope.record);\n          scope.dataSource.edit();\n          if (!scope.$parent.record[scope.fieldName])\n            scope.$parent.record[scope.fieldName] = [];\n          scope.$parent.record[scope.fieldName].push(scope.record);\n          scope.$apply();\n        } else\n          return this.showDialog(scope, attrs);\n      };\n\n      scope.addRecord = function (rec) {\n        let record = Katrid.Data.createRecord({$loaded: true}, scope.dataSource);\n        for (let [k, v] of Object.entries(rec))\n          record[k] = v;\n        scope.records.push(record);\n        if (!scope.dataSource.parent.record[scope.fieldName])\n          scope.dataSource.parent.record[scope.fieldName] = [];\n        scope.dataSource.parent.record[scope.fieldName].push(record);\n        console.log('add record', record);\n      };\n\n      scope.cancelChanges = () => scope.dataSource.setState(Katrid.Data.DataSourceState.browsing);\n\n      scope.openItem = async (evt, index) => {\n        await this.showDialog(scope, attrs, index);\n        if (scope.dataSource.masterSource.changing && !scope.dataSource.readonly) {\n          scope.dataSource.edit();\n        }\n        scope.$apply();\n      };\n\n      scope.editItem = (evt, index) => {\n        if (scope.dataSource.changing)\n          scope.save();\n        if (scope.$parent.dataSource.changing) {\n          scope.dataSource.recordIndex = index;\n          scope.dataSource.edit();\n\n          // delay focus field\n          setTimeout(() => {\n            let el = $(evt.target).closest('td').find('input.form-control').focus();\n            setTimeout(() => el.select());\n          }, 100);\n\n        }\n      };\n\n      scope.removeItem = function (idx) {\n        const rec = scope.records[idx];\n        scope.records.splice(idx, 1);\n        scope._incChanges();\n        rec.$record.$delete();\n        //scope.$parent.record.$modifiedData[scope.fieldName].$deleted.append(rec);\n        // return scope.dataSource.applyModifiedData(null, null, rec);\n      };\n\n      scope.$set = (field, value) => {\n        const control = scope.form[field];\n        control.$setViewValue(value);\n        control.$render();\n      };\n\n      scope.save = function () {\n        // const data = scope.dataSource.applyModifiedData(scope.form, scope.gridDialog, scope.record);\n        scope._incChanges();\n        if (scope.inline)\n          return;\n        // return scope.$parent.record[scope.fieldName] = scope.records;\n        if (scope.recordIndex > -1) {\n          let rec = scope.record;\n          scope.record = null;\n          scope.records.splice(scope.recordIndex, 1);\n          setTimeout(() => {\n            scope.records.splice(scope.recordIndex, 0, rec);\n            scope.$apply();\n          });\n        } else if (scope.recordIndex === -1) {\n          scope.records.push(scope.record);\n          // scope.$parent.record[scope.fieldName] = scope.records;\n        }\n        if (!scope.inline) {\n          scope.gridDialog.modal('toggle');\n        }\n      };\n\n\n      let _loadChildFromCache = (child) => {\n        if (scope.record.hasOwnProperty(child.fieldName)) {\n          child.scope.records = scope.record[child.fieldName];\n        }\n      };\n\n      function trim(str) {\n        str = str.replace(/^\\s+/, '');\n        for (let i = str.length - 1; i >= 0; i--) {\n          if (/\\S/.test(str.charAt(i))) {\n            str = str.substring(0, i + 1);\n            break;\n          }\n        }\n        return str;\n      }\n\n      scope.pasteData = async function () {\n        let cache = {};\n\n        let _queryForeignKeyField = async function (field, val) {\n          return new Promise(async (resolve, reject) => {\n\n            if (!cache[field.name])\n              cache[field.name] = {};\n            if (cache[field.name][val] === undefined) {\n              let res = await scope.model.getFieldChoices(field.name, val, {exact: true});\n              if (res.items && res.items.length)\n                cache[field.name][val] = res.items[0];\n              else\n                cache[field.name][val] = null;\n            }\n            resolve(cache[field.name][val]);\n\n          });\n        };\n\n        let fields = [];\n        for (let f of $(scope.view.content).find('field')) {\n          let field = scope.view.fields[$(f).attr('name')];\n          if (field && (_.isUndefined(field.visible) || field.visible))\n            fields.push(field);\n        }\n        let txt = await navigator.clipboard.readText();\n\n        // read lines\n        let rowNo = 0;\n        for (let row of txt.split(/\\r?\\n/)) {\n          rowNo++;\n          if (row) {\n            let i = 0;\n            let newObj = {};\n            for (let col of row.split(/\\t/)) {\n              let field = fields[i];\n              if (field instanceof Katrid.Data.Fields.ForeignKey)\n                newObj[field.name] = await _queryForeignKeyField(field, trim(col));\n              else\n                newObj[field.name] = trim(col);\n              i++;\n            }\n            scope.addRecord(newObj);\n          }\n        }\n        scope.$apply();\n      };\n\n      let masterChanged = function (evt, master, key) {\n\n        // Ajax load nested data\n        if (master === scope.dataSource.masterSource) {\n          scope.dataSet = [];\n          scope._changeCount = 0;\n          scope.records = [];\n          if (key != null) {\n            const data = {};\n            data[field.field] = key;\n            if (key) {\n              // TODO remove in future\n              scope.dataSource.pageLimit = 1000;\n              return scope.dataSource.search(data)\n              .then((data) => {\n                // setup the log information, it will be useful to watch field value changes\n                scope.$parent.$fieldLog[field.name] = {count: 0, value: data.data};\n                scope.$parent.record[field.name] = data.data;\n                scope.$apply();\n              })\n              .finally(() => scope.dataSource.state = Katrid.Data.DataSourceState.browsing);\n            }\n          } else {\n            scope.$parent.record[field.name] = [];\n          }\n        }\n\n      };\n\n      if (scope.dataSource.pendingMasterId)\n        masterChanged(null, scope.dataSource.parent, scope.dataSource.pendingMasterId);\n\n      let unhook = [\n        scope.$on('masterChanged', masterChanged),\n        scope.$on('afterCancel', function (evt, master) {\n          if (master === scope.dataSource.masterSource)\n            scope.dataSource.cancel();\n        })\n      ];\n\n\n      scope.$on('$destroy', function () {\n        unhook.map(fn => fn());\n      });\n\n\n    }\n\n    async renderDialog(scope, attrs) {\n      let el;\n      let html = scope.views.form.content;\n\n      scope.view = scope.views.form;\n      let fld = scope.views.form.fields[scope.field.field];\n      if (fld)\n        fld.visible = false;\n\n      if (attrs.inline) {\n        el = me.$compile(html)(scope);\n        gridEl.find('.inline-input-dialog').append(el);\n      } else {\n        let view = new Katrid.UI.Views.FormView({scope}, scope.views.form, {\n          dialog: true,\n          templateUrl: 'view.field.OneToManyField.Dialog.jinja2',\n          context: {\n            field: scope.field,\n          },\n        });\n        el = view.render();\n      }\n\n      // Get the first form controller\n      scope.formElement = el.find('form:first');\n      scope.form = scope.formElement.controller('form');\n      scope.gridDialog = el;\n\n      if (!attrs.inline) {\n        el.modal('show');\n        el.on('hidden.bs.modal', function () {\n          scope.record = null;\n          scope.dataSource.state = Katrid.Data.DataSourceState.browsing;\n          el.remove();\n          scope.gridDialog = null;\n          scope.recordIndex = -1;\n          _destroyChildren();\n        });\n      }\n      el.find('.modal-dialog').addClass('ng-form');\n      return new Promise(function (resolve) {\n        el.on('shown.bs.modal', () => resolve(el));\n      });\n    };\n\n  }\n\n  Katrid.UI.uiKatrid\n\n  .directive('grid', ['$compile', Grid])\n\n  .directive('list', ['$compile', $compile => ({\n    restrict: 'E',\n    scope: false,\n    compile(el, attrs) {\n      el.addClass('table-responsive');\n      let rowClick = attrs.ngRowClick;\n      let records = attrs.records || 'groups';\n      let content = el.html();\n      let options = {};\n      if (attrs.listOptions)\n        options = JSON.parse(attrs.listOptions);\n      let template = Katrid.app.getTemplate('view.list.table.jinja2', {attrs, rowClick, options, records});\n\n      return function (scope, el, attrs, controller) {\n        let templ = $(template);\n        let tr = templ.find('tbody>tr:first');\n        let thead = templ.find('thead>tr:first');\n        let tfoot = templ.find('tfoot>tr:first');\n\n        let formView;\n        let ngTrClass = attrs.ngTrClass;\n        if (ngTrClass)\n          ngTrClass = ',' + ngTrClass;\n        else\n          ngTrClass = '';\n        console.log('row class', ngTrClass);\n        if (attrs.inlineEditor) {\n          templ.addClass('inline-editor');\n          formView = $(scope.views.form.content);\n          tr\n          .attr('ng-form', \"grid-row-form-{{$index}}\")\n          .attr('id', 'grid-row-form-{{$index}}');\n        } else\n          tr.attr(\n              'ng-class',\n              \"{\" +\n              \"'group-header': record.$hasChildren, \" +\n              \"'form-data-changing': (dataSource.changing && dataSource.recordIndex === $index), \" +\n              \"'form-data-readonly': !(dataSource.changing && dataSource.recordIndex === $index)\" +\n              ngTrClass +\n              \"}\"\n          );\n\n        // compile fields\n        let fields = $('<div>').append(content);\n        let totals = [];\n        let hasTotal = false;\n        let td, th;\n        for (let fld of fields.children('field')) {\n          fld = $(fld);\n          let fieldName = fld.attr('name');\n          let field = scope.view.fields[fieldName];\n          if (field) {\n\n            field.assign(fld);\n\n            let total = fld.attr('total');\n            if (total) {\n              hasTotal = true;\n              totals.push({\n                field: field,\n                name: fieldName,\n                total: total,\n              });\n            } else\n              totals.push(false);\n\n            if (!field.visible)\n              continue;\n\n            let inplaceEditor = false;\n            if (formView) {\n              inplaceEditor = formView.find(`field[name=\"${fieldName}\"]`);\n              inplaceEditor = $(inplaceEditor[0].outerHTML).attr('form-field', 'form-field').attr('inline-editor', attrs.inlineEditor)[0].outerHTML;\n            }\n            let fieldEl = $(field.render('list', fld, {view: scope.view}));\n            th = fieldEl.first();\n            td = $(th).next();\n          } else {\n            // just use the html content\n            th = '<th></th>';\n            td = `<td>${fld.html()}</td>`;\n          }\n          tr.append(td);\n          thead.append(th);\n        }\n\n        if (hasTotal)\n          for (total of totals)\n            tfoot.append(Katrid.app.getTemplate('view.list.table.total.jinja2', {field: total.field}));\n        else\n          tfoot.remove();\n\n        if (options.deleteRow) {\n          let delRow = $(Katrid.app.getTemplate('view.list.table.delete.jinja2'));\n          for (let child of delRow)\n            if (child.tagName === 'TD')\n              tr.append(child);\n            else if (child.tagName === 'TH')\n              thead.append(child);\n          if (hasTotal)\n            tfoot.append('<td class=\"list-column-delete\" ng-show=\"dataSource.parent.changing && !dataSource.readonly\"></td>');\n        }\n        el.html('');\n        el.append($compile(templ)(scope));\n      }\n    }\n  })]);\n\n\n})();\n","(function () {\n  const uiKatrid = Katrid.UI.uiKatrid;\n\n  uiKatrid.filter('numberFormat', () => {\n    return (value, maxDigits = 3) => {\n      if (value == null)\n        return '';\n      return new Intl.NumberFormat('pt-br', { maximumSignificantDigits: maxDigits }).format(value);\n    }\n  });\n\n})();\n","(function() {\n\n  let conditionsLabels = {\n    '=': Katrid.i18n.gettext('Is equal'),\n    '!=': Katrid.i18n.gettext('Is different'),\n    '>': Katrid.i18n.gettext('Greater-than'),\n    '<': Katrid.i18n.gettext('Less-than'),\n  };\n\n  let conditionSuffix = {\n    '=': '',\n    '!=': '__isnot',\n    'like': '__icontains',\n    'not like': '__not_icontains',\n    '>': '__gt',\n    '>=': '__gte',\n    '<': '__lt',\n    '<=': '__lte',\n    'in': '__in',\n    'not in': '__not_in',\n  };\n\n\n  class SearchQuery {\n    constructor(searchView) {\n      this.searchView = searchView;\n      this.items = [];\n      this.groups = [];\n    }\n\n    add(item) {\n      if (this.items.includes(item)) {\n        item.facet.addValue(item);\n        item.facet.refresh();\n      } else {\n        this.items.push(item);\n        this.searchView.renderFacets();\n      }\n      if (item instanceof SearchGroup)\n        this.groups.push(item);\n      this.searchView.change();\n    }\n\n    loadItem(item) {\n      this.items.push(item);\n      if (item instanceof SearchGroup)\n        this.groups.push(item);\n    }\n\n    remove(item) {\n      this.items.splice(this.items.indexOf(item), 1);\n      if (item instanceof SearchGroup) {\n        this.groups.splice(this.groups.indexOf(item), 1);\n      }\n      this.searchView.change();\n    }\n\n    getParams() {\n      let r = [];\n      for (let i of this.items)\n        r = r.concat(i.getParamValues());\n      return r;\n    }\n  }\n\n\n  class FacetView {\n    constructor(item) {\n      this.item = item;\n      this.values = [];\n    }\n\n    get separator() {\n      return ` <span class=\"facet-values-separator\">${Katrid.i18n.gettext('or')}</span> `;\n    }\n\n    init(item, values) {\n      this.item = item;\n      if (values)\n        this.values = values;\n      else\n        this.values = [{\n          searchString: this.item.getDisplayValue(), value: this.item.value\n        }];\n    }\n\n    addValue(value) {\n      return this.values.push(value);\n    }\n\n    get caption() {\n      return this.item.caption;\n    }\n\n    clear() {\n      this.values = [];\n    }\n\n    get templateValue() {\n      return (Array.from(this.values).map(\n        s => s instanceof SearchObject ? s.display : s)\n      ).join(this.separator);\n    }\n\n    link(searchView) {\n      const html = $(this.template());\n      this.item.facet = this;\n      this.element = html;\n      const rm = html.find('.facet-remove');\n      rm.click(evt => searchView.onRemoveItem(evt, this.item));\n      return html;\n    }\n\n    refresh() {\n      return this.element.find('.facet-value').html(this.templateValue());\n    }\n\n    load(searchView) {\n      searchView.query.loadItem(this.item);\n      this.render(searchView);\n    }\n\n    destroy() {\n      this.clear();\n    }\n\n    getParamValues() {\n      const r = [];\n      for (let v of this.values) {\n        r.push(this.item.getParamValue(v));\n      }\n      if (r.length > 1)\n        return [{'OR': r}];\n      return r;\n    }\n  }\n\n  class FacetGroup extends FacetView {\n    constructor(...args) {\n      super(...args);\n      this.grouping = true;\n    }\n\n    clear() {\n      let oldValues = this.values;\n      super.clear();\n      for (let v of oldValues)\n        if (v._ref)\n          v._ref._selected = false;\n    }\n\n    get separator() {\n      return ` <span> &gt; </span> `;\n    }\n\n    get caption() {\n      return '<span class=\"fa fa-bars\"></span>';\n    }\n  }\n\n\n\n\n  class SearchItem {\n    constructor(view, name, el) {\n      this.view = view;\n      this.name = name;\n      this.el = el;\n    }\n\n    getDisplayValue() {\n      if (this.value) {\n        return this.value[1];\n      }\n      return this.searchString;\n    }\n\n    getParamValue(name, value) {\n      const r = {};\n      if (_.isArray(value)) {\n        r[name] = value[0];\n      } else {\n        r[name + '__icontains'] = value;\n      }\n      return r;\n    }\n\n    _doChange() {\n      this.view.update();\n    }\n  }\n\n  class SearchFilter extends SearchItem {\n    constructor(view, name, caption, domain, group, el) {\n      super(view, name, el);\n      this.group = group;\n      this.caption = caption;\n      if (_.isString(domain))\n        domain = JSON.parse(domain.replace(/'/g, '\"'));\n      this.domain = domain;\n      this._selected = false;\n    }\n\n    static fromItem(view, el, group) {\n      return new SearchFilter(view, el.attr('name'), el.attr('caption') || el.attr('label'), el.attr('domain'), group, el);\n    }\n\n    toString() {\n      return this.caption;\n    }\n\n    toggle() {\n      this.selected = !this.selected;\n    }\n\n    get selected() {\n      return this._selected;\n    }\n\n    set selected(value) {\n      this._selected = value;\n      if (value)\n        this.group.addValue(this);\n      else\n        this.group.removeValue(this);\n      this._doChange();\n    }\n\n    getDisplayValue() {\n      return this.caption;\n    }\n\n    get facet() {\n      return this.group.facet;\n    }\n\n    getParamValue() {\n      return this.domain;\n    }\n\n    get value() {\n      return this.domain;\n    }\n  }\n\n  class SearchFilters extends Array {\n    constructor(view, facet) {\n      super();\n      this.view = view;\n      this._selection = [];\n      if (!facet)\n        facet = new FacetView(this);\n      this._facet = facet;\n    }\n\n    static fromItem(view, el) {\n      let group = new SearchFilters(view);\n      group.push(SearchFilter.fromItem(view, el, group));\n      return group;\n    }\n\n    static fromGroup(view, el) {\n      let group = new SearchFilters(view);\n      for (let child of el.children())\n        group.push(SearchFilter.fromItem(view, $(child), group));\n      console.log(group);\n      return group;\n    }\n\n    addValue(item) {\n      this._selection.push(item);\n      this._facet.values = this._selection.map(item => (new SearchObject(item.toString(), item.value)));\n      this._refresh();\n    }\n\n    removeValue(item) {\n      this._selection.splice(this._selection.indexOf(item), 1);\n      this._facet.values = this._selection.map(item => ({ searchString: item.getDisplayValue(), value: item.value }));\n      this._refresh();\n    }\n\n    selectAll() {\n      for (let item of this)\n        this.addValue(item);\n      this.view.update();\n    }\n\n    get caption() {\n      return '<span class=\"fa fa-filter\"></span>';\n    }\n\n    _refresh() {\n      if (this._selection.length) {\n        if (this.view.facets.indexOf(this._facet) === -1)\n          this.view.facets.push(this._facet);\n      } else if (this.view.facets.indexOf(this._facet) > -1)\n        this.view.facets.splice(this.view.facets.indexOf(this._facet), 1);\n    }\n\n    getParamValue(v) {\n      return v.value;\n    }\n\n    clear() {\n      this._selection = [];\n    }\n\n  }\n\n  class SearchGroups extends SearchFilters {\n    constructor(view, facet) {\n      if (!facet)\n        facet = new FacetGroup();\n      super(view, facet);\n    }\n\n    static fromGroup(opts) {\n      let view = opts.view;\n      let el = opts.el;\n      // get default facet\n      let facet = opts.facet || view.facetGrouping;\n      let group = new SearchGroups(view, facet);\n      if (el)\n        for (let child of el.children())\n          group.push(SearchGroup.fromItem(view, $(child), group));\n      return group;\n    }\n\n    addValue(item) {\n      this.view.groupLength++;\n      let newItem = new SearchObject(item.toString(), item.value);\n      newItem._ref = item;\n      this._facet.values.push(newItem);\n      this._refresh();\n    }\n\n    removeValue(item) {\n      this.view.groupLength--;\n      for (let i of this._facet.values)\n        if (i._ref === item) {\n          this._facet.values.splice(this._facet.values.indexOf(i), 1);\n          break;\n        }\n      this._refresh();\n    }\n\n    _refresh() {\n      if (this._facet.values.length) {\n        if (this.view.facets.indexOf(this._facet) === -1)\n          this.view.facets.push(this._facet);\n      } else if (this.view.facets.indexOf(this._facet) > -1)\n        this.view.facets.splice(this.view.facets.indexOf(this._facet), 1);\n    }\n  }\n\n  class SearchObject {\n    constructor(display, value) {\n      this.display = display;\n      this.value = value;\n    }\n  }\n\n  class SearchResult {\n    constructor(field, value) {\n      this.field = field;\n      this.value = value;\n      this.text = value[1];\n      this.indent = true;\n    }\n\n    select() {\n      this.field.selectItem(this.value);\n    }\n  }\n\n  class SearchField extends SearchItem {\n    constructor(view, name, el, field) {\n      super(view, name, el);\n      this.field = field;\n      this._expanded = false;\n      if (field.type === 'ForeignKey') {\n        this.expandable = true;\n        this.children = [];\n      } else {\n        this.expandable = false;\n      }\n    }\n\n    get expanded() {\n      return this._expanded;\n    }\n\n    set expanded(value) {\n      this._expanded = value;\n      if (value)\n        this._loadChildren();\n      else {\n        this.children = [];\n        if (this.view.$items)\n          for (let i = this.view.$items.length-1; i > 0; i--) {\n            let obj = this.view.$items[i];\n            if (obj.field === this) {\n              this.view.$items.splice(i, 1);\n\n            }\n          }\n      }\n    }\n\n    _loadChildren() {\n      this.loading = true;\n      this.view.scope.model.getFieldChoices(this.name, this.view.text)\n      .then(res => {\n        this.children = res.items;\n        // append returned items onto searchView.$items menu\n        let index = this.view.$items.indexOf(this);\n        if (index > -1) {\n          for (let obj of this.children) {\n            index++;\n            this.view.$items.splice(index, 0, new SearchResult(this, obj))\n          }\n        }\n      })\n      .finally(() => this.view.scope.$apply(() => this.loading = false));\n    }\n\n    get facet() {\n      if (!this._facet)\n        this._facet = new FacetView(this);\n      return this._facet;\n    }\n\n    getDisplayValue() {\n      return this.value;\n    }\n\n    getParamValue(value) {\n      const r = {};\n      let name = this.name;\n      if (_.isArray(value)) {\n        r[name] = value[0];\n      } else if (value instanceof SearchObject) {\n        return value.value;\n      } else {\n        r[name + '__icontains'] = value;\n      }\n      return r;\n    }\n\n    get caption() {\n      return this.field.caption;\n    }\n\n    get value() {\n      if (this._value)\n        return this._value[1];\n      return this.view.text;\n    }\n\n    select() {\n      this.facet.addValue(this.value);\n      this.view.addFacet(this.facet);\n      this.view.close();\n      this.view.update();\n    }\n\n    selectItem(item) {\n      let domain = {};\n      domain[this.field.name] = item[0];\n      this.facet.addValue(new SearchObject(item[1], domain));\n      this.view.addFacet(this.facet);\n      this.view.close();\n      this.view.update();\n    }\n\n    static fromField(view, el) {\n      let field = view.view.fields[el.attr('name')];\n      return new SearchField(view, field.name, el, field);\n    }\n\n    get template() {\n      return _.sprintf(Katrid.i18n.gettext(`Search <i>%(caption)s</i> by: <strong>%(text)s</strong>`), {\n        caption: this.field.caption,\n        text: this.view.text,\n      });\n    }\n  }\n\n  class SearchGroup extends SearchFilter {\n    constructor(view, name, caption, group, el) {\n      super(view, name, el);\n      this.group = group;\n      this.caption = caption;\n      this._selected = false;\n    }\n\n    static fromItem(view, el, group) {\n      return new SearchGroup(view, el.attr('name'), el.attr('caption'), group, el);\n    }\n\n    toString() {\n      return this.caption;\n    }\n  }\n\n  class CustomFilterItem extends SearchFilter {\n    constructor(view, field, condition, value, group) {\n      super(view, field.name, field.caption, null, group);\n      this.field = field;\n      this.condition = condition;\n      this._value = value;\n      this._selected = true;\n    }\n\n    toString() {\n      let s = this.field.format(this._value);\n      return this.field.caption + ' ' + conditionsLabels[this.condition].toLowerCase() + ' \"' + s + '\"';\n    }\n\n    get value() {\n      let r = {};\n      r[this.field.name + conditionSuffix[this.condition]] = this._value;\n      return r;\n    }\n\n  }\n\n  Katrid.UI.uiKatrid.controller('CustomFilterController', ['$scope', '$element', '$filter', function ($scope, $element, $filter) {\n    $scope.tempFilter = null;\n    $scope.customFilter = [];\n\n    $scope.fieldChange = function (field) {\n      $scope.field = field;\n      $scope.condition = field.defaultCondition;\n      $scope.conditionChange($scope.condition);\n    };\n\n    $scope.conditionChange = (condition) => {\n      $scope.controlVisible = $scope.field.isControlVisible(condition);\n    };\n\n    $scope.valueChange = (value) => {\n      $scope.searchValue = value;\n    };\n\n    $scope.addCondition = (field, condition, value) => {\n      if (!$scope.tempFilter)\n        $scope.tempFilter = new SearchFilters($scope.$parent.search);\n      $scope.tempFilter.push(new CustomFilterItem($scope.$parent.search, field, condition, value, $scope.tempFilter));\n      $scope.field = null;\n      $scope.condition = null;\n      $scope.controlVisible = false;\n      $scope.searchValue = undefined;\n    };\n\n    $scope.applyFilter = () => {\n      if ($scope.searchValue)\n        $scope.addCondition($scope.field, $scope.condition, $scope.searchValue);\n      $scope.customFilter.push($scope.tempFilter);\n      $scope.tempFilter.selectAll();\n      $scope.tempFilter = null;\n      $scope.customSearchExpanded = false;\n    };\n  }])\n\n  .directive('customFilter', () => (\n    {\n      restrict: 'A',\n      scope: {\n        action: '=',\n      },\n    }\n  ));\n\n  class SearchView {\n    constructor(scope, element, view) {\n      this.scope = scope;\n      this.element = element;\n      this.query = new SearchQuery(this);\n      this._viewMoreButtons = localStorage.getItem('katrid.search.viewMoreButtons') === 'true';\n      this.items = [];\n      this.fields = [];\n      this.filterGroups = [];\n      this.groups = [];\n      this._groupLength = this.groupLength = 0;\n      this.facets = [];\n      this.input = element.find('.search-view-input');\n      this.view = view;\n      // available dropdown items\n      this.$items = null;\n\n      // groups must have a unique facet\n      this.facetGrouping = new FacetGroup();\n\n      if (view) {\n        this.el = $(view.content);\n        this.menu = element.find('.search-dropdown-menu.search-view-menu');\n        // let menu = this.createMenu(scope, element.find('.search-dropdown-menu.search-view-menu'), element);\n\n        for (let child of this.el.children()) {\n          child = $(child);\n          let tag = child.prop('tagName');\n          let obj;\n          if (tag === 'FILTER') {\n            obj = SearchFilters.fromItem(this, child);\n            this.filterGroups.push(obj);\n          }\n          else if (tag === 'FILTER-GROUP') {\n            obj = SearchFilters.fromGroup(this, child);\n            this.filterGroups.push(obj);\n            continue;\n          }\n          else if (tag === 'GROUP') {\n            obj = SearchGroup.fromItem({ view: this, el: child });\n            this.groups.push(obj);\n            continue;\n          }\n          else if (tag === 'FIELD') {\n            obj = SearchField.fromField(this, child);\n            this.fields.push(obj);\n            continue;\n          }\n          console.log('obj', obj);\n          if (obj)\n            this.append(obj);\n        }\n\n        this.input\n        .on('input', evt => {\n          if (this.input.val().length) {\n            return this.show(evt);\n          } else {\n            return this.close(evt);\n          }\n        })\n        .on('keydown', evt => {\n          switch (evt.which) {\n            case Katrid.UI.keyCode.DOWN:\n              this.move(1);\n              evt.preventDefault();\n              break;\n            case Katrid.UI.keyCode.UP:\n              this.move(-1);\n              evt.preventDefault();\n              break;\n            case Katrid.UI.keyCode.ENTER:\n              this.scope.$apply(() => angular.element(this.menu.find('li.active a.search-menu-item')).scope().item.select(evt));\n              break;\n            case Katrid.UI.keyCode.BACKSPACE:\n              if (this.input.val() === '') {\n                this.scope.$apply(() => this.facets.splice(this.facets.length-1, 1).map(facet => facet.clear()));\n                this.update();\n                // const item = this.query.items[this.searchView.query.items.length-1];\n              }\n              break;\n          }\n        })\n        .on('blur', evt => {\n          this.input.val('');\n          return this.close();\n        });\n      }\n    }\n\n    addCustomGroup(field) {\n      if (!this.customGroups) {\n        this.customGroups = new SearchGroups(this, this.facetGrouping);\n        this.groups.push(this.customGroups);\n      }\n      let obj = new SearchGroup(this, field.name, field.caption, this.customGroups);\n      this.customGroups.push(obj);\n      obj.selected = true;\n    }\n\n    set viewMoreButtons(value) {\n      if (this._viewMoreButtons !== value) {\n        this._viewMoreButtons = value;\n        localStorage.setItem('katrid.search.viewMoreButtons', value);\n      }\n    }\n\n    get viewMoreButtons() {\n      return this._viewMoreButtons;\n    }\n\n    load(filter) {\n      Object.entries(filter).map((item, idx) => {\n        let i = this.getByName(item[0]);\n        if (i)\n          i.selected = true;\n      })\n    }\n\n    getByName(name) {\n      // try to find inside a group of filters\n      for (let item of this.filterGroups)\n        for (let subitem of item)\n          if (subitem.name === name)\n            return subitem;\n\n      for (let item of this.items)\n        if (item.name === name)\n          return item;\n    }\n\n    append(item) {\n      this.items.push(item);\n    }\n\n    addFacet(facet) {\n      if (!this.facets.includes(facet))\n        this.facets.push(facet);\n    }\n\n    first() {\n      this.menu.find('li.active a.search-menu-item').removeClass('active');\n      this.menu.find('li:first').addClass('active');\n    }\n\n    remove(index) {\n      let facet = this.facets[index];\n      facet.destroy();\n      this.facets.splice(index, 1);\n      this.update();\n    }\n\n    getParams() {\n      let r = [];\n      for (let i of this.facets)\n        if (!i.grouping)\n          r = r.concat(i.getParamValues());\n      return r;\n    }\n\n    dump() {\n      let res = [];\n      for (let i of this.facets)\n        res.push(i);\n      return res;\n    }\n\n    move(distance) {\n      const fw = distance > 0;\n      distance = Math.abs(distance);\n      while (distance !== 0) {\n        distance--;\n        let el = this.element.find('.search-view-menu li.active');\n        if (el.length) {\n          el.removeClass('active');\n          if (fw) {\n            el = el.next();\n          } else {\n            el = el.prev();\n          }\n          el.addClass('active');\n        } else {\n          if (fw) {\n            el = this.element.find('.search-view-menu > li:first');\n          } else {\n            el = this.element.find('.search-view-menu > li:last');\n          }\n          el.addClass('active');\n        }\n      }\n    }\n\n    update() {\n      if (this.groupLength !== this._groupLength) {\n        this._groupLength = this.groupLength;\n        this.scope.action.applyGroups(this.groupBy(), this.getParams());\n      }\n      else\n        // apply changes to window action\n        this.scope.action.setSearchParams(this.getParams());\n    }\n\n    groupBy() {\n      return this.facetGrouping.values.map(obj => obj._ref.name);\n    }\n\n    show() {\n      let shouldApply = false;\n      if (!this.$items) {\n        this.$items = [].concat(this.fields);\n        shouldApply = true;\n      }\n      // close expanded items\n      for (let obj of this.$items)\n        if (obj.expanded) {\n          obj.expanded = false;\n          shouldApply = true;\n        }\n      if (shouldApply)\n        this.scope.$apply();\n      this.menu.show();\n      this.first();\n    }\n\n    close() {\n      this.$items = null;\n      this.menu.hide();\n      this.reset();\n      this.input.val('');\n    }\n\n    reset() {\n      for (let i of this.fields)\n        if (i && i.children && i.children.length)\n          i.expanded = false;\n    }\n  }\n\n  class SearchViewComponent {\n    constructor() {\n      this.retrict = 'E';\n      this.templateUrl = 'view.search.jinja2';\n      this.replace = true;\n      this.scope = false;\n    }\n  }\n\n  class SearchViewArea {\n    constructor() {\n      this.restrict = 'A';\n      this.scope = false;\n    }\n\n    link(scope, el, attrs) {\n      let view = scope.action.views.search;\n      scope.action.searchView = new SearchView(scope, el, view);\n      if (scope.action.context.default_search) {\n        scope.action.searchView.load(scope.action.context.default_search);\n      }\n    }\n  }\n\n  Katrid.UI.uiKatrid.controller('SearchMenuController', ['$scope', function($scope) {\n\n  }]);\n\n  Katrid.UI.uiKatrid.directive('searchView', SearchViewComponent);\n  Katrid.UI.uiKatrid.directive('searchViewArea', SearchViewArea);\n\n  Katrid.UI.Views.SearchView = SearchView;\n  Katrid.UI.Views.SearchViewComponent = SearchViewComponent;\n\n})();\n","(function () {\n\n  let uiKatrid = Katrid.UI.uiKatrid;\n\n  let formCount = 0;\n\n  uiKatrid.directive('formField2', ['$compile', function ($compile) {\n    return {\n      restrict: 'A',\n      priority: 99,\n      replace: true,\n      // priority: -1,\n      compile(el, attrs) {\n        return function(scope, element, attrs, ctrl) {\n          let field = scope.view.fields[attrs.name];\n          if (_.isUndefined(field))\n            throw Error('Invalid field name \"' + attrs.name + '\"');\n          let templ = field.template.form;\n          field.assign(element);\n          if (!field.visible) {\n            el.remove();\n            return;\n          }\n          let fieldAttributes = field.getAttributes(attrs);\n          let sectionAttrs = {};\n\n          // conditional readonly\n          if (fieldAttributes['ng-readonly'])\n            sectionAttrs['ng-readonly'] = fieldAttributes['ng-readonly'].toString();\n\n          // conditional display\n          if (attrs.ngShow)\n            sectionAttrs['ng-show'] = attrs.ngShow;\n\n          // field help text\n          if (field.helpText) {\n            sectionAttrs['title'] = field.helpText;\n          }\n\n          let content = element.html();\n          templ = Katrid.app.getTemplate(templ, {\n            name: attrs.name, field, attrs: fieldAttributes, content, fieldAttributes: attrs, sectionAttrs,\n          });\n          templ = $compile(templ)(scope);\n          element.replaceWith(templ);\n\n          // Add input field for tracking on FormController\n          let fcontrol = templ.find('.form-field');\n          if (fcontrol.length) {\n            fcontrol = fcontrol[fcontrol.length - 1];\n            const form = templ.controller('form');\n            ctrl = angular.element(fcontrol).data().$ngModelController;\n            if (ctrl)\n              form.$addControl(ctrl);\n          }\n        }\n      },\n    };\n  }]);\n\n  uiKatrid.directive('inputField', () => ({\n    restrict: 'A',\n    scope: false,\n    link(scope, element, attrs) {\n      $(element).on('click', function() {\n        // input field select all text on click\n        $(this).select();\n      });\n    }\n  }));\n\n\n  uiKatrid.directive('view', () =>\n    ({\n      restrict: 'E',\n      template(element, attrs) {\n        formCount++;\n        return '';\n      },\n      link(scope, element, attrs) {\n        if (scope.model) {\n          element.attr('class', `view-form-${scope.model.name.replace(new RegExp('\\.', 'g'), '-')}`);\n          element.attr('id', `katrid-form-${formCount.toString()}`);\n          element.attr('model', scope.model);\n          return element.attr('name', `dataForm${formCount.toString()}`);\n        }\n      }\n    })\n  );\n\n  // uiKatrid.directive('list', ($compile, $http) =>\n  //   ({\n  //     restrict: 'E',\n  //     priority: 700,\n  //     link(scope, element, attrs) {\n  // console.log('render list');\n  //       let html = Katrid.UI.Utils.Templates.renderList(scope, element, attrs);\n  //       html = $compile(html)(scope);\n  //       return element.replaceWith(html);\n  //     }\n  //   })\n  // );\n\n  uiKatrid.directive('ngSum', () =>\n    ({\n      restrict: 'A',\n      priority: 9999,\n      require: 'ngModel',\n      link(scope, element, attrs, controller) {\n        const nm = attrs.ngSum.split('.');\n        const field = nm[0];\n        const subField = nm[1];\n        return scope.$watch(`record.$${field}`, function (newValue, oldValue) {\n          if (newValue && scope.record) {\n            let v = 0;\n            scope.record[field].map(obj => v += parseFloat(obj[subField]));\n            if (v.toString() !== controller.$modelValue) {\n              controller.$setViewValue(v);\n              controller.$render();\n            }\n          }\n        });\n      }\n    })\n  );\n\n\n  uiKatrid.directive('ngEnter', () =>\n    (scope, element, attrs) =>\n      element.bind(\"keydown keypress\", (event) => {\n        if (event.which === 13) {\n          scope.$apply(() => scope.$eval(attrs.ngEnter, {$event: event}));\n          event.preventDefault();\n        }\n      })\n  );\n\n  uiKatrid.directive('ngEsc', () =>\n    (scope, element, attrs) =>\n      element.bind(\"keydown keypress\", (event) => {\n        if (event.which === 27) {\n          scope.$apply(() => scope.$eval(attrs.ngEsc, {$event: event}));\n          event.preventDefault();\n        }\n      })\n  );\n\n\n\n  if ($.fn.modal)\n    $.fn.modal.Constructor.prototype._enforceFocus = function() {};\n\n  uiKatrid.directive('ajaxChoices', ['$location', $location =>\n    ({\n      restrict: 'A',\n      require: '?ngModel',\n      link(scope, element, attrs, controller) {\n        const {multiple} = attrs;\n        const serviceName = attrs.ajaxChoices;\n        let field = attrs.field;\n        let _timeout = null;\n        let domain;\n\n        const cfg = {\n          allowClear: true,\n          query(query) {\n\n            // make params\n            let data = {\n              args: [query.term],\n              kwargs: {\n                count: 1,\n                page: query.page,\n                name_fields: attrs.nameFields && attrs.nameFields.split(\",\") || null\n              }\n            };\n\n            if (domain)\n              data.domain = domain;\n\n            const f = () => {\n              let svc = new Katrid.Services.Model(serviceName);\n              if (field) svc = svc.getFieldChoices(field, query.term, data.kwargs);\n              else svc = new Katrid.Services.Model(attrs.modelChoices).searchName(data);\n              svc.then(res => {\n                let data = res.items;\n                const r = data.map(item => ({\n                  id: item[0],\n                  text: item[1]\n                }));\n                const more = query.page * Katrid.settings.services.choicesPageLimit < res.count;\n                return query.callback({\n                  results: r,\n                  more: more\n                })\n              });\n            };\n            if (_timeout) clearTimeout(_timeout);\n            _timeout = setTimeout(f, 400)\n\n          },\n          escapeMarkup(m) {\n            return m;\n          },\n          initSelection(element, callback) {\n            const v = controller.$modelValue;\n            if (v) {\n              if (multiple) {\n                const values = [];\n                for (let i of Array.from(v)) {\n                  values.push({id: i[0], text: i[1]});\n                }\n                return callback(values);\n              } else {\n                return callback({id: v[0], text: v[1]});\n              }\n            }\n          }\n        };\n        if (multiple)\n          cfg['multiple'] = true;\n\n        const el = element.select2(cfg);\n        let sel = el;\n        element.on('$destroy', function () {\n          $('.select2-hidden-accessible').remove();\n          $('.select2-drop').remove();\n          return $('.select2-drop-mask').remove();\n        });\n        el.on('change', function (e) {\n          const v = el.select2('data');\n          controller.$setDirty();\n          if (v)\n            controller.$viewValue = v;\n\n          return scope.$apply();\n        });\n\n        controller.$render = () => {\n          if (controller.$viewValue)\n            return element.select2('val', controller.$viewValue);\n        };\n      }\n    })]\n  );\n\n  uiKatrid.directive('inputMask', () =>\n    ({\n      restrict: 'A',\n      link(scope, el, attrs) {\n        el.inputmask();\n      }\n    })\n  );\n\n\n  class Decimal {\n    constructor($filter) {\n      this.restrict = 'A';\n      this.require = 'ngModel';\n      this.$filter = $filter;\n    }\n\n    link(scope, element, attrs, controller) {\n      let decimal = attrs.inputDecimal;\n      let opts = {\n        alias: 'numeric',\n        groupSeparator: '.',\n        unmaskAsNumber: true,\n        radixPoint: ',',\n        autoGroup: true,\n        digitsOptional: false,\n        placeholder: '0',\n      };\n      if (decimal)\n        opts.digits = parseInt(decimal);\n      element.inputmask(opts);\n\n      controller.$parsers.push(value => {\n        let v = element.inputmask('unmaskedvalue');\n        return v;\n      });\n\n      controller.$formatters.push((v) => {\n        if (_.isNumber(v))\n          v = v.toFixed(opts.digits).replace('.', ',');\n        else if (_.isString(v))\n          v = v.replace('.', ',');\n        return v;\n      });\n    }\n\n  }\n\n  uiKatrid.directive('inputDecimal', ['$filter', Decimal]);\n\n\n\n  uiKatrid.filter('moment', () =>\n    function (input, format) {\n      if (format) {\n        return moment().format(format);\n      }\n      return moment(input).fromNow();\n    }\n  );\n\n\n  uiKatrid.directive('fileReader', () =>\n    ({\n      restrict: 'A',\n      require: 'ngModel',\n      scope: {},\n      link(scope, element, attrs, controller) {\n\n        if (attrs.accept === 'image/*') {\n          element.tag === 'INPUT';\n        }\n\n        return element.bind('change', function () {\n          const reader = new FileReader();\n          reader.onload = event => controller.$setViewValue(event.target.result);\n          return reader.readAsDataURL(event.target.files[0]);\n        });\n      }\n    })\n  );\n\n\n  uiKatrid.directive('dateInput', ['$filter', ($filter) => ({\n    restrict: 'A',\n    require: '?ngModel',\n    link(scope, element, attrs, controller) {\n\n      let setNow = () => {\n        let value;\n        if (attrs.type === 'date')\n           value = (new Date()).toISOString().split('T')[0];\n        else\n          value = moment(new Date()).format('YYYY-MM-DD HH:mm').replace(' ', 'T');  // remove timezone info\n        $(element).val(value);\n        controller.$setViewValue(value);\n        _focus = false;\n      };\n\n      let _focus = true;\n\n      element\n      .focus(function() {\n        if (($(this).val() === ''))\n          _focus = true;\n      })\n      .keypress(function(evt) {\n        if (evt.key.toLowerCase() === 'h') {\n          setNow();\n          evt.stopPropagation();\n          evt.preventDefault();\n        }\n      })\n      .keydown(function(evt) {\n        if (/\\d/.test(evt.key)) {\n          if (($(this).val() === '') && (_focus))\n            setNow();\n        }\n      });\n\n      controller.$formatters.push(function(value) {\n        if (value) {\n          return new Date(value);\n        }\n      });\n\n      controller.$parsers.push(function (value) {\n        if (_.isDate(value)) {\n          let v = moment.utc(value).format('YYYY-MM-DD');\n          if (controller.$modelValue)\n            v += 'T' + controller.$modelValue.split('T', 1)[1];\n          let r = moment.utc(v).format('YYYY-MM-DDTHH:mm:ss');\n          console.log('ret', value, v, r);\n          return r;\n        }\n      });\n\n    }\n  })]);\n\n  uiKatrid.directive('timeInput', () => ({\n    restrict: 'A',\n    require: '?ngModel',\n    link(scope, el, attrs, controller) {\n      el.inputmask({ regex: '([0-1]?[0-9]|2[0-4]):([0-5][0-9])', insertMode: false });\n      // select all chars when focus\n      el.on('focus', function() {\n        setTimeout(() => $(this).select());\n      });\n\n      controller.$parsers.push(function (value) {\n        let v = controller.$modelValue.split('T', 1)[0] + 'T' + value;\n        console.log('time parser', v, value, controller.$viewValue);\n        let r = moment.utc(v).format('YYYY-MM-DDTHH:mm:ss');\n        if (r === 'Invalid date')\n          r = controller.$modelValue;\n        return r;\n      });\n\n      controller.$render = function() {\n        let v = controller.$modelValue;\n        console.log('render', v);\n        if (v)\n          return el.val(moment.utc(v).format('HH:mm'));\n      }\n\n    }\n  }));\n\n\n  uiKatrid.directive('cardDraggable', () => {\n    return {\n      restrict: 'A',\n      link(scope, element, attrs, controller) {\n        let cfg = {\n          connectWith: attrs.cardDraggable,\n          items: '> .sortable-item'\n        };\n        // Draggable write expression\n        if (!_.isUndefined(attrs.cardItem))\n          cfg['receive'] = (event, ui) => {\n            let parent = angular.element(ui.item.parent()).scope();\n            let scope = angular.element(ui.item).scope();\n            console.log(scope);\n            console.log(parent);\n            let data = {};\n            data['id'] = scope.record.id;\n            $.extend(data, parent.group._domain);\n            parent.model.write([data])\n            .then(res => {\n              console.log('write ok', res);\n            });\n          };\n        // Group reorder\n        if (!_.isUndefined(attrs.cardGroup))\n          cfg['update'] = (event, ui) => {\n            let ids = [];\n            $.each(ui.item.parent().find('.card-group'), (idx, el) => {\n              ids.push($(el).data('id'));\n            });\n            let groupName = element.find('.card-group').first().data('group-name');\n            let modelName = scope.$parent.$parent.view.fields[groupName].model;\n            Katrid.Services.data.reorder(modelName, ids)\n            .done(res => {\n              console.log(res);\n            });\n          };\n        element.sortable(cfg).disableSelection();\n      }\n    };\n  });\n\n  uiKatrid.directive('uiTooltip', () => ({\n    restrict: 'A',\n    link: (scope, el, attrs) => {\n      $(el).tooltip({\n        container: 'body',\n        delay: {\n          show: 200,\n          hide: 500\n        }\n      });\n    }\n  }));\n\n  uiKatrid.setFocus = (el) => {\n    let e = $(el);\n    // check if element object has select2 data\n    if (e.data('select2')) e.select2('focus');\n    else el.focus();\n  };\n\n  uiKatrid.directive('attachmentsButton', () => ({\n    restrict: 'A',\n    scope: false,\n    link: (scope, el) => {\n      let _pendingOperation;\n      scope.$parent.$watch('recordId', (key) => {\n        let attachment = new Katrid.Services.Model('ir.attachment', scope);\n        // scope.$parent.attachments = [];\n        clearTimeout(_pendingOperation);\n        _pendingOperation = setTimeout(() => {\n          attachment.search({ params: { model: scope.action.model.name, object_id: key }, count: false })\n          .then(res => {\n            let r = null;\n            if (res && res.data)\n              r = res.data;\n            scope.$apply(() => scope.attachments = r );\n          });\n        }, 1000);\n\n      });\n    }\n  }));\n\n  uiKatrid.directive('action', ['$compile', ($compile) => ({\n    restrict: 'E',\n    priority: 99,\n    link: (scope, el, attrs) => {\n      console.log('define action', attrs.ngClick);\n      let div = el.closest('div.data-form');\n      let actions = div.find('.dropdown-menu-actions');\n      let name = attrs.name;\n      let label = el.html();\n      let html = `<li><a href=\"javascript:void(0)\">${label}</a></li>`;\n      let newItem = $(html);\n      newItem.click(() => {\n        if (attrs.object) scope.model.rpc(attrs.object, [scope.$parent.record.id]);\n        //scope.$eval(attrs.ngClick);\n      });\n      actions.append(newItem);\n      el.remove();\n    }\n  })]);\n\n  class CardView {\n    constructor() {\n      this.restrict = 'E';\n      this.scope = false;\n    }\n\n    controller($scope, element, attrs) {\n      console.log('controller started');\n      $scope.dataSource.autoLoadGrouping = true;\n\n      $scope.cardShowAddGroupDlg = (event) => {\n        $scope.cardAddGroupDlg = true;\n        setTimeout(() => $(event.target).closest('.card-add-group').find('input').focus(), 10);\n      };\n\n      $scope.cardAddGroup = (event, name) => {\n        let gname = $(event.target).closest('.card-add-group').data('group-name');\n        let field = $scope.action.view.fields[gname];\n        let svc = new Katrid.Services.Model(field.model);\n        console.log('the name is', name);\n        svc.createName(name)\n        .done((res) => {\n          console.log(res);\n        });\n      };\n\n      $scope.cardAddItem = (event, name) => {\n        if (name) {\n          let ctx = {};\n          let g = $(event.target).closest('.card-group');\n          ctx['default_' + g.data('group-name')] = g.data('sequence-id');\n          scope.model.createName(name, ctx)\n          .done((res) => {\n            if (res.ok) {\n              let id = res.result[0];\n              scope.model.getById(id)\n              .done((res) => {\n                if (res.ok) {\n                  let s = angular.element(event.target).scope();\n                  let g = s.group;\n                  s.$apply(() => {\n                    g.records.push(res.result.data[0]);\n                  });\n                }\n              })\n            }\n          });\n        }\n        $scope.kanbanHideAddGroupItemDlg(event);\n      };\n\n    }\n  }\n\n})();\n","(function () {\n\n  let WIDGET_COUNT = 0;\n\n  let DEFAULT_COLS = {\n    'BooleanField': 3,\n    'DecimalField': 3,\n    'FloatField': 3,\n    'DateField': 3,\n    'DateTimeField': 3,\n    'IntegerField': 3,\n    'SmallIntegerField': 3,\n    'TimeField': 3,\n    'CharField': 3,\n    'OneToManyField': 12\n  };\n\n  class Field {\n    static get tag() {\n      return 'input';\n    }\n\n    constructor(scope, attrs, field, element) {\n      this.attrs = attrs;\n      this.scope = scope;\n      this.templAttrs = {};\n      this.wAttrs = {};\n      this.field = field;\n      this.element = element;\n      this.content = element.html();\n      // this.inline = scope.inline;\n      this.spanPrefix = '';\n\n      // Check if field depends from another\n      if ((field.depends != null) && field.depends.length)\n        scope.dataSource.addFieldWatcher(field);\n\n      if (attrs.ngShow)\n        this.templAttrs['ng-show'] = attrs.ngShow;\n\n      if (attrs.ngReadonly || field.readonly)\n        this.templAttrs['ng-readonly'] = attrs.ngReadonly || field.readonly;\n\n      if (field.attrs)\n        for (let k of field.attrs) {\n          let v = field.attrs[k];\n          if (k.startsWith('container') || ((k === 'ng-show') && !attrs.ngShow)) {\n            this.templAttrs[k] = v;\n          }\n        }\n\n      if (attrs.ngFieldChange) {\n        this.wAttrs['ng-change'] = attrs.ngFieldChange;\n      }\n\n      let cols = attrs.cols;\n\n      if (!cols) {\n        if (field.type === 'CharField')\n          if (field.max_length && (field.max_length < 30)) cols = 3;\n        if (!cols)\n          cols = DEFAULT_COLS[field.type] || 6;\n      }\n\n      this.col = cols;\n      this.classes = ['form-field'];\n\n      // track field changes\n      if (field.onchange)\n        scope.$watch();\n    }\n\n    fieldChangeEvent() {\n\n    }\n\n    get caption() {\n      return this.element.attr('label') || this.field.caption;\n    }\n\n    renderTo(templTag, inplaceEditor=false, cls='') {\n      let templAttrs = [];\n      for (let [k, v] of Object.entries(this.templAttrs))\n        templAttrs.push(k + '=' + '\"' + v + '\"');\n\n      if (inplaceEditor)\n        return `<${templTag} class=\"${cls}\" ${templAttrs.join('')}>${this.template(this.scope, this.element, this.attrs, this.field)}</${templTag}>`;\n\n      return `<${templTag} class=\"${this.field.type} section-field-${this.field.name} form-group\" ${templAttrs.join('')}>` +\n            this.template(this.scope, this.element, this.attrs, this.field) +\n            `</${templTag}>`\n    }\n\n    get ngModel() {\n      return `record.${this.field.name}`;\n    }\n\n    get id() {\n      if (!this._id)\n        this._id = ++WIDGET_COUNT;\n      return `katrid-input-${this._id.toString()}`;\n    }\n\n    widgetAttrs() {\n      let v;\n      const r = this.wAttrs;\n      if (this.field.required) {\n        r['required'] = null;\n      }\n\n      r['ng-model'] = this.ngModel;\n      if (this.field.attrs) {\n        for (let attr of Object.keys(this.field.attrs)) {\n          v = this.field.attrs[attr];\n          if (!attr.startsWith('container-') && (attr !== 'ng-show') && (attr !== 'ng-readonly')) {\n            r[attr] = v;\n          }\n        }\n      }\n\n      if (!_.isUndefined(this.attrs.$attr))\n      for (let attr of Object.keys(this.attrs.$attr)) {\n        let attrName = this.attrs.$attr[attr];\n        if (!attrName.startsWith('container-') && (attr !== 'ngShow') && (attr !== 'ngReadonly')) {\n          v = this.attrs[attr];\n          if (attrName.startsWith('field-')) {\n            attrName = attrName.substr(6, attrName.length - 6);\n          } else if (attrName === 'class')\n            this.classes.push(v);\n          r[attrName] = v;\n        }\n      }\n\n      if ((this.attrs.readonly != null) || this.field.readonly)\n        r['readonly'] = '';\n\n      if (this.classes)\n        r['class'] = this.classes.join(' ');\n\n      return r;\n    }\n\n    _getWidgetAttrs(scope, el, attrs, field) {\n      let html = '';\n      const attributes = this.widgetAttrs(scope, el, attrs, field);\n      for (let att in attributes) {\n        const v = attributes[att];\n        html += ` ${att}`;\n        if (v || (v === false)) {\n          if (_.isString(v) && (v.indexOf('\"') > -1)) {\n            html += `='${v}'`;\n          } else {\n            html += `=\"${v}\"`;\n          }\n        }\n      }\n      if (this.placeholder)\n        html += ` placeholder=\"${this.placeholder}\" `;\n\n      return html;\n    }\n\n    innerHtml() {\n      return '';\n    }\n\n    labelTemplate() {\n      const placeholder = '';\n      const label = this.caption;\n      if (this.attrs.nolabel === 'placeholder') {\n        this.placeholder = label;\n        return '';\n      } else if (!_.isUndefined(this.attrs.nolabel))\n        return '';\n      return `<label for=\"${this.id}\" class=\"form-label\">${label}</label>`;\n    }\n\n    get emptyText() {\n      if (this.inplaceEditor)\n        return '';\n      return '--';\n    }\n\n    get readOnlyClass() {\n      if (this.inplaceEditor || this.spanPrefix === '::')\n        return 'grid-field-readonly';\n      return 'form-field-readonly';\n    }\n\n    spanTemplate(scope, el, attrs, field) {\n      return `<span class=\"${this.readOnlyClass}\">{{ ${this.spanPrefix}record.${this.field.name}.toString() || '${this.emptyText}' }}</span>`;\n    }\n\n    widgetTemplate() {\n      let html = `<${this.constructor.tag} id=\"${this.id}\" name=\"${this.field.name}\" ${this._getWidgetAttrs()}>`;\n      const inner = this.innerHtml();\n      if (inner)\n        html += inner + `</${this.constructor.tag}>`;\n      return html;\n    }\n\n    template() {\n      let label = '';\n      let span = this.spanTemplate();\n      if (!this.inplaceEditor) {\n        label = this.labelTemplate();\n        // span =\n      }\n      let widget = this.widgetTemplate();\n      if (this.inline === 'inline')\n        widget = `<div ng-if=\"dataSource.changing && dataSource.recordIndex === $index\">${widget}</div>`;\n      return `<div>${label}${span}${widget}</div>`;\n    }\n\n    link(scope, el, attrs, $compile, field) {\n      // Add watcher for field dependencies\n      if (field.depends) {\n        return (() => {\n          const result = [];\n          for (let dep of Array.from(field.depends)) {\n            if (!Array.from(scope.dataSource.fieldChangeWatchers).includes(dep)) {\n              scope.dataSource.fieldChangeWatchers.push(dep);\n              result.push(scope.$watch(`record.${dep}`, function(newValue, oldValue) {\n                // Ignore if dataSource is not in changing state\n                if ((newValue !== oldValue) && scope.dataSource.changing) {\n                  return scope.model.onFieldChange(dep, scope.record)\n                  .done(scope.dataSource.onFieldChange);\n                }\n              }));\n            }\n          }\n          return result;\n        })();\n      }\n    }\n\n    th() {\n      let cls = `${this.field.type} list-column`;\n      let lbl = this.element.attr('label') || `{{view.fields.${this.field.name}.caption}}`;\n      return `<th class=\"${cls}\" name=\"${this.field.name}\"><span>${lbl}</span></th>`;\n    }\n\n    _gridEditor(cls) {\n      return this.renderTo('section', true, cls);\n    }\n\n    _tdContent() {\n      return this.spanTemplate();\n    }\n\n    _td(cls) {\n      let content;\n      if (this.inplaceEditor)\n        content = this._gridEditor(cls);\n      else {\n        this.spanPrefix = '::';\n        content = this.spanTemplate();\n      }\n      return `<td class=\"${cls}\">${ content }</td>`;\n    }\n\n    td() {\n      if (this.content)\n        return this.content;\n      return this._td(`${this.field.type} field-${this.field.name}`);\n\n      let colHtml = this.element.html();\n      let s;\n      let fieldInfo = this.field;\n      let name = fieldInfo.name;\n      let editor = '';\n      if ((gridEditor === 'tabular') && html) editor = html;\n      if (colHtml) {\n        s = `<td><a data-id=\"{{::record.${name}[0]}}\">${colHtml}</a>${editor}</td>`;\n      } else if (fieldInfo.type === 'ForeignKey') {\n        s = `<td><a data-id=\"{{::row.${name}[0]}}\">{{row.${name}[1]}}</a>${editor}</td>`;\n      } else if  (fieldInfo._listChoices) {\n        s = `<td class=\"${cls}\">{{::view.fields.${name}._listChoices[row.${name}]}}${editor}</td>`;\n      } else if (fieldInfo.type === 'BooleanField') {\n        s = `<td class=\"bool-text ${cls}\">{{::row.${name} ? '${Katrid.i18n.gettext('yes')}' : '${Katrid.i18n.gettext('no')}'}}${editor}</td>`;\n      } else if (fieldInfo.type === 'IntegerField') {\n        s = `<td class=\"${cls}\">{{::row.${name}|number}}${editor}</td>`;\n      } else if (fieldInfo.type === 'DecimalField') {\n        let decimalPlaces = this.element.attr('decimal-places') || 2;\n        s = `<td class=\"${cls}\">{{::row.${name}|number:${ decimalPlaces } }}${editor}</td>`;\n      } else if (fieldInfo.type === 'DateField') {\n        s = `<td class=\"${cls}\">{{::row.${name}|date:'${Katrid.i18n.gettext('yyyy-mm-dd').replace(/[m]/g, 'M')}'}}${editor}</td>`;\n      } else if (fieldInfo.type === 'DateTimeField') {\n        s = `<td class=\"${cls}\">{{::row.${name}|date:'${Katrid.i18n.gettext('yyyy-mm-dd').replace(/[m]/g, 'M')}'}}${editor}</td>`;\n      } else {\n        s = `<td>{{ ::row.${name} }}</td>`;\n      }\n      return s;\n    }\n  }\n\n\n  class InputWidget extends Field {\n    static get tag() {\n      return 'input input-field';\n    }\n\n    constructor() {\n      super(...arguments);\n      this.classes.push('form-control');\n    }\n\n    get type() {\n      return 'text';\n    }\n\n    widgetTemplate1() {\n      let html;\n      if (this.constructor.tag.startsWith('input')) {\n        html = `<${this.tag} id=\"${attrs._id}\" type=\"${type}\" name=\"${attrs.name}\" ${this._getWidgetAttrs(scope, el, attrs, field)}>`;\n      } else {\n        html = `<${this.tag} id=\"${attrs._id}\" name=\"${attrs.name}\" ${this._getWidgetAttrs(scope, el, attrs, field)}>`;\n      }\n      const inner = this.innerHtml(scope, el, attrs, field);\n      if (inner) {\n        html += inner + `</${this.tag}>`;\n      }\n      return html;\n    }\n\n    widgetTemplate() {\n      let type = this.type;\n      const prependIcon = this.attrs.icon;\n      let html = `<${this.constructor.tag} id=\"${this.id}\" type=\"${this.type}\" name=\"${this.field.name}\" ${this._getWidgetAttrs()}>`;\n      if (prependIcon)\n        return `<label class=\"prepend-icon\"><i class=\"icon ${prependIcon}\"></i>${html}</label>`;\n\n      const inner = this.innerHtml();\n      if (inner)\n        html += inner + `</${this.constructor.tag}>`;\n\n      return html;\n    }\n  }\n\n\n  class StringField extends InputWidget {\n    widgetAttrs() {\n      const attributes = super.widgetAttrs();\n      if (this.field.maxLength)\n        attributes['maxlength'] = this.field.maxLength.toString();\n\n      return attributes;\n    }\n  }\n\n\n  class NumericField extends InputWidget {\n    static get tag() {\n      return 'input decimal';\n    }\n\n    get type() {\n      if (Katrid.settings.ui.isMobile)\n        return 'number';\n      return 'text';\n    }\n\n    spanTemplate() {\n      return `<span class=\"${this.readOnlyClass}\">{{ ${this.spanPrefix}(record.${this.field.name}|number) || '${this.emptyText}' }}</span>`;\n    }\n  }\n\n\n  class IntegerField extends NumericField {\n    static get tag() {\n      return 'input decimal decimal-places=\"0\"';\n    }\n  }\n\n\n  class TimeField extends InputWidget {\n    get type() {\n      return 'time';\n    }\n  }\n\n\n  class SelectionField extends InputWidget {\n    static get tag() {\n      return 'select';\n    }\n\n    spanTemplate() {\n      return `<span class=\"${this.readOnlyClass}\">{{ ${this.spanPrefix}view.fields.${this.field.name}.displayChoices[record.${this.field.name}] || '${this.emptyText}' }}</span>`;\n    }\n\n    innerHtml() {\n      return `<option ng-repeat=\"choice in view.fields.${this.field.name}.choices\" value=\"{{choice[0]}}\">{{choice[1]}}</option>`;\n    }\n  }\n\n\n  class ForeignKey extends Field {\n    static get tag() {\n      return 'input foreignkey';\n    }\n\n    spanTemplate() {\n      let allowOpen = true;\n      if (((this.attrs.allowOpen != null) && (this.attrs.allowOpen === 'false')) || ((this.attrs.allowOpen == null) && this.field.attrs && (this.field.attrs['allow-open'] === false)))\n        allowOpen = false;\n\n      if (!allowOpen || this.inList)\n        return `<span class=\"${this.readOnlyClass}\"><a href=\"javascript:void(0)\">{{ ${this.spanPrefix}record.${this.field.name}[1] || '${this.emptyText}' }}</a></span>`;\n\n      return `<span class=\"${this.readOnlyClass}\"><a href=\"#/action/${ this.field.model }/view/?id={{ ${this.spanPrefix}record.${this.field.name}[0] }}\" ng-click=\"action.openObject('${ this.field.model }', record.${this.field.name}[0], $event, '${ this.field.caption }')\">{{ ${this.spanPrefix}record.${this.field.name}[1] }}</a><span ng-if=\"!record.${this.field.name}[1]\">--</span></span>`;\n    }\n\n    get type() {\n      return 'hidden';\n    }\n\n    _tdContent() {\n      return `{{record.${this.field.name}[1]}}`;\n    }\n  }\n\n\n  class TextField extends StringField {\n    static get tag() {\n      return 'textarea';\n    }\n  }\n\n  class XmlField extends TextField {\n    constructor(...args) {\n      super(...args);\n      console.log('cols', this.cols);\n    }\n  }\n\n\n  class FloatField extends NumericField {\n    static get tag() {\n      if (Katrid.settings.ui.isMobile)\n        return 'input';\n      return 'input decimal';\n    }\n\n    get type() {\n      if (Katrid.settings.ui.isMobile)\n        return 'number';\n      return 'text';\n    }\n\n    spanTemplate() {\n      let decimalPlaces = this.attrs.decimalPlaces || 2;\n      return `<span class=\"${this.readOnlyClass}\">{{ ${this.spanPrefix}(record.${this.field.name}|number:${ decimalPlaces }) || '${this.emptyText}' }}</span>`;\n    }\n\n    _tdContent() {\n      let filter;\n      let decimalPlaces = this.element.attr('decimal-places');\n      if (decimalPlaces)\n        filter `number:${ decimalPlaces }`;\n      else\n        filter = `numberFormat:${this.element.attr('max-digits') || 6}`;\n      return `{{::record.${this.field.name}|${filter} }}`;\n    }\n  }\n\n\n  class DecimalField extends FloatField {\n    spanTemplate() {\n      let maxDigits = this.attrs.maxDigits;\n      let fmt = 'number';\n      if (maxDigits)\n        fmt = 'numberFormat';\n      else\n        maxDigits = this.attrs.decimalPlaces || 2;\n      return `<span class=\"${this.readOnlyClass}\">{{ ${this.spanPrefix}(record.${this.field.name}|${ fmt }:${ maxDigits }) || '${this.emptyText}' }}</span>`;\n    }\n\n    _tdContent(cls) {\n      let maxDigits = this.element.attr('max-digits');\n      if (maxDigits)\n        return `<td class=\"${cls}\">{{::record.${this.field.name}|numberFormat:${ maxDigits } }}${this._gridEditor()}</td>`;\n      else {\n        maxDigits = 2;\n        return `{{::record.${this.field.name}|number:${ maxDigits } }}`;\n      }\n    }\n  }\n\n\n  class DateField extends TextField {\n    static get tag() {\n      return 'input date-input';\n    }\n\n    get type() {\n      return 'date';\n    }\n\n    spanTemplate() {\n      return `<span class=\"${this.readOnlyClass}\">{{ ${this.spanPrefix}(record.${this.field.name}|date:'${Katrid.i18n.gettext('yyyy-mm-dd').replace(/[m]/g, 'M')}') || '${this.emptyText}' }}</span>`;\n    }\n\n    // widgetTemplate() {\n    //   return `<div class=\"input-group date\" ng-show=\"dataSource.changing\">${ super.widgetTemplate() }<div class=\"input-group-append\"><button class=\"btn btn-default\" type=\"button\"><span class=\"fa fa-calendar\"></span></button></div></div>`;\n    // }\n\n    _tdContent(cls) {\n      return `{{::record.${this.field.name}|date:'${Katrid.i18n.gettext('yyyy-MM-dd')}'}}`;\n    }\n  }\n\n\n  class DateTimeField extends TextField {\n    static get tag() {\n      return 'input date-input';\n    }\n\n    get type() {\n      return 'datetime-local';\n    }\n\n    spanTemplate() {\n      return `<span class=\"${this.readOnlyClass}\">{{ ${this.spanPrefix}(record.${this.field.name}|date:'${Katrid.i18n.gettext('yyyy-MM-dd hh:mma')}') || '${this.emptyText}' }}</span>`;\n    }\n  }\n\n\n  class OneToManyField extends Field {\n    static get tag() {\n      return 'grid';\n    }\n\n    spanTemplate() {\n      return '';\n    }\n\n    innerHtml() {\n      return this.content;\n      let html = his.element.html();\n      if (html)\n        return html;\n      return '';\n    }\n\n  }\n\n\n  class ManyToManyField extends Field {\n    static get tag() {\n      return 'input foreignkey multiple';\n    }\n\n    spanTemplate() {\n      return `<span class=\"${this.readOnlyClass}\">{{ ${this.spanPrefix}record.${this.field.name}|m2m }}</span>`;\n    }\n\n    get type() {\n      return 'hidden';\n    }\n  }\n\n\n  class BooleanField extends InputWidget {\n    spanTemplate() {\n      return `<span class=\"${this.readOnlyClass} bool-text\">\n  {{${this.spanPrefix}record.${this.field.name} ? '${Katrid.i18n.gettext('yes')}' : '${Katrid.i18n.gettext('no')}'}}\n  </span>`;\n    }\n\n    get type() {\n      return 'checkbox';\n    }\n\n    _td(cls) {\n      return super._td('bool-text ' + cls);\n    }\n\n    widgetTemplate() {\n      let html = super.widgetTemplate();\n      html = `<label class=\"checkbox\" ng-show=\"dataSource.changing\">${html}`;\n      if (this.field.help_text) {\n        html += this.field.help_text;\n      } else {\n        html += this.field.caption;\n      }\n      html += '<i></i></label>';\n      return html;\n    }\n\n    labelTemplate() {\n      if (this.field.help_text)\n        return super.labelTemplate();\n      return `<label for=\"${ this.id }\" class=\"form-label form-label-checkbox\"><span>${ this.caption }</span>&nbsp;</label>`;\n    }\n  }\n\n\n  class FileField extends InputWidget {\n    static get tag() {\n      return 'input file-reader';\n    }\n\n    get type() {\n      return 'file';\n    }\n  }\n\n\n  class ImageField extends FileField {\n    static get tag() {\n      return 'input file-reader accept=\"image/*\"';\n    }\n\n    spanTemplate() { return ''; }\n\n    widgetTemplate() {\n      let html = super.widgetTemplate();\n      let imgSrc = this.attrs.ngEmptyImage || (this.attrs.emptyImage && (\"'\" + this.attrs.emptyImage + \"'\")) || \"'/static/web/assets/img/no-image.png'\";\n      html = `<div class=\"image-box image-field\">\n  <img ng-src=\"{{ record.${this.field.name} || ${imgSrc} }}\" />\n    <div class=\"text-right image-box-buttons\">\n    <button class=\"btn btn-default\" type=\"button\" title=\"${Katrid.i18n.gettext('Change')}\" onclick=\"$(this).closest('.image-box').find('input').trigger('click')\"><i class=\"fa fa-pencil\"></i></button>\n    <button class=\"btn btn-default\" type=\"button\" title=\"${Katrid.i18n.gettext('Clear')}\" ng-click=\"record[this.field.name] = null\"><i class=\"fa fa-trash\"></i></button>\n    </div>\n      ${html}</div>`;\n      return html;\n    }\n  }\n\n\n  class PasswordField extends InputWidget {\n\n    get type() {\n      return 'password';\n    }\n\n    spanTemplate() {\n      return `<span class=\"form-field-readonly\">*******************</span>`;\n    }\n  }\n\n\n  class SortableField extends Field {\n    constructor(...args) {\n      super(...args);\n      this.col = null;\n    }\n    static get tag() {\n      return 'sortable-field';\n    }\n\n\n    get type() {\n      return 'hidden';\n    }\n\n    _td(cls) {\n      return `<td onclick=\"event.preventDefault();event.stopPropagation();\" class=\"list-column-sortable\">${ this.spanTemplate() }</td>`;\n    }\n\n    th() {\n      return `<th class=\"list-column-sortable\" name=\"${this.field.name}\"></th>`;\n    }\n\n    spanTemplate() {\n      return `<sortable-field id=\"${this.id}\" name=\"${this.field.name}\" ng-model=\"record.${this.field.name}\"/>`;\n    }\n  }\n\n  Object.assign(this.Katrid.UI.Widgets,\n    {\n      Field,\n      InputWidget,\n      StringField,\n      IntegerField,\n      SelectionField,\n      ForeignKey,\n      TextField,\n      DecimalField,\n      FloatField,\n      DateField,\n      DateTimeField,\n      TimeField,\n      BooleanField,\n      OneToManyField,\n      ManyToManyField,\n      FileField,\n      PasswordField,\n      ImageField,\n      SortableField,\n      XmlField,\n      input: InputWidget,\n      string: StringField,\n      integer: IntegerField,\n      selection: SelectionField,\n      text: TextField,\n      decimal: DecimalField,\n      float: FloatField,\n      file: FileField,\n      boolean: BooleanField,\n      password: PasswordField,\n      image: ImageField,\n      sortable: SortableField,\n    }\n  );\n})();\n","(function() {\n\n  let uiKatrid = Katrid.UI.uiKatrid;\n\n  uiKatrid.controller('TabsetController', [\n    '$scope',\n    function ($scope) {\n      const ctrl = this;\n      const tabs = (ctrl.tabs = ($scope.tabs = []));\n\n      ctrl.select = function (selectedTab) {\n        angular.forEach(tabs, function (tab) {\n          if (tab.active && (tab !== selectedTab)) {\n            tab.active = false;\n            tab.onDeselect();\n          }\n        });\n        selectedTab.active = true;\n        selectedTab.onSelect();\n      };\n\n      ctrl.addTab = function (tab) {\n        tabs.push(tab);\n        // we can't run the select function on the first tab\n        // since that would select it twice\n        if (tabs.length === 1) {\n          tab.active = true;\n        } else if (tab.active) {\n          ctrl.select(tab);\n        }\n      };\n\n      ctrl.removeTab = function (tab) {\n        const index = tabs.indexOf(tab);\n        //Select a new tab if the tab to be removed is selected and not destroyed\n        if (tab.active && (tabs.length > 1) && !destroyed) {\n          //If this is the last tab, select the previous tab. else, the next tab.\n          const newActiveIndex = index === (tabs.length - 1) ? index - 1 : index + 1;\n          ctrl.select(tabs[newActiveIndex]);\n        }\n        tabs.splice(index, 1);\n      };\n\n      var destroyed = undefined;\n      $scope.$on('$destroy', function () {\n        destroyed = true;\n      });\n    }\n  ]);\n\n  uiKatrid.directive('tabset', () =>\n    ({\n      restrict: 'EA',\n      transclude: true,\n      replace: true,\n      scope: {\n        type: '@'\n      },\n      controller: 'TabsetController',\n      template: `<div class=\"tabset\"><div class=\\\"clearfix\\\"></div>\\n` +\n      \"  <div class=\\\"nav nav-{{type || 'tabs'}}\\\" ng-class=\\\"{'nav-stacked': vertical, 'nav-justified': justified}\\\" ng-transclude></div>\\n\" +\n      \"  <div class=\\\"tab-content\\\">\\n\" +\n      \"    <div class=\\\"tab-pane\\\" \\n\" +\n      \"         ng-repeat=\\\"tab in tabs\\\" \\n\" +\n      `         ng-class=\"{active: tab.active}\">` +\n      `<div class=\"col-12\"><div class=\"row\" tab-content-transclude=\"tab\"></div></div>` +\n      \"    </div>\\n\" +\n      \"  </div>\\n\" +\n      \"</div>\\n\",\n      link(scope, element, attrs) {\n        scope.vertical = angular.isDefined(attrs.vertical) ? scope.$parent.$eval(attrs.vertical) : false;\n        return scope.justified = angular.isDefined(attrs.justified) ? scope.$parent.$eval(attrs.justified) : false;\n      }\n    })\n  );\n\n\n  uiKatrid.directive('tab', [\n    '$parse',\n    $parse =>\n      ({\n        require: '^tabset',\n        restrict: 'EA',\n        replace: true,\n        template: `<a class=\"nav-item nav-link\" href ng-click=\"select()\" tab-heading-transclude ng-class=\"{active: active, disabled: disabled}\">{{heading}}</a>`,\n        transclude: true,\n        scope: {\n          active: '=?',\n          heading: '@',\n          onSelect: '&select',\n          onDeselect: '&deselect'\n        },\n        controller() {\n          //Empty controller so other directives can require being 'under' a tab\n        },\n        compile(elm, attrs, transclude) {\n          return function (scope, elm, attrs, tabsetCtrl) {\n            scope.$watch('active', function (active) {\n              if (active) {\n                tabsetCtrl.select(scope);\n              }\n            });\n            scope.disabled = false;\n            if (attrs.disabled) {\n              scope.$parent.$watch($parse(attrs.disabled), function (value) {\n                scope.disabled = !!value;\n              });\n            }\n\n            scope.select = function () {\n              if (!scope.disabled) {\n                scope.active = true;\n              }\n            };\n\n            tabsetCtrl.addTab(scope);\n            scope.$on('$destroy', function () {\n              tabsetCtrl.removeTab(scope);\n            });\n            //We need to transclude later, once the content container is ready.\n            //when this link happens, we're inside a tab heading.\n            scope.$transcludeFn = transclude;\n          };\n        }\n\n      })\n\n  ]);\n\n  uiKatrid.directive('tabHeadingTransclude', [() =>\n    ({\n      restrict: 'A',\n      require: '^tab',\n      link(scope, elm, attrs, tabCtrl) {\n        scope.$watch('headingElement', function (heading) {\n          if (heading) {\n            elm.html('');\n            elm.append(heading);\n          }\n        });\n      }\n    })\n\n  ]);\n\n\n  uiKatrid.directive('tabContentTransclude', function () {\n\n    const isTabHeading = node => node.tagName && (node.hasAttribute('tab-heading') || node.hasAttribute('data-tab-heading') || (node.tagName.toLowerCase() === 'tab-heading') || (node.tagName.toLowerCase() === 'data-tab-heading'));\n\n    return {\n      restrict: 'A',\n      require: '^tabset',\n      link(scope, elm, attrs) {\n        const tab = scope.$eval(attrs.tabContentTransclude);\n        //Now our tab is ready to be transcluded: both the tab heading area\n        //and the tab content area are loaded.  Transclude 'em both.\n        tab.$transcludeFn(tab.$parent, function (contents) {\n          angular.forEach(contents, function (node) {\n            if (isTabHeading(node)) {\n              //Let tabHeadingTransclude know.\n              tab.headingElement = node;\n            } else {\n              elm.append(node);\n            }\n          });\n        });\n      }\n\n    };\n  });\n\n}).call(this);\n","(function () {\n  let uiKatrid = Katrid.UI.uiKatrid;\n\n  uiKatrid.directive('datePicker', ['$filter', $filter => ({\n    restrict: 'A',\n    require: '?ngModel',\n    link(scope, el, attrs, controller) {\n      // TODO localize the date format\n      let mask = '99/99/9999';\n      let format = attrs.datePicker || 'L';\n      if (format === 'L LT')\n        mask = '99/99/9999 99:99';\n      el.inputmask({\n        mask,\n        insertMode: false,\n      });\n      let calendar = $(el.parent()).datetimepicker({\n        useCurrent: false,\n        format,\n        icons: {\n          time: 'fa fa-clock',\n        },\n      })\n      .on('dp.change', function (evt) {\n        calendar.datetimepicker('hide');\n      })\n      .on('dp.hide', function (evt) {\n        controller.$setDirty();\n        controller.$setViewValue(el.val());\n      });\n      el.on('focus', () => el.select());\n\n      controller.$render = function () {\n        if (controller.$modelValue) {\n          calendar.datetimepicker('date', moment.utc(controller.$modelValue));\n        } else\n          el.val('');\n      };\n\n      el.on('blur', () => {\n        let v = moment(el.val(), format);\n        if (v.isValid())\n          controller.$modelValue = v.format('YYYY-MM-DD');\n        else\n          controller.$modelValue = null;\n      });\n\n      controller.$parsers.push(value => {\n        let v = moment(el.val(), format);\n        if (v.isValid()) {\n          if (format === 'L')\n            return v.format('YYYY-MM-DD');\n          else if (format === 'L LT')\n            return v.format('YYYY-MM-DD HH:mm');\n        }\n        return null;\n      });\n\n      // el.on('click', () => setTimeout(() => $(el).select()));\n      // controller.$formatters.push(function (value) {\n      //   if (value) {\n      //     const dt = new Date(value);\n      //     // calendar.datepicker('setDate', dt);\n      //     return $filter('date')(value, dateFmt);\n      //   }\n      //   return value;\n      // });\n\n      // controller.$render = function () {\n      //   if (_.isDate(controller.$viewValue)) {\n      //     const v = $filter('date')(controller.$viewValue, dateFmt);\n      //     return el.val(v);\n      //   } else {\n      //     return el.val(controller.$viewValue);\n      //   }\n      // };\n\n    }\n  })]);\n\n  uiKatrid.directive('timePicker', ['$filter', $filter => ({\n    restrict: 'A',\n    require: '?ngModel',\n    link(scope, el, attrs, controller) {\n      // TODO localize the time format\n      let mask = '99:99';\n      el.inputmask({\n        mask,\n        insertMode: false,\n      });\n      el.on('focus', () => el.select());\n\n    }\n  })]);\n\n})();\n","(function () {\n\n  class Comments {\n    constructor(scope) {\n      this.scope = scope;\n      this.model = this.scope.$parent.model;\n\n      this.scope.$parent.$watch('recordId', key => {\n        this.items = null;\n        this.scope.loading = Katrid.i18n.gettext('Loading...');\n        clearTimeout(this._pendingOperation);\n        this._pendingOperation = setTimeout(() => {\n          this._pendingOperation = null;\n          this.masterChanged(key);\n          return this.scope.$apply(() => {\n            return this.scope.loading = null;\n          });\n        }\n        , 1000);\n      });\n\n      this.items = [];\n    }\n\n    async masterChanged(key) {\n      if (key) {\n        const svc = new Katrid.Services.Model('mail.message');\n        if (this.scope.$parent.record)\n        return svc.post('get_messages', { args: [this.scope.$parent.record.messages] })\n        .then(res => {\n          this.items = res;\n          this.scope.$apply();\n        });\n      }\n    }\n\n    async _sendMesage(msg, attachments) {\n      if (attachments)\n        attachments = attachments.map((obj) => obj.id);\n      let msgs = await this.model.post('post_message', { args: [[this.scope.$parent.recordId]], kwargs: { content: msg, content_subtype: 'html', format: true, attachments: attachments } });\n      this.scope.message = '';\n      this.items = msgs.concat(this.items);\n      this.scope.$apply();\n      this.scope.files = null;\n      this.scope.hideEditor();\n    }\n\n    postMessage(msg) {\n      if (this.scope.files.length) {\n        let files = [];\n        for (let f of this.scope.files) files.push(f.file);\n        var me = this;\n        Katrid.Services.Attachments.upload({files: files}, this.scope)\n        .done((res) => {\n          me._sendMesage(msg, res);\n        });\n      } else\n        this._sendMesage(msg);\n    }\n  }\n\n\n  Katrid.UI.uiKatrid.directive('comments', () =>\n    ({\n      restrict: 'E',\n      scope: {},\n      replace: true,\n      template: '<div class=\"content\"><div class=\"comments\"><mail-comments/></div></div>',\n      link(scope, element, attrs) {\n        if (element.closest('.modal-dialog').length)\n          element.remove();\n        else\n          $(element).closest('.form-view[ng-form=form]').children('.content:first').append(element);\n      }\n    })\n  );\n\n  Katrid.UI.uiKatrid.directive('mailComments', () =>\n    ({\n      restrict: 'E',\n      controller: ['$scope', ($scope) => {\n        $scope.comments = new Comments($scope);\n        $scope.files = [];\n\n        $scope.showEditor = () => {\n          $($scope.el).find('#mail-editor').show();\n          $($scope.el).find('#mail-msgEditor').focus();\n        };\n\n        $scope.hideEditor = () => {\n          $($scope.el).find('#mail-editor').hide();\n        };\n\n        $scope.attachFile = (file) => {\n          for (let f of file.files)\n            $scope.files.push({\n              name: f.name,\n              type: f.type,\n              file: f\n            });\n          $scope.$apply();\n        };\n\n        $scope.deleteFile = (idx) => {\n          $scope.files.splice(idx, 1);\n        }\n      }],\n      replace: true,\n      link(scope, element, attrs) {\n        scope.el = element;\n      },\n\n      template() {\n        return `\n  <div class=\"container\">\n          <h3>${Katrid.i18n.gettext('Comments')}</h3>\n          <div class=\"form-group\">\n          <button class=\"btn btn-outline-secondary\" ng-click=\"showEditor();\">${Katrid.i18n.gettext('New message')}</button>\n          <button class=\"btn btn-outline-secondary\">${Katrid.i18n.gettext('Log an internal note')}</button>\n          </div>\n          <div id=\"mail-editor\" style=\"display: none;\">\n            <div class=\"form-group\">\n              <textarea id=\"mail-msgEditor\" class=\"form-control\" ng-model=\"message\"></textarea>\n            </div>\n            <div class=\"form-group\">\n              <button class=\"btn btn-default\" type=\"button\" onclick=\"$(this).next().click()\"><i class=\"fa fa-paperclip\"></i></button>\n              <input class=\"input-file-hidden\" type=\"file\" multiple onchange=\"angular.element(this).scope().attachFile(this)\">\n            </div>\n            <div class=\"form-group\" ng-show=\"files.length\">\n              <ul class=\"list-inline attachments-area\">\n                <li ng-repeat=\"file in files\" ng-click=\"deleteFile($index)\" title=\"${ Katrid.i18n.gettext('Delete this attachment') }\">{{ file.name }}</li>\n              </ul>\n            </div>\n            <div class=\"from-group\">\n              <button class=\"btn btn-primary\" ng-click=\"comments.postMessage(message)\">${Katrid.i18n.gettext('Send')}</button>\n            </div>\n          </div>\n  \n          <hr>\n  \n          <div ng-show=\"loading\">{{ loading }}</div>\n          <div class=\"comment media col-sm-12\" ng-repeat=\"comment in comments.items\">\n            <div class=\"media-left\">\n              <img src=\"/static/web/assets/img/avatar.png\" class=\"avatar rounded\">\n            </div>\n            <div class=\"media-body\">\n              <strong>{{ ::comment.author_name }}</strong> - <span class=\"timestamp text-muted\" title=\"$\\{ ::comment.date_time|moment:'LLLL'}\"> {{::comment.date_time|moment}}</span>\n              <div class=\"clearfix\"></div>\n              <div class=\"form-group\">\n                {{::comment.content}}\n              </div>\n              <div class=\"form-group\" ng-if=\"comment.attachments\">\n                <ul class=\"list-inline\">\n                  <li ng-repeat=\"file in comment.attachments\"><a href=\"/web/content/$\\{ ::file.id }/?download\">{{ ::file.name }}</a></li>\n                </ul>\n              </div>\n            </div>\n          </div>\n    </div>`;\n      }\n    })\n  );\n\n\n  class MailFollowers {}\n\n\n  class MailComments extends Katrid.UI.Widgets.Widget {\n    static initClass() {\n      this.prototype.tag = 'mail-comments';\n    }\n\n    spanTemplate(scope, el, attrs, field) {\n      return '';\n    }\n  }\n  MailComments.initClass();\n\n\n  Katrid.UI.Widgets.MailComments = MailComments;\n\n})();\n","(function () {\n  class BaseTemplate {\n\n    getSettingsDropdown(viewType) {\n      if (viewType === 'form') {\n        return `<ul class=\"dropdown-menu pull-right\">\n    <li>\n      <a href=\"javascript:void(0);\" ng-click=\"action.showDefaultValueDialog()\">${ Katrid.i18n.gettext('Set Default') }</a>\n    </li>\n  </ul>`;\n      }\n    }\n\n\n    getSetDefaultValueDialog() {\n      return `\\\n  <div class=\"modal fade\" id=\"set-default-value-dialog\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog\" role=\"document\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"${ Katrid.i18n.gettext('Close') }\"><span aria-hidden=\"true\">&times;</span></button>\n          <h4 class=\"modal-title\">${ Katrid.i18n.gettext('Set Default') }</h4>\n        </div>\n        <div class=\"modal-body\">\n          <select class=\"form-control\" id=\"id-set-default-value\">\n            <option ng-repeat=\"field in view.fields\">{{ field.caption }} = {{ record[field.name] }}</option>\n          </select>\n          <div class=\"radio\">\n            <label><input type=\"radio\" name=\"public\">${ Katrid.i18n.gettext('Only me') }</label>\n          </div>\n          <div class=\"radio\">\n            <label><input type=\"radio\" name=\"public\">${ Katrid.i18n.gettext('All users') }</label>\n          </div>\n        </div>\n        <div class=\"modal-footer\">\n          <button type=\"button\" class=\"btn btn-primary\">${ Katrid.i18n.gettext('Save') }</button>\n          <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">${ Katrid.i18n.gettext('Cancel') }</button>\n        </div>\n      </div>\n    </div>\n  </div>\\\n  `;\n    }\n\n    static get cssListClass() {\n      return 'table table-striped table-bordered table-condensed table-hover display responsive nowrap dataTable no-footer dtr-column';\n    }\n\n    renderList(scope, element, attrs, rowClick, parentDataSource, showSelector=true) {\n      let ths = '<th ng-show=\"dataSource.groups.length\"></th>';\n      let tfoot = false;\n      let totals = [];\n      let cols = `<td ng-show=\"dataSource.groups.length\" class=\"group-header\">\n  <div ng-show=\"record._group\">\n  <span class=\"fa fa-fw fa-caret-right\"\n    ng-class=\"{'fa-caret-down': record._group.expanded, 'fa-caret-right': record._group.collapsed}\"></span>\n    {{::record._group.__str__}} ({{::record._group.count }})</div></td>`;\n      if (showSelector) {\n        ths += `<th class=\"list-record-selector\"><input type=\"checkbox\" ng-click=\"action.selectToggle($event.currentTarget)\" onclick=\"$(this).closest('table').find('td.list-record-selector input').prop('checked', $(this).prop('checked'))\"></th>`;\n        cols += `<td class=\"list-record-selector\" onclick=\"event.stopPropagation();\"><input title=\"teste\" type=\"checkbox\" ng-click=\"action.selectToggle($event.currentTarget)\" onclick=\"if (!$(this).prop('checked')) $(this).closest('table').find('th.list-record-selector input').prop('checked', false)\"></td>`;\n      }\n\n      for (let col of Array.from(element.children())) {\n        let colHtml = col.outerHTML;\n        col = $(col);\n        let name = col.attr('name');\n        if (!name) {\n          cols += `<td>${col.html()}</td>`;\n          ths += \"<th><span>${col.attr('label')}</span></th>\";\n          continue;\n        }\n\n        let total = col.attr('total');\n        if (total) {\n          totals.push([name, total]);\n          tfoot = true;\n        } else totals.push(total);\n\n        name = col.attr('name');\n        const fieldInfo = scope.view.fields[name];\n\n        if ((col.attr('visible') === 'False') || (fieldInfo.visible === false))\n          continue;\n\n        // if (fieldInfo.choices) {\n        //   fieldInfo._listChoices = {};\n        //   for (let choice of Array.from(fieldInfo.choices)) {\n        //     fieldInfo._listChoices[choice[0]] = choice[1];\n        //   }\n        // }\n\n        let _widget = fieldInfo.createWidget(col.attr('widget'), scope, col, col);\n        _widget.inList = true;\n        _widget.inplaceEditor = Boolean(scope.inline);\n        ths += _widget.th(col.attr('label'));\n\n        cols += _widget.td(scope.inline, colHtml, col);\n      }\n      if (parentDataSource) {\n        ths += '<th class=\"list-column-delete\" ng-show=\"parent.dataSource.changing && !dataSource.readonly\">';\n        cols += '<td class=\"list-column-delete\" ng-show=\"parent.dataSource.changing && !dataSource.readonly\" ng-click=\"removeItem($index);$event.stopPropagation();\"><i class=\"fa fa-trash-o\"></i></td>';\n      }\n      if ((rowClick == null)) {\n        rowClick = 'action.listRowClick($index, row, $event)';\n      }\n\n      if (tfoot)\n        tfoot = `<tfoot><tr>${ totals.map(t => (t ? `<td class=\"text-right\"><strong><ng-total field=\"${ t[0] }\" type=\"${ t[1] }\"></ng-total></ strong></td>` : '<td class=\"borderless\"></td>')).join('') }</tr></tfoot>`;\n      else\n        tfoot = '';\n      let gridClass = ' grid';\n      if (scope.inline)\n        gridClass += ' inline-editor';\n      return `<table class=\"${this.constructor.cssListClass}${gridClass}\">\n  <thead><tr>${ths}</tr></thead>\n  <tbody>\n  <tr ng-repeat=\"record in records | limitTo:totalDisplayed\" ng-click=\"${rowClick}\" ng-class=\"{'group-header': record._hasGroup, 'form-data-changing': (dataSource.changing && dataSource.recordIndex === $index), 'form-data-readonly': !(dataSource.changing && dataSource.recordIndex === $index)}\" ng-form=\"grid-row-form-{{$index}}\" id=\"grid-row-form-{{$index}}\">${cols}</tr>\n  </tbody>\n  ${ tfoot }\n  </table>\n  <a href=\"javascript:void(0)\" ng-show=\"records.length > totalDisplayed\" ng-click=\"totalDisplayed = totalDisplayed + 1000\">${ Katrid.i18n.gettext('View more...') }</a>\n  `;\n    }\n\n    renderGrid(scope, element, attrs, rowClick) {\n      const tbl = this.renderList(scope, element, attrs, rowClick, true, false);\n      let buttons;\n      if (attrs.inline == 'inline')\n        buttons = `\n<button class=\"btn btn-xs btn-info\" ng-click=\"addItem()\" ng-show=\"parent.dataSource.changing && !dataSource.changing\" type=\"button\">${Katrid.i18n.gettext('Add')}</button>\n<button class=\"btn btn-xs btn-info\" ng-click=\"addItem()\" ng-show=\"dataSource.changing\" type=\"button\">${Katrid.i18n.gettext('Save')}</button>\n<button class=\"btn btn-xs btn-info\" ng-click=\"cancelChanges()\" ng-show=\"dataSource.changing\" type=\"button\">${Katrid.i18n.gettext('Cancel')}</button>\n`;\n      else\n        buttons = `\n<button class=\"btn btn-xs btn-info\" ng-click=\"addItem()\" ng-show=\"parent.dataSource.changing\" type=\"button\">${Katrid.i18n.gettext('Add')}</button>\n<button class=\"btn btn-xs btn-outline-secondary float-right\" ng-click=\"pasteData()\" ng-show=\"parent.dataSource.changing\" type=\"button\" title=\"${Katrid.i18n.gettext('Paste')}\">\n<i class=\"fa fa-clipboard\"></i>\n</button>\n`;\n      return `<div style=\"overflow-x: auto;\"><div ng-show=\"!dataSource.readonly\">\n  ${buttons}\n  </div><div class=\"row inline-input-dialog\" ng-show=\"dataSource.changing\"/>${tbl}</div>`;\n    }\n\n    windowDialog(scope) {\n      console.log('window dialog', scope);\n      return `\\\n  <div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n          <h4 class=\"modal-title\" id=\"myModalLabel\">\n          {{dialogTitle}}\n          {{action.info.display_name}}</h4>\n        </div>\n        <div class=\"modal-body\">\n    <div class=\"modal-dialog-body\" ng-class=\"{'form-data-changing': dataSource.changing}\"></div>\n  <div class=\"clearfix\"></div>\n        </div>\n        <div class=\"modal-footer\">\n          <button type=\"button\" class=\"btn btn-primary\" type=\"button\" ng-click=\"dataSource.saveAndClose()\" ng-show=\"dataSource.changing\">${Katrid.i18n.gettext('Save')}</button>\n          <button type=\"button\" class=\"btn btn-default\" type=\"button\" data-dismiss=\"modal\" ng-show=\"dataSource.changing\">${Katrid.i18n.gettext('Cancel')}</button>\n          <button type=\"button\" class=\"btn btn-default\" type=\"button\" data-dismiss=\"modal\" ng-show=\"!dataSource.changing\">${Katrid.i18n.gettext('Close')}</button>\n        </div>\n      </div>\n    </div>\n  </div>\\\n  `;\n    }\n\n    renderReportDialog(scope) {\n      return `<div ng-controller=\"ReportController\">\n  <form id=\"report-form\" method=\"get\" action=\"/web/reports/report/\">\n    <div class=\"data-heading panel panel-default\">\n      <div class=\"panel-body\">\n      <h2>{{ report.name }}</h3>\n      <div class=\"toolbar\">\n        <button class=\"btn btn-primary\" type=\"button\" ng-click=\"report.preview()\"><span class=\"fa fa-print fa-fw\"></span> ${ Katrid.i18n.gettext('Preview') }</button>\n  \n        <div class=\"btn-group\">\n          <button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\"\n                  aria-expanded=\"false\">${ Katrid.i18n.gettext('Export')  } <span class=\"caret\"></span></button>\n          <ul class=\"dropdown-menu\">\n            <li><a ng-click=\"Katrid.Reports.Reports.preview()\">PDF</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('docx')\">Word</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('xlsx')\">Excel</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('pptx')\">PowerPoint</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('csv')\">CSV</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('txt')\">${ Katrid.i18n.gettext('Text File') }</a></li>\n          </ul>\n        </div>\n  \n        <div class=\"btn-group\">\n          <button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\"\n                  aria-expanded=\"false\">${ Katrid.i18n.gettext('My reports')  } <span class=\"caret\"></span></button>\n          <ul class=\"dropdown-menu\">\n            <li><a ng-click=\"Katrid.Reports.Reports.preview()\">PDF</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('docx')\">Word</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('xlsx')\">Excel</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('pptx')\">PowerPoint</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('csv')\">CSV</a></li>\n            <li><a href=\"javascript:void(0)\" ng-click=\"Katrid.Reports.Reports.export('txt')\">${ Katrid.i18n.gettext('Text File') }</a></li>\n          </ul>\n        </div>\n  \n      <div class=\"pull-right btn-group\">\n        <button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\"\n                aria-expanded=\"false\"><i class=\"fa fa-gear fa-fw\"></i></button>\n        <ul class=\"dropdown-menu\">\n          <li><a href=\"javascript:void(0)\" ng-click=\"report.saveDialog()\">${ Katrid.i18n.gettext('Save') }</a></li>\n          <li><a href=\"#\">${ Katrid.i18n.gettext('Load') }</a></li>\n        </ul>\n      </div>\n  \n      </div>\n    </div>\n    </div>\n    <div class=\"col-sm-12\">\n      <table class=\"col-sm-12\" style=\"margin-top: 20px; display:none;\">\n        <tr>\n          <td colspan=\"2\" style=\"padding-top: 8px;\">\n            <label>${ Katrid.i18n.gettext('My reports') }</label>\n  \n            <select class=\"form-control\" ng-change=\"action.userReportChanged(action.userReport.id)\" ng-model=\"action.userReport.id\">\n                <option value=\"\"></option>\n                <option ng-repeat=\"rep in userReports\" value=\"{{ rep.id }}\">{{ rep.name }}</option>\n            </select>\n          </td>\n        </tr>\n      </table>\n    </div>\n  <div id=\"report-params\">\n  <div id=\"params-fields\" class=\"col-sm-12 form-group\">\n    <div class=\"checkbox\"><label><input type=\"checkbox\" ng-model=\"paramsAdvancedOptions\"> ${ Katrid.i18n.gettext('Advanced options') }</label></div>\n    <div ng-show=\"paramsAdvancedOptions\">\n      <div class=\"form-group\">\n        <label>${ Katrid.i18n.gettext('Printable Fields') }</label>\n        <input type=\"hidden\" id=\"report-id-fields\"/>\n      </div>\n      <div class=\"form-group\">\n        <label>${ Katrid.i18n.gettext('Totalizing Fields') }</label>\n        <input type=\"hidden\" id=\"report-id-totals\"/>\n      </div>\n    </div>\n  </div>\n  \n  <div id=\"params-sorting\" class=\"col-sm-12 form-group\">\n    <label class=\"control-label\">${ Katrid.i18n.gettext('Sorting') }</label>\n    <select multiple id=\"report-id-sorting\"></select>\n  </div>\n  \n  <div id=\"params-grouping\" class=\"col-sm-12 form-group\">\n    <label class=\"control-label\">${ Katrid.i18n.gettext('Grouping') }</label>\n    <select multiple id=\"report-id-grouping\"></select>\n  </div>\n  \n  <div class=\"clearfix\"></div>\n  \n  </div>\n    <hr>\n      <table class=\"col-sm-12\">\n        <tr>\n          <td class=\"col-sm-4\">\n            <select class=\"form-control\" ng-model=\"newParam\">\n              <option value=\"\">--- ${ Katrid.i18n.gettext('FILTERS') } ---</option>\n              <option ng-repeat=\"field in report.fields\" value=\"{{ field.name }}\">{{ field.label }}</option>\n            </select>\n          </td>\n          <td class=\"col-sm-8\">\n            <button\n                class=\"btn btn-default\" type=\"button\"\n                ng-click=\"report.addParam(newParam)\">\n              <i class=\"fa fa-plus fa-fw\"></i> ${ Katrid.i18n.gettext('Add Parameter') }\n            </button>\n          </td>\n        </tr>\n      </table>\n  <div class=\"clearfix\"></div>\n  <hr>\n  <div id=\"params-params\">\n    <div ng-repeat=\"param in report.params\" ng-controller=\"ReportParamController\" class=\"row form-group\">\n      <div class=\"col-sm-12\">\n      <div class=\"col-sm-4\">\n        <label class=\"control-label\">{{param.label}}</label>\n        <select ng-model=\"param.operation\" class=\"form-control\" ng-change=\"param.setOperation(param.operation)\">\n          <option ng-repeat=\"op in param.operations\" value=\"{{op.id}}\">{{op.text}}</option>\n        </select>\n      </div>\n      <div class=\"col-sm-8\" id=\"param-widget\"></div>\n      </div>\n    </div>\n  </div>\n  </form>\n  </div>\\\n  `;\n    }\n\n  }\n\n\n  Katrid.UI.utils = {\n    BaseTemplate,\n    Templates: new BaseTemplate()\n  };\n\n})();\n","(function() {\n\n  class NumPad {\n    constructor($compile) {\n      this.restrict = 'A';\n      this.require = 'ngModel';\n      this.scope = {};\n      this.$compile = $compile;\n    }\n    link(scope, el, attrs, ngModel) {\n\n      el.bind('click', () => {\n        console.log('numpad click');\n        let templ = this.$compile(Katrid.app.getTemplate('ui.numpad.pug'))(scope);\n        scope.val = parseFloat(ngModel.$modelValue || 0);\n        scope.$apply();\n        let modal = $(templ).modal();\n        modal.on('hidden.bs.modal', function() {\n          $(this).remove();\n        });\n\n        let comma = false;\n        let frac = '';\n\n        scope.done = () => {\n          scope.$parent.record[ngModel.$name] = scope.val.toString();\n          if (attrs.ngChange)\n            scope.$parent.$eval(attrs.ngChange);\n          ngModel.$setDirty();\n          modal.modal('hide');\n        };\n\n        scope.cancel = () => {\n          modal.modal('hide');\n        };\n\n        scope.buttonClick = (num) => {\n          let s = scope.val.toFixed(2).toString().replace('.', '');\n          if (num === 'bs') {\n            s = s.substr(0, s.length-1);\n            if (s)\n              scope.val = parseFloat(s) / 100;\n            else\n              scope.val = 0;\n          }\n          else if (num === '0')\n            scope.val *= 10;\n          else\n            scope.val = parseFloat(s + num) / 100;\n        }\n      });\n\n\n    }\n  }\n\n  Katrid.UI.uiKatrid.directive('numpadInput', ['$compile', NumPad]);\n\n})();\n","(function() {\n\n  Katrid.UI.uiKatrid\n  .directive('codeEditor', [function () {\n    return {\n      restrict: 'EA',\n      require: 'ngModel',\n      link: function (scope, elm, attrs, ngModel) {\n\n        let editor;\n\n        require.config({\n          paths: {\n            vs: '/static/web/monaco/min/vs',\n          }\n        });\n\n\n        console.log('set language', attrs.language);\n        require(['vs/editor/editor.main'], function () {\n          editor = monaco.editor.create(elm[0], {\n            value: '',\n            language: attrs.language || 'xml',\n            minimap: {\n              enabled: false,\n            },\n            automaticLayout: true,\n          });\n\n          editor.getModel().onDidChangeContent(evt => {\n            ngModel.$setViewValue(editor.getValue());\n          });\n\n          ngModel.$render = function () {\n            setTimeout(() => {\n              editor.setValue(ngModel.$viewValue);\n            }, 300);\n          };\n\n        });\n\n      }\n    };\n  }]);\n\n})();\n","(function () {\n\n  class Alerts {\n    static success(msg) {\n      return toastr['success'](msg);\n    }\n\n    static warn(msg) {\n      return toastr['warning'](msg);\n    }\n\n    static info(msg) {\n      return toastr['info'](msg);\n    }\n\n    static error(msg) {\n      return toastr['error'](msg);\n    }\n  }\n\n  class WaitDialog {\n    static show() {\n      $('#loading-msg').show();\n    }\n\n    static hide() {\n      $('#loading-msg').hide();\n    }\n  }\n\n  class Dialog extends Katrid.UI.Views.BaseView {\n    constructor(scope, options) {\n      super(scope);\n      this.templateUrl = 'dialog.base';\n      this.scope.isDialog = true;\n    }\n\n    render() {\n      return $(Katrid.app.getTemplate(this.templateUrl).replace('<!-- replace-content -->', this.content));\n    }\n\n    show() {\n      if (!this.el) {\n        this.el = $(this.render());\n        this.root = this.el.find('.modal-dialog-body');\n        this.el.find('form').first().addClass('row');\n        this.$compile(this.el)(this.scope);\n      }\n      this.el.modal('show')\n      .on('shown.bs.modal', () => Katrid.UI.uiKatrid.setFocus(this.el.find('.form-field').first()));\n      return this.el;\n    }\n}\n\n  class Window extends Dialog {\n    constructor(options) {\n      super(options.scope, options);\n      this.scope._ = this.scope.$parent._;\n      this.scope.parentAction = this.scope.action;\n      this.scope.views = {\n        form: options.view\n      };\n      this.dialogTitle = (options && options.title) || Katrid.i18n.gettext('Create: ');\n      this.scope.view = this.view = options.view;\n      this.scope.model = options.model;\n      this.options = options;\n    }\n\n    async createNew(config) {\n      let field = this.options.field;\n\n      this.scope.$setDirty = (field) => {\n        const control = this.scope.form[field];\n        if (control) {\n          control.$setDirty();\n        }\n      };\n\n      let view = this.scope.view;\n      let elScope = this.scope;\n      elScope.views = { form: view };\n      elScope.isDialog = true;\n      let caption = this.dialogTitle;\n\n      this.action = this.scope.action = {\n        scope: this.scope,\n        context: {},\n      };\n      let dataSource = this.action.dataSource = this.scope.dataSource = new Katrid.Data.DataSource(this.scope, this.action);\n\n      let formView = new Katrid.UI.Views.FormView(\n        this.action, this.view, { dialog: true, templateUrl: 'view.form.dialog.modal.jinja2' }\n      );\n      let el = formView.render();\n      let form = el.find('form:first');\n      elScope.root = form;\n      this.action.$element = form;\n\n      form.addClass('row');\n      el.modal('show').on('shown.bs.modal', () => Katrid.UI.uiKatrid.setFocus(el.find('.form-field').first()))\n      .on('hidden.bs.modal', function() {\n        $(this).modal('dispose').remove();\n      });\n\n      this.scope.form = form.controller('form');\n      this.scope.formElement = form;\n      if (field) {\n        let evt = this.scope.$on('saveAndClose', async (event, targetScope, data) => {\n          if (this.scope === targetScope) {\n            if (_.isArray(data) && data.length) {\n              data = await this.scope.$parent.model.getFieldChoices(field.name, null, {ids: data});\n              let vals = {};\n              let res = data.items[0];\n              vals[field.name] = res;\n              this.scope.$parent.action.dataSource.setValues(vals);\n              if (this.options.sel)\n                this.options.sel.select2('data', { id: res[0], text: res[1] });\n            }\n            // unhook event\n            evt();\n          }\n        });\n      }\n\n      return new Promise(async (resolve, reject) => {\n        setTimeout(async () => {\n          // check if there's a creation name\n          let kwargs, defaultValues;\n          if (config) {\n            if (config.creationName)\n              kwargs = { creation_name: name };\n            if (config.defaultValues)\n              defaultValues = config.defaultValues;\n          }\n          await dataSource.insert(true, defaultValues, kwargs);\n          this.scope.$apply();\n          resolve(el);\n        });\n\n      });\n\n    };\n  }\n\n  Katrid.UI.Dialogs = {\n    Alerts,\n    WaitDialog,\n    Dialog,\n    Window\n  };\n\n})();\n","(function () {\n\n  Katrid.UI.uiKatrid.directive(\"foreignkey\", ['$compile', '$controller', ($compile, $controller) => ({\n    restrict: \"A\",\n    require: \"ngModel\",\n    link(scope, el, attrs, controller) {\n      let serviceName;\n      let sel = el;\n      let _shown = false;\n      const field = scope.view.fields[attrs.name];\n      el.addClass(\"form-field\");\n      if (attrs.serviceName) serviceName = attrs;\n      else if (scope.action && scope.action.model) serviceName = scope.action.model.name;\n      else serviceName = attrs.foreignkey;\n      const newItem = function () {\n      };\n      const newEditItem = function () {\n      };\n      let _timeout = null;\n\n      let config = {\n        allowClear: true,\n        query(query) {\n          // evaluate domain attribute\n          let domain = field.domain;\n          if (domain && _.isString(domain))\n            domain = scope.$eval(domain);\n\n          // make params\n          let data = {\n            args: [query.term],\n            kwargs: {\n              count: 1,\n              page: query.page,\n              domain: domain,\n              name_fields: attrs.nameFields && attrs.nameFields.split(\",\") || null\n            }\n          };\n          const f = () => {\n            let svc;\n            if (scope.model) svc = scope.model.getFieldChoices(field.name, query.term, data.kwargs);\n            else svc = new Katrid.Services.Model(field.model).searchName(data);\n            svc.then(res => {\n              let data = res.items;\n              const r = data.map(item => ({\n                id: item[0],\n                text: item[1]\n              }));\n              const more = query.page * Katrid.settings.services.choicesPageLimit < res.count;\n              if (!multiple && !more) {\n                let msg;\n                const v = sel.data(\"select2\").search.val();\n                if ((attrs.allowCreate && attrs.allowCreate !== \"false\" || attrs.allowCreate == null) && v) {\n                  msg = Katrid.i18n.gettext('Create <i>\"%s\"</i>...');\n                  r.push({\n                    id: newItem,\n                    text: msg\n                  })\n                }\n              }\n              return query.callback({\n                results: r,\n                more: more\n              })\n            })\n          };\n          if (_timeout) clearTimeout(_timeout);\n          _timeout = setTimeout(f, 400)\n        },\n        ajax: {\n          url: `/api/rpc/${serviceName}/get_field_choices/`,\n          contentType: \"application/json\",\n          dataType: \"json\",\n          type: \"POST\"\n        },\n        formatSelection(val) {\n          if (val.id === newItem || val.id === newEditItem) return Katrid.i18n.gettext(\"Creating...\");\n          return val.text\n        },\n        formatResult(state) {\n          const s = sel.data(\"select2\").search.val();\n          if (state.id === newItem) {\n            state.str = s;\n            return `<strong>${sprintf(state.text, s)}</strong>`\n          } else if (state.id === newEditItem) {\n            state.str = s;\n            return `<strong>${sprintf(state.text, s)}</strong>`\n          }\n          return state.text\n        },\n        initSelection(el, cb) {\n          let v = controller.$modelValue;\n          if (multiple) {\n            v = v.map(obj => ({\n              id: obj[0],\n              text: obj[1]\n            }));\n            return cb(v)\n          } else if (_.isArray(v)) {\n            return cb({\n              id: v[0],\n              text: v[1]\n            })\n          }\n        }\n      };\n\n      let allowCreateEdit = attrs.noCreateEdit;\n      allowCreateEdit = _.isUndefined(allowCreateEdit) || !Boolean(allowCreateEdit);\n\n      let {\n        multiple: multiple\n      } = attrs;\n      if (multiple) {\n        config[\"multiple\"] = true\n      }\n      sel = sel.select2(config);\n\n      let createNew = () => {\n        sel.select2('close');\n        let service = new Katrid.Services.Model(field.model);\n        return service.getViewInfo({\n          view_type: \"form\"\n        }).then(function (res) {\n          let title = _.sprintf(Katrid.i18n.gettext('Create: %(title)s'), {title: field.caption});\n          let options = {\n            scope: scope.$new(true),\n            $controller: $controller,\n            sel: sel, field: field,\n            title: title,\n            view: res,\n            model: service,\n            action: scope.action,\n          };\n          let wnd = new Katrid.UI.Dialogs.Window(options);\n          wnd.createNew();\n        })\n      };\n\n      if (allowCreateEdit)\n        sel.parent().find('div.select2-container>div.select2-drop')\n        .append(`<div style=\"padding: 4px;\"><button type=\"button\" class=\"btn btn-link btn-sm\">${Katrid.i18n.gettext('Create New...')}</button></div>`)\n        .find('button').click(createNew);\n\n\n      sel.on(\"change\", async e => {\n        let v = e.added;\n        if (v && v.id === newItem) {\n          let service = new Katrid.Services.Model(field.model);\n          try {\n            let res = await service.createName(v.str);\n            let vals = {};\n            vals[field.name] = res;\n            scope.dataSource.setValues(vals);\n            sel.select2('data', {id: res[0], text: res[1]});\n          } catch (err) {\n            let res = await service.getViewInfo({\n              view_type: \"form\"\n            });\n            let title = _.sprintf(Katrid.i18n.gettext('Create: %(title)s'), {title: field.caption});\n            let options = {\n              scope: scope.$new(true),\n              $controller: $controller,\n              sel: sel, field: field,\n              title: title,\n              view: res,\n              model: service,\n              action: scope.action,\n            };\n            let wnd = new Katrid.UI.Dialogs.Window(options);\n            wnd.createNew({creationName: v.str});\n            sel.select2('data', null);\n          }\n        } else if (v && v.id === newEditItem) {\n        } else if (multiple && e.val.length) {\n          return controller.$setViewValue(e.val)\n        } else {\n          controller.$setDirty();\n          if (v) {\n            return controller.$setViewValue([v.id, v.text])\n          } else {\n            return controller.$setViewValue(null)\n          }\n        }\n      }).on(\"select2-open\", () => {\n        if (!_shown) {\n          _shown = true;\n          let parentModal = el.closest(\"div.modal\");\n          if (parentModal.length) parentModal.on(\"hide.bs.modal\", () => sel.select2(\"destroy\"))\n        }\n      });\n      controller.$parsers.push(value => {\n        if (value) {\n          if (_.isArray(value)) return value;\n          else if (_.isObject(value)) return [value.id, value.text];\n          else return value\n        }\n        return null\n      });\n      if (!multiple) scope.$watch(attrs.ngModel, (newValue, oldValue) => sel.select2(\"val\", newValue));\n      return controller.$render = function () {\n        if (multiple) {\n          if (controller.$viewValue) {\n            const v = Array.from(controller.$viewValue).map(obj => obj[0]);\n            sel.select2(\"val\", v)\n          }\n        }\n        if (controller.$viewValue) {\n          return sel.select2(\"val\", controller.$viewValue[0])\n        } else {\n          return sel.select2(\"val\", null)\n        }\n      }\n    }\n  })]);\n\n\n  Katrid.UI.uiKatrid.filter('m2m', () =>\n    function (input) {\n      if (_.isArray(input))\n        return input.map((obj) => obj ? obj[1] : null).join(', ');\n    }\n  );\n\n\n})();\n","(function() {\n\n  Katrid.UI.uiKatrid.directive('statusField', ['$compile', ($compile) =>\n    ({\n      restrict: 'A',\n      priority: 1,\n      replace: true,\n      link(scope, element, attrs, controller) {\n        const field = scope.view.fields[attrs.name];\n        scope.choices = field.choices;\n        if (!attrs.readonly) {\n          scope.itemClick = () => console.log('status field item click');\n        }\n        element.closest('header').prepend(element);\n      },\n      template(element, attrs) {\n        return sprintf(Katrid.app.$templateCache.get('view.field.StatusField'), { fieldName: attrs.name });\n      }\n    })\n\n  ]);\n\n})();\n","(function() {\n\n  Katrid.UI.uiKatrid.directive('sortableField', ['$compile', '$timeout', ($compile, $timeout) =>\n    ({\n      restrict: 'E',\n      require: 'ngModel',\n      replace: true,\n      scope: {},\n      link: {\n        post: function (scope, el, attrs) {\n          let tbl = el.closest('tbody');\n          let fixHelperModified = function (e, tr) {\n              let $originals = tr.children();\n              let $helper = tr.clone();\n              $helper.children().each(function (index) {\n                $(this).width($originals.eq(index).width())\n              });\n              return $helper;\n            },\n            updateIndex = function (e, ui) {\n              $('td.list-column-sortable', ui.item.parent()).each(function (i) {\n                // $(this).html(i + 1);\n              });\n            };\n\n          tbl.sortable({\n            helper: fixHelperModified,\n            stop: updateIndex\n          }).disableSelection();\n        }\n      },\n      template(element, attrs) {\n        return sprintf(Katrid.$templateCache.get('view.field.SortableField'), { fieldName: attrs.name });\n      }\n    })\n\n  ]);\n\n})();\n","/**\n * jQuery number plug-in 2.1.3\n * Copyright 2012, Digital Fusion\n * Licensed under the MIT license.\n * http://opensource.teamdf.com/license/\n *\n * A jQuery plugin which implements a permutation of phpjs.org's number_format to provide\n * simple number formatting, insertion, and as-you-type masking of a number.\n *\n * @author\tSam Sehnert\n * @docs\thttp://www.teamdf.com/web/jquery-number-format-redux/196/\n */\n(function($){\n\n\t\"use strict\";\n\n\t/**\n\t * Method for selecting a range of characters in an input/textarea.\n\t *\n\t * @param int rangeStart\t\t\t: Where we want the selection to start.\n\t * @param int rangeEnd\t\t\t\t: Where we want the selection to end.\n\t *\n\t * @return void;\n\t */\n\tfunction setSelectionRange( rangeStart, rangeEnd )\n\t{\n\t\t// Check which way we need to define the text range.\n\t\tif( this.createTextRange )\n\t\t{\n\t\t\tvar range = this.createTextRange();\n\t\t\t\trange.collapse( true );\n\t\t\t\trange.moveStart( 'character',\trangeStart );\n\t\t\t\trange.moveEnd( 'character',\t\trangeEnd-rangeStart );\n\t\t\t\trange.select();\n\t\t}\n\n\t\t// Alternate setSelectionRange method for supporting browsers.\n\t\telse if( this.setSelectionRange )\n\t\t{\n\t\t\tthis.focus();\n\t\t\tthis.setSelectionRange( rangeStart, rangeEnd );\n\t\t}\n\t}\n\n\t/**\n\t * Get the selection position for the given part.\n\t *\n\t * @param string part\t\t\t: Options, 'Start' or 'End'. The selection position to get.\n\t *\n\t * @return int : The index position of the selection part.\n\t */\n\tfunction getSelection( part )\n\t{\n\t\tvar pos\t= this.value.length;\n\n\t\t// Work out the selection part.\n\t\tpart = ( part.toLowerCase() == 'start' ? 'Start' : 'End' );\n\n\t\tif( document.selection ){\n\t\t\t// The current selection\n\t\t\tvar range = document.selection.createRange(), stored_range, selectionStart, selectionEnd;\n\t\t\t// We'll use this as a 'dummy'\n\t\t\tstored_range = range.duplicate();\n\t\t\t// Select all text\n\t\t\t//stored_range.moveToElementText( this );\n\t\t\tstored_range.expand('textedit');\n\t\t\t// Now move 'dummy' end point to end point of original range\n\t\t\tstored_range.setEndPoint( 'EndToEnd', range );\n\t\t\t// Now we can calculate start and end points\n\t\t\tselectionStart = stored_range.text.length - range.text.length;\n\t\t\tselectionEnd = selectionStart + range.text.length;\n\t\t\treturn part == 'Start' ? selectionStart : selectionEnd;\n\t\t}\n\n\t\telse if(typeof(this['selection'+part])!=\"undefined\")\n\t\t{\n\t\t \tpos = this['selection'+part];\n\t\t}\n\t\treturn pos;\n\t}\n\n\t/**\n\t * Substitutions for keydown keycodes.\n\t * Allows conversion from e.which to ascii characters.\n\t */\n\tvar _keydown = {\n\t\tcodes : {\n\t\t\t188 : 44,\n      110 : 44,\n      108 : 44,\n\t\t\t109 : 45,\n\t\t\t190 : 46,\n\t\t\t191 : 47,\n\t\t\t192 : 96,\n\t\t\t220 : 92,\n\t\t\t222 : 39,\n\t\t\t221 : 93,\n\t\t\t219 : 91,\n\t\t\t173 : 45,\n\t\t\t187 : 61, //IE Key codes\n\t\t\t186 : 59, //IE Key codes\n\t\t\t189 : 45, //IE Key codes\n        },\n        shifts : {\n\t\t\t96 : \"~\",\n\t\t\t49 : \"!\",\n\t\t\t50 : \"@\",\n\t\t\t51 : \"#\",\n\t\t\t52 : \"$\",\n\t\t\t53 : \"%\",\n\t\t\t54 : \"^\",\n\t\t\t55 : \"&\",\n\t\t\t56 : \"*\",\n\t\t\t57 : \"(\",\n\t\t\t48 : \")\",\n\t\t\t45 : \"_\",\n\t\t\t61 : \"+\",\n\t\t\t91 : \"{\",\n\t\t\t93 : \"}\",\n\t\t\t92 : \"|\",\n\t\t\t59 : \":\",\n\t\t\t39 : \"\\\"\",\n\t\t\t44 : \"<\",\n\t\t\t46 : \">\",\n\t\t\t47 : \"?\"\n        }\n    };\n\n\t/**\n\t * jQuery number formatter plugin. This will allow you to format numbers on an element.\n\t *\n\t * @params proxied for format_number method.\n\t *\n\t * @return : The jQuery collection the method was called with.\n\t */\n\t$.fn.number = function( number, decimals, dec_point, thousands_sep ){\n\n\t    // Enter the default thousands separator, and the decimal placeholder.\n\t    thousands_sep\t= (typeof thousands_sep === 'undefined') ? ',' : thousands_sep;\n\t    dec_point\t\t= (typeof dec_point === 'undefined') ? '.' : dec_point;\n\t    decimals\t\t= (typeof decimals === 'undefined' ) ? 0 : decimals;\n\n\t    // Work out the unicode character for the decimal placeholder.\n\t    var u_dec\t\t\t= ('\\\\u'+('0000'+(dec_point.charCodeAt(0).toString(16))).slice(-4)),\n\t    \tregex_dec_num\t= new RegExp('[^-'+u_dec+'0-9]','g'),\n\t    \tregex_dec\t\t= new RegExp(u_dec,'g');\n\n\t    // If we've specified to take the number from the target element,\n\t    // we loop over the collection, and get the number.\n\t    if( number === true )\n\t    {\n\t    \t// If this element is a number, then we add a keyup\n\t    \tif( this.is('input:text') )\n\t    \t{\n\t    \t\t// Return the jquery collection.\n\t    \t\treturn this.on({\n\n\t    \t\t\t/**\n\t    \t\t\t * Handles keyup events, re-formatting numbers.\n\t    \t\t\t *\n\t    \t\t\t * @param object e\t\t\t: the keyup event object.s\n\t    \t\t\t *\n\t    \t\t\t * @return void;\n\t    \t\t\t */\n\t    \t\t\t'keydown.format' : function(e){\n\n\n\t    \t\t\t\t// Define variables used in the code below.\n\t    \t\t\t\tvar $this\t= $(this),\n\t    \t\t\t\t\tdata\t= $this.data('numFormat'),\n\t    \t\t\t\t\tcode\t= (e.keyCode ? e.keyCode : e.which),\n\t\t\t\t\t\t\tchara\t= '', //unescape(e.originalEvent.keyIdentifier.replace('U+','%u')),\n\t    \t\t\t\t\tstart\t= getSelection.apply(this,['start']),\n\t    \t\t\t\t\tend\t\t= getSelection.apply(this,['end']),\n\t    \t\t\t\t\tval\t\t= '',\n\t    \t\t\t\t\tsetPos\t= false;\n\n              if (e.key === '-') {\n              \tif ($this.val() === 0)\n              \t\tdata.negative = true;\n              \telse {\n              \t  data.negative = false;\n                  if (this.value.includes('-'))\n                    this.value = this.value.substr(1, this.value.length - 1);\n                  else\n                    this.value = '-' + this.value;\n                }\n                $this.val(this.value);\n                e.preventDefault();\n                return;\n              }\n\n\t    \t\t\t\t// Webkit (Chrome & Safari) on windows screws up the keyIdentifier detection\n\t    \t\t\t\t// for numpad characters. I've disabled this for now, because while keyCode munging\n\t    \t\t\t\t// below is hackish and ugly, it actually works cross browser & platform.\n\n//\t    \t\t\t\tif( typeof e.originalEvent.keyIdentifier !== 'undefined' )\n//\t    \t\t\t\t{\n//\t    \t\t\t\t\tchara = unescape(e.originalEvent.keyIdentifier.replace('U+','%u'));\n//\t    \t\t\t\t}\n//\t    \t\t\t\telse\n//\t    \t\t\t\t{\n\t    \t\t\t\t\tif (_keydown.codes.hasOwnProperty(code)) {\n\t\t\t\t\t            code = _keydown.codes[code];\n\t\t\t\t\t        }\n\t\t\t\t\t        if (!e.shiftKey && (code >= 65 && code <= 90)){\n\t\t\t\t\t        \tcode += 32;\n\t\t\t\t\t        } else if (!e.shiftKey && (code >= 69 && code <= 105)){\n\t\t\t\t\t        \tcode -= 48;\n\t\t\t\t\t        } else if (e.shiftKey && _keydown.shifts.hasOwnProperty(code)){\n\t\t\t\t\t            //get shifted keyCode value\n\t\t\t\t\t            chara = _keydown.shifts[code];\n\t\t\t\t\t        }\n\n\t\t\t\t\t        if( chara == '' ) chara = String.fromCharCode(code);\n//\t    \t\t\t\t}\n\n\n\n\t    \t\t\t\t// Stop executing if the user didn't type a number key, a decimal character, or backspace.\n\t    \t\t\t\tif( code !== 8 && chara != dec_point && !chara.match(/[0-9]/) )\n\t    \t\t\t\t{\n\t    \t\t\t\t\t// We need the original keycode now...\n\t    \t\t\t\t\tvar key = (e.keyCode ? e.keyCode : e.which);\n\t    \t\t\t\t\tif( // Allow control keys to go through... (delete, etc)\n\t    \t\t\t\t\t\tkey == 46 || key == 8 || key == 9 || key == 27 || key == 13 ||\n\t    \t\t\t\t\t\t// Allow: Ctrl+A, Ctrl+R\n\t    \t\t\t\t\t\t( (key == 65 || key == 82 ) && ( e.ctrlKey || e.metaKey ) === true ) ||\n\t    \t\t\t\t\t\t// Allow: Ctrl+V, Ctrl+C\n\t    \t\t\t\t\t\t( (key == 86 || key == 67 ) && ( e.ctrlKey || e.metaKey ) === true ) ||\n\t    \t\t\t\t\t\t// Allow: home, end, left, right\n\t    \t\t\t\t\t\t( (key >= 35 && key <= 39) )\n\t\t\t\t\t\t\t){\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// But prevent all other keys.\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn false;\n\t    \t\t\t\t}\n\n\t    \t\t\t\t// The whole lot has been selected, or if the field is empty...\n\t    \t\t\t\tif( start == 0 && end == this.value.length || $this.val() == 0 )\n\t    \t\t\t\t{\n\t    \t\t\t\t\tif( code === 8 )\n\t    \t\t\t\t\t{\n\t\t    \t\t\t\t\t// Blank out the field, but only if the data object has already been instanciated.\n\t    \t\t\t\t\t\tstart = end = 1;\n\t    \t\t\t\t\t\tthis.value = '';\n\n\t    \t\t\t\t\t\t// Reset the cursor position.\n\t\t    \t\t\t\t\tdata.init = (decimals>0?-1:0);\n\t\t    \t\t\t\t\tdata.c = (decimals>0?-(decimals+1):0);\n\t\t    \t\t\t\t\tsetSelectionRange.apply(this, [0,0]);\n\t\t    \t\t\t\t}\n\t\t    \t\t\t\telse if( chara === dec_point )\n\t\t    \t\t\t\t{\n\t\t    \t\t\t\t\tstart = end = 1;\n\t\t    \t\t\t\t\tthis.value = '0'+ dec_point + (new Array(decimals+1).join('0'));\n\n\t\t    \t\t\t\t\t// Reset the cursor position.\n\t\t    \t\t\t\t\tdata.init = (decimals>0?1:0);\n\t\t    \t\t\t\t\tdata.c = (decimals>0?-(decimals+1):0);\n\t\t    \t\t\t\t}\n\t\t    \t\t\t\telse if( this.value.length === 0 )\n\t\t    \t\t\t\t{\n\t\t    \t\t\t\t\t// Reset the cursor position.\n\t\t    \t\t\t\t\tdata.init = (decimals>0?-1:0);\n\t\t    \t\t\t\t\tdata.c = (decimals>0?-(decimals):0);\n\t\t    \t\t\t\t}\n\t    \t\t\t\t}\n\n\t    \t\t\t\t// Otherwise, we need to reset the caret position\n\t    \t\t\t\t// based on the users selection.\n\t    \t\t\t\telse\n\t    \t\t\t\t{\n\t    \t\t\t\t\tdata.c = end-this.value.length;\n\t    \t\t\t\t}\n\n\t    \t\t\t\t// If the start position is before the decimal point,\n\t    \t\t\t\t// and the user has typed a decimal point, we need to move the caret\n\t    \t\t\t\t// past the decimal place.\n\t    \t\t\t\tif( decimals > 0 && chara == dec_point && start == this.value.length-decimals-1 )\n\t    \t\t\t\t{\n\t    \t\t\t\t\tdata.c++;\n\t    \t\t\t\t\tdata.init = Math.max(0,data.init);\n\t    \t\t\t\t\te.preventDefault();\n\n\t    \t\t\t\t\t// Set the selection position.\n\t    \t\t\t\t\tsetPos = this.value.length+data.c;\n\t    \t\t\t\t}\n\n\t    \t\t\t\t// If the user is just typing the decimal place,\n\t    \t\t\t\t// we simply ignore it.\n\t    \t\t\t\telse if( chara == dec_point )\n\t    \t\t\t\t{\n\t    \t\t\t\t\tdata.init = Math.max(0,data.init);\n\t    \t\t\t\t\te.preventDefault();\n\t    \t\t\t\t}\n\n\t    \t\t\t\t// If hitting the delete key, and the cursor is behind a decimal place,\n\t    \t\t\t\t// we simply move the cursor to the other side of the decimal place.\n\t    \t\t\t\telse if( decimals > 0 && code == 8 && start == this.value.length-decimals )\n\t    \t\t\t\t{\n\t    \t\t\t\t\te.preventDefault();\n\t    \t\t\t\t\tdata.c--;\n\n\t    \t\t\t\t\t// Set the selection position.\n\t    \t\t\t\t\tsetPos = this.value.length+data.c;\n\t    \t\t\t\t}\n\n\t    \t\t\t\t// If hitting the delete key, and the cursor is to the right of the decimal\n\t    \t\t\t\t// (but not directly to the right) we replace the character preceeding the\n\t    \t\t\t\t// caret with a 0.\n\t    \t\t\t\telse if( decimals > 0 && code == 8 && start > this.value.length-decimals )\n\t    \t\t\t\t{\n\t    \t\t\t\t\tif( this.value === '' ) return;\n\n\t    \t\t\t\t\t// If the character preceeding is not already a 0,\n\t    \t\t\t\t\t// replace it with one.\n\t    \t\t\t\t\tif( this.value.slice(start-1, start) != '0' )\n\t    \t\t\t\t\t{\n\t    \t\t\t\t\t\tval = this.value.slice(0, start-1) + '0' + this.value.slice(start);\n\t    \t\t\t\t\t\t$this.val(val.replace(regex_dec_num,'').replace(regex_dec,dec_point));\n\t    \t\t\t\t\t}\n\n\t    \t\t\t\t\te.preventDefault();\n\t    \t\t\t\t\tdata.c--;\n\n\t    \t\t\t\t\t// Set the selection position.\n\t    \t\t\t\t\tsetPos = this.value.length+data.c;\n\t    \t\t\t\t}\n\n\t    \t\t\t\t// If the delete key was pressed, and the character immediately\n\t    \t\t\t\t// before the caret is a thousands_separator character, simply\n\t    \t\t\t\t// step over it.\n\t    \t\t\t\telse if( code == 8 && this.value.slice(start-1, start) == thousands_sep )\n\t    \t\t\t\t{\n\t    \t\t\t\t\te.preventDefault();\n\t    \t\t\t\t\tdata.c--;\n\n\t    \t\t\t\t\t// Set the selection position.\n\t    \t\t\t\t\tsetPos = this.value.length+data.c;\n\t    \t\t\t\t}\n\n\t    \t\t\t\t// If the caret is to the right of the decimal place, and the user is entering a\n\t    \t\t\t\t// number, remove the following character before putting in the new one.\n\t    \t\t\t\telse if(\n\t    \t\t\t\t\tdecimals > 0 &&\n\t    \t\t\t\t\tstart == end &&\n\t    \t\t\t\t\tthis.value.length > decimals+1 &&\n\t    \t\t\t\t\tstart > this.value.length-decimals-1 && isFinite(+chara) &&\n\t\t    \t\t\t\t!e.metaKey && !e.ctrlKey && !e.altKey && chara.length === 1\n\t    \t\t\t\t)\n\t    \t\t\t\t{\n\t    \t\t\t\t\t// If the character preceeding is not already a 0,\n\t    \t\t\t\t\t// replace it with one.\n\t    \t\t\t\t\tif( end === this.value.length )\n\t    \t\t\t\t\t{\n\t    \t\t\t\t\t\tval = this.value.slice(0, start-1);\n\t    \t\t\t\t\t}\n\t    \t\t\t\t\telse\n\t    \t\t\t\t\t{\n\t    \t\t\t\t\t\tval = this.value.slice(0, start)+this.value.slice(start+1);\n\t    \t\t\t\t\t}\n\n\t    \t\t\t\t\t// Reset the position.\n\t    \t\t\t\t\tthis.value = val;\n\t    \t\t\t\t\tsetPos = start;\n\t    \t\t\t\t}\n\n\t    \t\t\t\tif (setPos === false && code === 44 && chara === dec_point)\n\t    \t\t\t\t\tsetPos = this.value.indexOf(dec_point) + 1;\n\n\t    \t\t\t\t// If we need to re-position the characters.\n\t    \t\t\t\tif( setPos !== false )\n\t    \t\t\t\t{\n\t    \t\t\t\t\tsetSelectionRange.apply(this, [setPos, setPos]);\n\t    \t\t\t\t}\n\n\t    \t\t\t\t// Store the data on the element.\n\t    \t\t\t\t$this.data('numFormat', data);\n\n\t    \t\t\t},\n\n\t    \t\t\t/**\n\t    \t\t\t * Handles keyup events, re-formatting numbers.\n\t    \t\t\t *\n\t    \t\t\t * @param object e\t\t\t: the keyup event object.s\n\t    \t\t\t *\n\t    \t\t\t * @return void;\n\t    \t\t\t */\n\t    \t\t\t'keyup.format' : function(e){\n\n\t    \t\t\t\t// Store these variables for use below.\n\t    \t\t\t\tvar $this\t= $(this),\n\t    \t\t\t\t\tdata\t= $this.data('numFormat'),\n\t    \t\t\t\t\tcode\t= (e.keyCode ? e.keyCode : e.which),\n\t    \t\t\t\t\tstart\t= getSelection.apply(this,['start']),\n\t    \t\t\t\t\tsetPos;\n\n\t    \t\t\t\t// Stop executing if the user didn't type a number key, a decimal, or a comma.\n\t    \t\t\t\tif( this.value === '' || (code < 48 || code > 57) && (code < 96 || code > 105 ) && code !== 8 )\n\t    \t\t\t\t  return;\n\n\t    \t\t\t\t// Re-format the textarea.\n\t    \t\t\t\t$this.val($this.val());\n\n\t    \t\t\t\tif( decimals > 0 )\n\t    \t\t\t\t{\n\t\t    \t\t\t\t// If we haven't marked this item as 'initialised'\n\t\t    \t\t\t\t// then do so now. It means we should place the caret just\n\t\t    \t\t\t\t// before the decimal. This will never be un-initialised before\n\t\t    \t\t\t\t// the decimal character itself is entered.\n\t\t    \t\t\t\tif( data.init < 1 )\n\t\t    \t\t\t\t{\n\t\t    \t\t\t\t\tstart\t\t= this.value.length-decimals-( data.init < 0 ? 1 : 0 );\n\t\t    \t\t\t\t\tdata.c\t\t= start-this.value.length;\n\t\t    \t\t\t\t\tdata.init\t= 1;\n\n\t\t    \t\t\t\t\t$this.data('numFormat', data);\n\t\t    \t\t\t\t}\n\n\t\t    \t\t\t\t// Increase the cursor position if the caret is to the right\n\t\t    \t\t\t\t// of the decimal place, and the character pressed isn't the delete key.\n\t\t    \t\t\t\telse if( start > this.value.length-decimals && code != 8 )\n\t\t    \t\t\t\t{\n\t\t    \t\t\t\t\tdata.c++;\n\n\t\t    \t\t\t\t\t// Store the data, now that it's changed.\n\t\t    \t\t\t\t\t$this.data('numFormat', data);\n\t\t    \t\t\t\t}\n\t    \t\t\t\t}\n\n\t    \t\t\t\t//console.log( 'Setting pos: ', start, decimals, this.value.length + data.c, this.value.length, data.c );\n\n\t    \t\t\t\t// Set the selection position.\n\t    \t\t\t\tsetPos = this.value.length+data.c;\n\t    \t\t\t\tif (((this.value.length - setPos) === data.decimals) && (String.fromCharCode(code) !== data.dec_point)) {\n                setPos -= 1;\n                console.log('set pos', data.dec_point, code, String.fromCharCode(code));\n              }\n\t    \t\t\t\tsetSelectionRange.apply(this, [setPos, setPos]);\n\t    \t\t\t},\n\n\t    \t\t\t/**\n\t    \t\t\t * Reformat when pasting into the field.\n\t    \t\t\t *\n\t    \t\t\t * @param object e \t\t: jQuery event object.\n\t    \t\t\t *\n\t    \t\t\t * @return false : prevent default action.\n\t    \t\t\t */\n\t    \t\t\t'paste.format' : function(e){\n\n\t    \t\t\t\t// Defint $this. It's used twice!.\n\t    \t\t\t\tvar $this\t\t= $(this),\n\t    \t\t\t\t\toriginal\t= e.originalEvent,\n\t    \t\t\t\t\tval\t\t= null;\n\n\t\t\t\t\t\t// Get the text content stream.\n\t\t\t\t\t\tif (window.clipboardData && window.clipboardData.getData) { // IE\n\t\t\t\t\t\t\tval = window.clipboardData.getData('Text');\n\t\t\t\t\t\t} else if (original.clipboardData && original.clipboardData.getData) {\n\t\t\t\t\t\t\tval = original.clipboardData.getData('text/plain');\n\t\t\t\t\t\t}\n\n\t    \t\t\t\t// Do the reformat operation.\n\t    \t\t\t\t$this.val(val);\n\n\t    \t\t\t\t// Stop the actual content from being pasted.\n\t    \t\t\t\te.preventDefault();\n\t    \t\t\t\treturn false;\n\t    \t\t\t}\n\n\t    \t\t})\n\n\t    \t\t// Loop each element (which isn't blank) and do the format.\n    \t\t\t.each(function(){\n\n    \t\t\t\tvar $this = $(this).data('numFormat',{\n    \t\t\t\t\tc\t\t\t\t: -(decimals+1),\n    \t\t\t\t\tdecimals\t\t: decimals,\n    \t\t\t\t\tthousands_sep\t: thousands_sep,\n    \t\t\t\t\tdec_point\t\t: dec_point,\n    \t\t\t\t\tregex_dec_num\t: regex_dec_num,\n    \t\t\t\t\tregex_dec\t\t: regex_dec,\n    \t\t\t\t\tinit\t\t\t: false\n    \t\t\t\t});\n\n    \t\t\t\t// Return if the element is empty.\n    \t\t\t\tif( this.value === '' ) return;\n\n    \t\t\t\t// Otherwise... format!!\n    \t\t\t\t$this.val($this.val());\n    \t\t\t});\n\t    \t}\n\t    \telse\n\t    \t{\n\t\t    \t// return the collection.\n\t\t    \treturn this.each(function(){\n\t\t    \t\tvar $this = $(this), num = +$this.text().replace(regex_dec_num,'').replace(regex_dec,'.');\n\t\t    \t\t$this.number( !isFinite(num) ? 0 : +num, decimals, dec_point, thousands_sep );\n\t\t    \t});\n\t    \t}\n\t    }\n\n\t    // Add this number to the element as text.\n\t    return this.text( $.number.apply(window,arguments) );\n\t};\n\n\t//\n\t// Create .val() hooks to get and set formatted numbers in inputs.\n\t//\n\n\t// We check if any hooks already exist, and cache\n\t// them in case we need to re-use them later on.\n\tvar origHookGet = null, origHookSet = null;\n\n\t// Check if a text valHook already exists.\n\tif( $.isPlainObject( $.valHooks.text ) )\n\t{\n\t    // Preserve the original valhook function\n\t    // we'll call this for values we're not\n\t    // explicitly handling.\n\t    if( $.isFunction( $.valHooks.text.get ) ) origHookGet = $.valHooks.text.get;\n\t    if( $.isFunction( $.valHooks.text.set ) ) origHookSet = $.valHooks.text.set;\n\t}\n\telse\n\t{\n\t    // Define an object for the new valhook.\n\t    $.valHooks.text = {};\n\t}\n\n\t/**\n\t * Define the valHook to return normalised field data against an input\n\t * which has been tagged by the number formatter.\n\t *\n\t * @param object el\t\t\t: The raw DOM element that we're getting the value from.\n\t *\n\t * @return mixed : Returns the value that was written to the element as a\n\t *\t\t\t\t   javascript number, or undefined to let jQuery handle it normally.\n\t */\n\t$.valHooks.text.get = function( el ){\n\n\t\t// Get the element, and its data.\n\t\tvar $this\t= $(el), num,\n\t\t\tdata\t= $this.data('numFormat');\n\n        // Does this element have our data field?\n        if( !data )\n        {\n            // Check if the valhook function already existed\n            if( $.isFunction( origHookGet ) )\n            {\n                // There was, so go ahead and call it\n                return origHookGet(el);\n            }\n            else\n            {\n                // No previous function, return undefined to have jQuery\n                // take care of retrieving the value\n                return undefined;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Remove formatting, and return as number.\n\t\t\tif( el.value === '' ) return '';\n\n\t\t\t// Convert to a number.\n\t\t\tnum = +(el.value\n\t\t\t\t.replace( data.regex_dec_num, '' )\n\t\t\t\t.replace( data.regex_dec, '.' ));\n\n\t\t\t// If we've got a finite number, return it.\n\t\t\t// Otherwise, simply return 0.\n\t\t\t// Return as a string... thats what we're\n\t\t\t// used to with .val()\n\t\t\treturn ''+( isFinite( num ) ? num : 0 );\n\t\t}\n\t};\n\n\t/**\n\t * A valhook which formats a number when run against an input\n\t * which has been tagged by the number formatter.\n\t *\n\t * @param object el\t\t: The raw DOM element (input element).\n\t * @param float\t\t\t: The number to set into the value field.\n\t *\n\t * @return mixed : Returns the value that was written to the element,\n\t *\t\t\t\t   or undefined to let jQuery handle it normally.\n\t */\n\t$.valHooks.text.set = function( el, val )\n\t{\n\t\t// Get the element, and its data.\n\t\tvar $this\t= $(el),\n\t\t\tdata\t= $this.data('numFormat');\n\n\t\t// Does this element have our data field?\n\t\tif( !data )\n\t\t{\n\n\t\t    // Check if the valhook function already exists\n\t\t    if( $.isFunction( origHookSet ) )\n\t\t    {\n\t\t        // There was, so go ahead and call it\n\t\t        return origHookSet(el,val);\n\t\t    }\n\t\t    else\n\t\t    {\n\t\t        // No previous function, return undefined to have jQuery\n\t\t        // take care of retrieving the value\n\t\t        return undefined;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Otherwise, don't worry about other valhooks, just run ours.\n\t\t\treturn el.value = $.number( val, data.decimals, data.dec_point, data.thousands_sep );\n\t\t}\n\t};\n\n\t/**\n\t * The (modified) excellent number formatting method from PHPJS.org.\n\t * http://phpjs.org/functions/number_format/\n\t *\n\t * @modified by Sam Sehnert (teamdf.com)\n\t *\t- don't redefine dec_point, thousands_sep... just overwrite with defaults.\n\t *\t- don't redefine decimals, just overwrite as numeric.\n\t *\t- Generate regex for normalizing pre-formatted numbers.\n\t *\n\t * @param float number\t\t\t: The number you wish to format, or TRUE to use the text contents\n\t *\t\t\t\t\t\t\t\t  of the element as the number. Please note that this won't work for\n\t *\t\t\t\t\t\t\t\t  elements which have child nodes with text content.\n\t * @param int decimals\t\t\t: The number of decimal places that should be displayed. Defaults to 0.\n\t * @param string dec_point\t\t: The character to use as a decimal point. Defaults to '.'.\n\t * @param string thousands_sep\t: The character to use as a thousands separator. Defaults to ','.\n\t *\n\t * @return string : The formatted number as a string.\n\t */\n\t$.number = function( number, decimals, dec_point, thousands_sep ){\n\t\t// Set the default values here, instead so we can use them in the replace below.\n\t\tthousands_sep\t= (typeof thousands_sep === 'undefined') ? ',' : thousands_sep;\n\t\tdec_point\t\t= (typeof dec_point === 'undefined') ? '.' : dec_point;\n\t\tdecimals\t\t= !isFinite(+decimals) ? 0 : Math.abs(decimals);\n\n\t\t// Work out the unicode representation for the decimal place and thousand sep.\n\t\tvar u_dec = ('\\\\u'+('0000'+(dec_point.charCodeAt(0).toString(16))).slice(-4));\n\t\tvar u_sep = ('\\\\u'+('0000'+(thousands_sep.charCodeAt(0).toString(16))).slice(-4));\n\n\t\t// Fix the number, so that it's an actual number.\n\t\tnumber = (number + '')\n\t\t\t.replace('\\.', dec_point) // because the number if passed in as a float (having . as decimal point per definition) we need to replace this with the passed in decimal point character\n\t\t\t.replace(new RegExp(u_sep,'g'),'')\n\t\t\t.replace(new RegExp(u_dec,'g'),'.')\n\t\t\t.replace(new RegExp('[^0-9+\\-Ee.]','g'),'');\n\n\t\tvar n = !isFinite(+number) ? 0 : +number,\n\t\t    s = '',\n\t\t    toFixedFix = function (n, decimals) {\n\t\t        var k = Math.pow(10, decimals);\n\t\t        return '' + Math.round(n * k) / k;\n\t\t    };\n\n\t\t// Fix for IE parseFloat(0.55).toFixed(0) = 0;\n\t\ts = (decimals ? toFixedFix(n, decimals) : '' + Math.round(n)).split('.');\n\t\tif (s[0].length > 3) {\n\t\t    s[0] = s[0].replace(/\\B(?=(?:\\d{3})+(?!\\d))/g, thousands_sep);\n\t\t}\n\t\tif ((s[1] || '').length < decimals) {\n\t\t    s[1] = s[1] || '';\n\t\t    s[1] += new Array(decimals - s[1].length + 1).join('0');\n\t\t}\n\t\treturn s.join(dec_point);\n\t}\n\n})(jQuery);\n","(function() {\n\n  class Total {\n    constructor($filter) {\n      this.restrict = 'E';\n      this.scope = false;\n      this.replace = true;\n      this.$filter = $filter;\n    }\n\n    template(el, attrs) {\n      if (attrs.expr[0] === \"'\")\n        return `<span>${ attrs.expr.substring(1, attrs.expr.length - 1) }</span>`;\n      else\n        return `<span ng-bind=\"total$${attrs.field}|number:2\"></span>`;\n    }\n\n    link(scope, element, attrs, controller) {\n      if (attrs.expr[0] !== \"'\")\n        scope.$watch(`records`, (newValue) => {\n          let total = 0;\n          newValue.map((r) => total += parseFloat(r[attrs.field]));\n          scope['total$' + attrs.field] = total;\n          scope.parent['total$' + scope.fieldName + '$' + attrs.field] = total;\n        });\n    }\n  }\n\n  Katrid.UI.uiKatrid.directive('ngTotal', ['$filter', Total]);\n\n})();\n","(function () {\n\n  class Dashboard extends Katrid.UI.Views.ClientView {\n    async render() {\n      // get the linked view for the client action\n      let model = new Katrid.Services.Model('ir.action.client');\n      let res = await model.rpc('get_view', [this.action.info.id]);\n      if (res.content) {\n        return Katrid.Core.$compile(res.content)(this.action.scope);\n      }\n    }\n  }\n\n  class DashboardComponent extends Katrid.UI.Widgets.Component {\n    constructor($compile) {\n      super();\n      this.$compile = $compile;\n      this.restrict = 'E';\n      this.scope = false;\n    }\n\n    async link(scope, el, attrs, controller) {\n      let dashboardId = attrs.dashboardId;\n    }\n  }\n\n\n  let dataGroup = function (data, groups, total) {\n    let res = [];\n    let row = data[0];\n    let x = [];\n    let grps = {};\n    let c = 0;\n\n    for (let group of groups) {\n      let g = [];\n\n      if (c === 0)\n        g.push(groups[0]);\n\n      for (let row of data) {\n        let v = row[group];\n        if ((c > 0) && !(v in grps)) {\n          g = [v];\n          grps[v] = g;\n          for (let z of x)\n            g.push(0);\n        } else if (c > 0)\n          g = grps[v];\n        if (c > 0)\n          g[x.indexOf(row[groups[0]])] = row[total || 'total'] || 0;\n        else if (!g.includes(v))\n          g.push(v);\n      }\n      if (c === 0) {\n        x = g;\n        grps[groups[0]] = g;\n      } else {\n\n      }\n      c++;\n    }\n    res = Object.values(grps);\n    console.log(res);\n    return res;\n  };\n\n\n  class ChartComponent extends Katrid.UI.Widgets.Component {\n    constructor() {\n      super();\n    }\n\n    async link(scope, el, attrs) {\n      let res, chart, sql;\n\n      // find by a query child element\n      let q = el.find('query');\n      if (q.length) {\n        q.remove();\n        sql = q.text();\n      }\n\n      console.log('init chart');\n\n      let groups;\n      if (attrs.groups)\n        groups = attrs.groups.split(',');\n\n      let observe = async (url) => {\n\n        if (sql)\n          res = await Katrid.Services.Query.executeSql(sql);\n        else {\n          res = await fetch(url).then(res => res.json());\n        }\n        console.log(url);\n\n        let data = res.data;\n        let cfg = {\n          bindto: el[0],\n          data: {},\n          color: {\n            pattern: Katrid.UI.Dashboard.colorPatterns,\n          },\n        };\n\n        let hasData = false;\n\n        let type = el.attr('type');\n\n        if (type)\n          cfg.data.type = type;\n\n        if (groups) {\n          data = dataGroup(data, groups);\n          let vals = [];\n          for (let i = 1; i < data.length; i++)\n            vals.push(data[i][0]);\n          hasData = true;\n        }\n        else if (_.isArray(data) && data.length) {\n          let cols = Object.keys(data[0]);\n          cfg.data.columns = data.map(obj => [obj[cols[0]], obj[cols[1]]]);\n          hasData = true;\n        }\n\n        if (hasData)\n          chart = c3.generate(cfg);\n      };\n\n      if (attrs.urlParams) {\n        let urlParams = attrs.urlParams;\n        // TODO add list support\n        scope.$watch(attrs.urlParams, observe);\n      } else\n        observe();\n      attrs.$observe('url', observe);\n    }\n  }\n\n\n  class Query extends Katrid.UI.Widgets.Component {\n    constructor() {\n      super();\n      this.priority = 200;\n      this.scope = false;\n    }\n\n    link(scope, el, attrs) {\n      let ds = new DataSource(el, scope);\n      el.remove();\n      return;\n      if (!attrs.name)\n        throw Error('Query name attribute is required!');\n      let instance = scope[attrs.name] = {loading: false, data: null};\n      // find query by url\n      let url = el.data('url');\n      if (url) {\n        console.log('find query by url', url);\n        $.get(url)\n        .then(res => {\n          instance.loading = false;\n          let data = res.data.map((row) => (_.object(res.fields, row)));\n          scope.$apply(() => instance.data = data);\n        });\n        return;\n      }\n\n      let r;\n      let sqlQuery = el.html();\n      let inMemory = 'inMemory' in attrs;\n      if (inMemory) {\n        let dataBind = el.data('bind');\n        let dataBindField = el.data('bind-field');\n        if (dataBind) {\n          scope.$parent.$watch(dataBind, function (newValue, oldValue) {\n            if (_.isArray(newValue) && newValue.length && _.isObject(newValue[0]))\n              console.log(alasql(sqlQuery, [newValue]));\n          });\n        } else if (dataBindField) {\n          // add watcher for the bind fields\n          let fnBind = function (newValue, oldValue) {\n            let fieldLog = scope.dataSource.$fieldLog[dataBindField];\n            if (fieldLog) {\n              let data = fieldLog.value;\n\n              if (_.isArray(data) && data.length && _.isObject(data[0])) {\n                instance = alasql(sqlQuery, [data]);\n              }\n            }\n          };\n          if (_.isString(dataBindField))\n            dataBindField = [dataBindField];\n          for (let field of dataBindField)\n            scope.$parent.$watch('$fieldLog.' + field + '.count', fnBind);\n        }\n      } else {\n        instance.loading = true;\n        if (_.isUndefined(attrs.url))\n          r = Katrid.Services.Query.read(attrs.queryId);\n        else\n          r = $.get(attrs.url);\n        r.then(res => {\n          instance.loading = false;\n          let data = res.data.map((row) => (_.object(res.fields, row)));\n          scope.$apply(() => instance.data = data);\n        });\n      }\n      el.remove();\n    }\n  }\n\n\n  Katrid.Actions.ClientAction.register('dashboard', Dashboard);\n\n  Katrid.UI.uiKatrid.directive('dashboard', ['$compile', DashboardComponent]);\n  Katrid.UI.uiKatrid.directive('chart', ChartComponent);\n  Katrid.UI.uiKatrid.directive('query', Query);\n\n\n  class Field {\n    constructor(el) {\n      this.el = el;\n    }\n\n    th() {\n      let caption = this.el.attr('caption') || this.el.attr('name');\n      let cls = this.el.attr('class');\n      let title = this.el.attr('header-title');\n      let attrs = '';\n      if (!title)\n        title = '';\n      let headerClick = this.el.attr('on-header-click');\n      if (cls)\n        attrs += 'class =\"' + cls + '\"';\n      if (headerClick)\n        attrs += ' ng-click=\"' + headerClick + '\"';\n      return `<th title=\"${title}\" ${attrs}>${caption}</th>`;\n    }\n\n    td() {\n      let format = this.el.attr('format');\n      if (format) {\n        format = '|' + format;\n        console.log('format', format);\n      } else\n        format = '';\n      let title = this.el.attr('title');\n      if (!title)\n        title = '';\n      let ngClass = this.el.attr('ng-class');\n      let cls = this.el[0].className;\n      let content = this.el.html();\n      if (!content)\n        content = `\\${ record.${this.name}${format} }`;\n      return `<td title='${title}' class=\"${cls}\">${content}</td>`;\n    }\n\n    tfoot() {\n      let total = this.total;\n      if (total)\n        total = '${grid.total(\"' + this.name + '\")}';\n      else if (this.footer)\n        total = this.footer;\n      else\n        total = '';\n      let cls = this.el[0].className;\n      return `<td class=\"${cls}\">${total}</td>`;\n    }\n\n    get name() {\n      return this.el.attr('name');\n    }\n\n    get footer() {\n      return this.el.attr('footer');\n    }\n\n    get total() {\n      return this.el.attr('total');\n    }\n  }\n\n\n  Katrid.UI.uiKatrid.directive('tableView', () => ({\n    restrict: 'E',\n    scope: false,\n    template(el, attrs) {\n      let fields = [];\n      for (let fld of el.find('field'))\n        fields.push(new Field($(fld)));\n      return Katrid.app.getTemplate('dashboard.table.jinja2', {fields, el, attrs});\n    }\n  }));\n\n\n  class DataSource {\n    constructor(el, scope) {\n      this.$el = el;\n      this.controls = [];\n      this.$counter = 0;\n      this.$scope = scope;\n      this.name = el.attr('name');\n      if (this.name)\n        scope[this.name] = this;\n      this.sql = this.$el.html();\n      this.url = el.data('url');\n      setTimeout(() => this.execute(), 100);\n    }\n\n    async execute() {\n      this.$loading = true;\n      try {\n        let res;\n        if (this.url) {\n          res = await fetch(this.url)\n          .then(res => res.json());\n        } else if (this.sql)\n          res = await Katrid.Services.Query.executeSql(this.sql);\n        this.$counter++;\n        this.data = res.data;\n        this.$scope.$apply();\n        this.onChange();\n      } finally {\n        this.$loading = false;\n      }\n    }\n\n    onChange() {\n      for (let control of this.controls)\n        control.$render(this.data);\n    }\n\n  }\n\n\n  class DashboardWidget {\n    constructor(opts) {\n      if (_.isString(opts.el))\n        this.$el = $(opts.el);\n      else\n        this.$el = opts.el;\n      this.$scope = opts.scope;\n      this.$sourceScope = opts.sourceScope || opts.scope;\n      this.$loading = false;\n      this.create(opts);\n\n      if (_.isString(this.dataSource)) {\n        let ds = this.$sourceScope[this.dataSource];\n        if (ds) {\n          ds.controls.push(this);\n          if (ds.$counter)\n            this.$render(ds.data);\n        }\n      }\n\n    }\n\n    create(opts) {\n      this.dataSource = opts.dataSource || this.$el.data('source');\n      this.caption = opts.caption || this.$el.attr('caption');\n    }\n\n    $render(data) {\n\n    }\n  }\n\n\n  class Chart extends DashboardWidget {\n    constructor(opts) {\n      super(opts);\n      this.backButton = $(`<button style=\"position: absolute; left: 0; top: 0;\" class=\"btn btn-outline-secondary btn-sm back-button\">${_.gettext('Back')}</button>`);\n      this.backButton.hide();\n      this.$el.prepend(this.backButton);\n    }\n\n    groupBy(data, group, totals) {\n      if (data.length === 0)\n        return [];\n      let res = [];\n      let firstRow = data[0];\n      let sql = 'select ';\n      let groups = group;\n      if (_.isArray(groups))\n        groups = groups.join(',');\n      else if (_.isNumber(group))\n        groups = Object.keys(firstRow)[group];\n      sql += groups;\n      if (_.isArray(totals))\n        for (let total of totals)\n          sql += ',' + 'sum(' + total + ') as ' + total;\n      else if (_.isString((totals)))\n        sql += `,sum(${totals}) as ${totals}`;\n      else if (_.isNumber(totals)) {\n        totals = Object.keys(firstRow)[totals];\n        sql += ',sum(' + totals + ') as ' + totals;\n      }\n      sql += ' from ? group by ';\n      sql += groups;\n      console.log(sql);\n      res = alasql(sql, [data]);\n      return res;\n    }\n\n    create(opts) {\n      super.create(opts);\n      this.x = opts.x;\n      this.y = opts.y;\n      this.keys = opts.keys;\n      this.type = opts.type;\n      this.axis = opts.axis;\n      this.legend = opts.legend;\n      this.onclick = opts.onclick;\n      this.columns = opts.columns;\n      this.grid = opts.grid;\n      this.labels = opts.labels;\n      this.pie = opts.pie;\n\n      if (!this.columns && !this.keys && _.isUndefined(this.x) && _.isUndefined(this.y)) {\n        this.x = 0;\n        this.y = 1;\n      }\n    }\n\n    $render(data) {\n      this.$data = data;\n      if (this.columns)\n        this.$columns = this.columns;\n      else\n        this.$columns = this.groupBy(data, this.x, this.y).map(obj => Object.values(obj));\n\n      let size = {\n        width: this.$el.parent().width(),\n      };\n\n      this.$chart = c3.generate({\n        bindto: this.$el[0],\n        data: {\n          columns: this.$columns,\n          type: this.type,\n          onclick: this.onclick,\n          labels: this.labels,\n        },\n        color: {\n          pattern: ['#1f77b4', '#aec7e8', '#ff7f0e', '#ffbb78', '#2ca02c', '#98df8a', '#d62728', '#ff9896', '#9467bd', '#c5b0d5', '#8c564b', '#c49c94', '#e377c2', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5']\n        },\n        pie: this.pie,\n        size,\n        grid: this.grid,\n        legend: this.legend,\n        axis: this.axis,\n      });\n\n      this.$chart.$chart = this;\n    }\n\n    query(sql, params) {\n      return alasql(sql, params);\n    }\n  }\n\n\n  class GridView extends DashboardWidget {\n    constructor(opts) {\n      super(opts);\n      this._groupBy = [];\n      let groupBy = this.$el.attr('group-by');\n      if (groupBy)\n        this._groupBy = groupBy.split(',');\n      this.totals = [];\n\n\n      this.fields = [];\n      for (let fld of this.$el.find('field')) {\n        let field = new Field($(fld));\n        this.fields.push(field);\n        if (field.total)\n          this.totals.push(field.name);\n      }\n\n      this.$scope.grid = this;\n\n      let templ = Katrid.app.getTemplate('dashboard.grid.jinja2', {\n        self: this,\n        fields: this.fields\n      });\n      templ = Katrid.Core.$compile(templ)(this.$scope);\n      this.$el.html(templ);\n    }\n\n    get groupBy() {\n      return this._groupBy;\n    }\n\n    set groupBy(groupBy) {\n      this._groupBy = groupBy;\n      if (this._lastData)\n        this.$render(this._lastData);\n    }\n\n    total(attr) {\n      console.log('calc attr', attr);\n      let r = 0;\n      if (this._lastData)\n        for (let row of this._lastData)\n          r += row[attr];\n      return r;\n    }\n\n    $render(data) {\n      // render loaded data\n      this._lastData = data;\n      if (!data)\n        data = [];\n      if (this.groupBy.length) {\n        data = groupBy(data, this.groupBy, this.totals, this.fields[0].name);\n      }\n      this.$scope.records = this._renderGroup(data);\n    }\n\n    _renderGroup(data) {\n      let r = [];\n      for (let row of data) {\n        r.push(row);\n        if (row.$group)\n          r = r.concat(this._renderGroup(row.$children));\n      }\n      return r;\n    }\n  }\n\n  function groupBy(data, member, totals, to) {\n    let r = {};\n    for (let row of data) {\n      let v = row[member];\n      let group = r[v];\n      if (!group) {\n        group = r[v] = {$children: []};\n        for (let total of totals)\n          group[total] = 0;\n      }\n      group.$children.push(row);\n      group.$group = true;\n      group[to] = v;\n      for (let total of totals)\n        group[total] += row[total];\n    }\n    return Object.values(r);\n  }\n\n  class GridRow {\n    constructor(grid, row, el) {\n      this.row = row;\n    }\n\n  }\n\n  class GroupRow extends GridRow {\n\n  }\n\n\n  Katrid.UI.uiKatrid.directive('gridView', () => ({\n    restrict: 'E',\n    scope: {},\n    // template(el, attrs) {\n    //   let fields = [];\n    //   for (let fld of el.find('field'))\n    //     fields.push(new Field($(fld)));\n    //   let query = el.find('query');\n    //   if (query.length)\n    //     query = query[0].outerHTML;\n    //   else\n    //     query = '';\n    //   return Katrid.app.getTemplate('dashboard.grid.jinja2', {fields, el, attrs, query});\n    // },\n\n    async link(scope, el, attrs) {\n      let grid = new GridView({el, scope, sourceScope: scope.$parent});\n      return;\n      scope.loading = false;\n      let res, sql;\n      let query = el.find('query');\n      if (attrs.source) {\n        console.log('data source is', attrs.source);\n      } else if (query.length) {\n        sql = query.text();\n        query.remove();\n\n        if (sql) {\n          scope.loading = true;\n          scope.$apply();\n          res = await Katrid.Services.Query.executeSql(sql);\n          scope.loading = false;\n        }\n\n        if (res) {\n          scope.records = res.data;\n          scope.$apply();\n        }\n      }\n    }\n  }));\n\n\n  Katrid.UI.uiKatrid.filter('duration', () => {\n    return (input, unit, format) => {\n      if (!format)\n        format = 'HH:mm:ss';\n      if (input) {\n        if ((unit === 'seconds') && (_.isString(input)))\n          input = parseInt(input);\n        let fmt = moment.duration(input, unit).format(format);\n        if (fmt.length === 5)\n          fmt = '00:' + fmt;\n        return fmt;\n      }\n      return input;\n    }\n  });\n\n\n  Katrid.UI.Dashboard = {\n    Chart,\n    colorPatterns: [\n      '#1f77b4', '#aec7e8', '#ff7f0e', '#ffbb78', '#2ca02c', '#98df8a', '#d62728', '#ff9896', '#9467bd', '#c5b0d5',\n      '#8c564b', '#c49c94', '#e377c2', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5'\n    ],\n  };\n\n\n})();\n","(function() {\n\n  class Telegram {\n    static async export(report, format) {\n      console.log('export telegram');\n      let templ = Katrid.app.$templateCache.get('reportbot.dialog.contacts');\n      let modal = $(templ);\n      $('body').append(modal);\n\n      let sel = modal.find('#id-reportbot-select-contacts');\n      let partners = new Katrid.Services.Model('res.partner');\n      let res = await partners.post('get_telegram_contacts');\n      if (res) {\n        if (res)\n          res.map(c => sel.append(`<option value=\"${ c[0] }\">${ c[1] }</option>`));\n        sel.select2();\n      }\n      modal.find('#id-btn-ok').click(async () => {\n\n        let svc = new Katrid.Services.Model('telegram.pending');\n        format = 'pdf';\n        const params = report.getUserParams();\n        let res = svc.post('export_report', { args: [report.info.id], kwargs: { contacts: sel.val(), format, params } });\n        if (res.ok) console.log('ok');\n      });\n      modal.modal();\n      return true;\n\n    }\n  }\n\n  Katrid.Reports.Telegram = Telegram;\n})();\n","(function () {\n\n  class QueryManager {\n    constructor(app) {\n      this.app = app;\n      this.$scope = app.$scope.$new();\n      this.$scope.queryChange = (query) => this.queryChange(query);\n      this.$scope.search = {};\n      let me = this;\n      this.action = this.$scope.action = {\n        context: {},\n        views: {},\n        async saveSearch(search) {\n          let svc = new Katrid.Services.Model('ui.filter');\n          let data = {};\n          Object.assign(data, search);\n          data.query = me.$scope.query.id;\n          if (search.name === null) {\n            search.name = prompt('Query name', 'current query namne');\n            search.is_default = false;\n            search.is_shared = true;\n          }\n          if (search.name)\n            await svc.write([data])\n        },\n        setSearchParams(params) {\n          me.$scope.search.params = params;\n          me.refresh(me.query);\n        },\n        switchView(viewType) {\n          console.log('set view type', viewType);\n        },\n        orderBy(field) {\n          if (me.$scope.ordering === field)\n            me.$scope.reverse = !me.$scope.reverse;\n          else {\n            me.$scope.ordering = field;\n            me.$scope.reverse = false;\n          }\n        }\n      };\n    }\n\n    getFilter(field) {\n      if (field.type === 'DateField')\n        return \"|date:'shortDate'\";\n      else if (field.type === 'DateTimeField')\n        return \"|date:'short'\";\n      else if (field.type === 'IntegerField')\n        return \"|number:0\";\n      return \"\";\n    }\n\n    getSearchView(query) {\n      let s;\n      if (query.params)\n        s = query.params;\n      else {\n        s = `<search>`;\n        for (let f of query.fields)\n          s += `<field name=\"${f.name}\"/>`;\n        s += '</search>';\n      }\n      // prepare fields to view\n      let fields = {};\n      for (let f of query.fields)\n        fields[f.name] = Katrid.Data.Fields.Field.fromInfo(f);\n      this.fields = fields;\n      return {content: s, fields};\n    }\n\n    async queryChange(query) {\n      this.$scope.search = {\n        viewMoreButtons: true,\n      };\n      this.query = query;\n      let res = await this.refresh(query);\n      // render the result on table\n      // transform result to list of objects\n      query.fields = res.fields;\n      this.action.search = this.getSearchView(query);\n      this.action.fieldList = Object.values(this.fields);\n      this.$scope.action.views.search = this.$scope.action.search;\n      this.renderSearch();\n      this.renderTable(res);\n      this.$scope.$apply();\n    }\n\n    async refresh(query) {\n      let res = await Katrid.Services.Query.read({ id: query.id, details: true, params: this.$scope.search.params });\n      for (let f of res.fields)\n        f.filter = this.getFilter(f);\n      let _toObject = (fields, values) => {\n        let r = {}, i = 0;\n        for (let f of fields) {\n          r[f.name] = values[i];\n          i++;\n        }\n        return r;\n      };\n      this.$scope.records = res.data.map(row => _toObject(res.fields, row));\n      this.$scope.$apply();\n      return res;\n    }\n\n    renderSearch() {\n      let el = this.app.getTemplate('query.manager.search.jinja2');\n      el = Katrid.Core.$compile(el)(this.$scope);\n      this.$element.find('#query-search-view').html(el);\n    }\n\n    async render() {\n      let templ = this.app.getTemplate('query.manager.jinja2');\n      templ = Katrid.Core.$compile(templ)(this.$scope);\n      this.$element = templ;\n      let queries = await Katrid.Services.Query.all();\n      this.$scope.queries = queries.data;\n      this.app.$element.html(templ);\n      this.$scope.$apply();\n    }\n\n    renderTable(data) {\n      let templ = this.app.getTemplate('query.manager.table.jinja2', {\n        self: this, query: this.$scope.query, records: this.records, fields: Object.values(this.fields),\n      });\n      templ = Katrid.Core.$compile(templ)(this.$scope);\n      initColumn(templ);\n      this.$element.find('#query-manager-result').html(templ);\n    }\n  }\n\n  // register the plugin\n  Katrid.Core.plugins.register((app) => {\n    // register event listener\n    $(app).on('hashchange', (event, hash) => {\n      if (hash.startsWith('#/app/query.manager/')) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        app.$scope.$parent.currentMenu = { name: 'Query Manager' };\n\n        let q = new QueryManager(app);\n        q.render();\n      }\n    });\n  });\n\n\n  function initColumn(table) {\n    // $('.checkbox-menu').sortable();\n  }\n\n  function reorder(index1, index2) {\n    $('table tr').each(function () {\n      var tr = $(this);\n      var td1 = tr.find(`td:eq(${index1})`);\n      var td2 = tr.find(`td:eq(${index2})`);\n      td1.detach().insertAfter(td2);\n    });\n  }\n\n\n})();\n","(function () {\n\n  class FileManager {\n    constructor(opts) {\n      this.$element = opts.el;\n      this.$scope = opts.scope;\n      this.service = this.$element.attr('service');\n\n      $.get(this.service)\n      .then(res => {\n        this.$scope.dirs = res.content.filter(obj => obj.type === 'dir');\n        this.$scope.files = res.content.filter(obj => obj.type === 'file');\n        this.$scope.items = res.content;\n        this.$scope.levels[this.$scope.level] = this.$scope.items;\n        this.$scope.$apply();\n      });\n    }\n\n    getPath(item) {\n      let url = item.name;\n      let parent = item.parent;\n      while (parent) {\n        url = parent.name + '/' + url;\n        parent = parent.parent;\n      }\n      return url;\n    }\n\n    expand(item) {\n      let url = this.getPath(item);\n      url = this.service + '?path=' + url;\n      $.get(url)\n        .then(res => {\n          this.$scope.items = res.content;\n          this.$scope.dirs = res.content.filter(obj => obj.type === 'dir');\n          this.$scope.files = res.content.filter(obj => obj.type === 'file');\n          res.content.map(obj => obj.parent = item);\n          this.$scope.levels[this.$scope.level] = this.$scope.items;\n          this.$scope.$apply();\n        });\n    }\n  }\n\n  Katrid.UI.uiKatrid.directive('fileManager', () => ({\n    restrict: 'E',\n    scope: {},\n    templateUrl: 'file-manager.jinja2',\n    link(scope, el) {\n      scope.level = 0;\n      scope.levels = {};\n      let fm = new FileManager({ el, scope });\n      scope.expand = item => {\n        scope.level++;\n        scope.currentItem = item;\n        fm.expand(item);\n        scope.currentPath = fm.getPath(item);\n      };\n\n      scope.backTo = level => {\n        scope.level = level;\n        console.log('back to', level);\n        scope.items = scope.levels[scope.level];\n        scope.dirs = scope.items.filter(obj => obj.type === 'dir');\n        scope.files = scope.items.filter(obj => obj.type === 'file');\n        scope.currentPath = fm.getPath(scope.items[0]);\n      };\n\n      scope.uploadFile = file => {\n        console.log('current path', scope.currentPath);\n        Katrid.Services.Upload.uploadTo('/pwapec/file-manager/upload/?path=' + (scope.currentPath || ''), file)\n          .then(() => {\n            fm.expand(scope.currentItem);\n          });\n      };\n    }\n  }));\n\n})();\n"]}